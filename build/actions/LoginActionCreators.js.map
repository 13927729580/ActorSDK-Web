{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":[],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport history from '../utils/history';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport LocationContainer from '../utils/LocationContainer';\n\nimport ActionCreators from './ActionCreators';\nimport MyProfileActionCreators from './MyProfileActionCreators';\nimport DialogActionCreators from './DialogActionCreators';\nimport ContactActionCreators from './ContactActionCreators';\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\nimport FaviconActionCreators from './FaviconActionCreators';\nimport EventBusActionCreators from './EventBusActionCreators';\n\nclass LoginActionCreators extends ActionCreators {\n  changeLogin(login) {\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login });\n  }\n\n  changeCode(code) {\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code });\n  }\n\n  changeName(name) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name });\n  }\n\n  startSignup() {\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\n  }\n\n  restartAuth() {\n    dispatch(ActionTypes.AUTH_RESTART);\n  }\n\n  requestCode(phone) {\n    let promise;\n    if (/@/.test(phone)) {\n      promise = ActorClient.requestCodeEmail(phone);\n    } else {\n      promise = ActorClient.requestSms(phone);\n    }\n\n    dispatchAsync(promise, {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  requestSms(phone) {\n    dispatchAsync(ActorClient.requestSms(phone), {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  sendCode(code) {\n    dispatchAsync(ActorClient.sendCode(code), {\n      request: ActionTypes.AUTH_CODE_SEND,\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\n    }, {\n      code\n    }).then((state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({redirect: true});\n          break;\n        default:\n          console.error('Unsupported state', state);\n      }\n    });\n  }\n\n  sendSignup(name) {\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\n      request: ActionTypes.AUTH_SIGNUP,\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\n    }, { name });\n\n    const setLoggedIn = () => this.setLoggedIn({redirect: true});\n\n    signUpPromise()\n      .then(setLoggedIn)\n  }\n\n  setLoggedIn(opts = {}) {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedIn) {\n      return delegate.actions.setLoggedIn(opts);\n    }\n\n    if (opts.redirect) {\n      const location = LocationContainer.get();\n      const nextPathname = location.state ? location.state.nextPathname : '/';\n\n      history.replace(nextPathname);\n    }\n\n    this.setBindings('main', [\n      ActorClient.bindUser(ActorClient.getUid(), MyProfileActionCreators.onProfileChanged),\n      ActorClient.bindGroupDialogs(DialogActionCreators.setDialogs),\n      ActorClient.bindContacts(ContactActionCreators.setContacts),\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList),\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon),\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent)\n    ]);\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\n  }\n\n  setLoggedOut() {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedOut) {\n      return delegate.actions.setLoggedOut();\n    }\n\n    this.removeBindings('main');\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_OUT);\n  }\n}\n\nexport default new LoginActionCreators();\n"]}