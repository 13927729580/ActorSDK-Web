{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":[],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport history from '../utils/history';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport LocationContainer from '../utils/LocationContainer';\n\nimport ActionCreators from './ActionCreators';\nimport JoinGroupActions from './JoinGroupActions';\nimport ProfileActionCreators from './ProfileActionCreators';\nimport DialogActionCreators from './DialogActionCreators';\nimport ContactActionCreators from './ContactActionCreators';\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\nimport FaviconActionCreators from './FaviconActionCreators';\nimport EventBusActionCreators from './EventBusActionCreators';\nimport StickersActionCreators from './StickersActionCreators';\n\nclass LoginActionCreators extends ActionCreators {\n  start() {\n    dispatch(ActionTypes.AUTH_START);\n  }\n\n  changeLogin(login) {\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login });\n  }\n\n  changeCode(code) {\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code });\n  }\n\n  changeName(name) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name });\n  }\n\n  startSignup() {\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\n  }\n\n  restartAuth() {\n    dispatch(ActionTypes.AUTH_RESTART);\n  }\n\n  requestCode(phone) {\n    let promise;\n    if (/@/.test(phone)) {\n      promise = ActorClient.requestCodeEmail(phone);\n    } else {\n      promise = ActorClient.requestSms(phone);\n    }\n\n    dispatchAsync(promise, {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  requestSms(phone) {\n    dispatchAsync(ActorClient.requestSms(phone), {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  sendCode(code) {\n    dispatchAsync(ActorClient.sendCode(code), {\n      request: ActionTypes.AUTH_CODE_SEND,\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\n    }, {\n      code\n    }).then((state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({ redirect: true });\n          break;\n        default:\n          console.error('Unsupported state', state);\n      }\n    });\n  }\n\n  sendSignup(name) {\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\n      request: ActionTypes.AUTH_SIGNUP,\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\n    }, { name });\n\n    const setLoggedIn = () => this.setLoggedIn({ redirect: true });\n\n    signUpPromise()\n      .then(setLoggedIn)\n  }\n\n  setLoggedIn(opts = {}) {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedIn) {\n      return delegate.actions.setLoggedIn(opts);\n    }\n\n    if (opts.redirect) {\n      const location = LocationContainer.get();\n      const nextPathname = location.state ? location.state.nextPathname : '/';\n\n      history.replace(nextPathname);\n    }\n\n    this.setBindings('main', [\n      ActorClient.bindUser(ActorClient.getUid(), ProfileActionCreators.setProfile),\n      ActorClient.bindGroupDialogs(DialogActionCreators.setDialogs),\n      ActorClient.bindContacts(ContactActionCreators.setContacts),\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList),\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon),\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent),\n      ActorClient.bindStickers(StickersActionCreators.setStickers)\n    ]);\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\n\n    JoinGroupActions.joinAfterLogin();\n  }\n\n  setLoggedOut() {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedOut) {\n      return delegate.actions.setLoggedOut();\n    }\n\n    this.removeBindings('main');\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_OUT);\n  }\n}\n\nexport default new LoginActionCreators();\n"]}