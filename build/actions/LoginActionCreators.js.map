{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":[],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport history from '../utils/history';\nimport DelegateContainer from '../utils/DelegateContainer';\n\nimport MyProfileActionCreators from './MyProfileActionCreators';\nimport DialogActionCreators from './DialogActionCreators';\nimport ContactActionCreators from './ContactActionCreators';\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\nimport FaviconActionCreators from './FaviconActionCreators';\nimport EventBusActionCreators from './EventBusActionCreators';\n\nconst LoginActionCreators = {\n  changeLogin(login) {\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login })\n  },\n\n  changeCode(code) {\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code })\n  },\n\n  changeName(name) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name })\n  },\n\n  requestSms(phone) {\n    dispatchAsync(ActorClient.requestSms(phone), {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  },\n\n  sendCode(code) {\n    const sendCodePromise = () => dispatchAsync(ActorClient.sendCode(code), {\n      request: ActionTypes.AUTH_CODE_SEND,\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\n    }, { code });\n\n    const handleState = (state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({redirect: true});\n          break;\n        default:\n          console.error('Unsupported state', state);\n      }\n    };\n\n    sendCodePromise()\n      .then(handleState);\n  },\n\n  startSignup() {\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\n  },\n\n  sendSignup(name) {\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\n      request: ActionTypes.AUTH_SIGNUP,\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\n    }, { name });\n\n    const setLoggedIn = () => this.setLoggedIn({redirect: true});\n\n    signUpPromise()\n      .then(setLoggedIn)\n  },\n\n  setLoggedIn(opts = {}) {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedIn) {\n      delegate.actions.setLoggedIn(opts);\n    } else {\n      if (opts.redirect) {\n        // console.debug('opts.redirect', opts.redirect);\n        // console.debug('history', history);\n\n        // TODO: redirect to home after login\n        // const router = RouterContainer.get();\n        // const nextPath = router.getCurrentQuery().nextPath;\n        //\n        // if (nextPath) {\n        //   router.replaceWith(nextPath);\n        // } else {\n        //   router.replaceWith('/');\n        // }\n        history.replace('/');\n      }\n\n      ActorClient.bindUser(ActorClient.getUid(), MyProfileActionCreators.onProfileChanged);\n      ActorClient.bindDialogs(DialogActionCreators.setDialogs);\n      ActorClient.bindContacts(ContactActionCreators.setContacts);\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList);\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon);\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent);\n      dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\n    }\n  },\n\n  setLoggedOut() {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedOut) {\n      delegate.actions.setLoggedOut();\n    } else {\n      ActorClient.unbindUser(ActorClient.getUid(), MyProfileActionCreators.onProfileChanged);\n      ActorClient.unbindDialogs(DialogActionCreators.setDialogs);\n      ActorClient.unbindContacts(ContactActionCreators.setContacts);\n      ActorClient.unbindSearch(QuickSearchActionCreators.setQuickSearchList);\n      ActorClient.unbindTempGlobalCounter(FaviconActionCreators.setFavicon);\n      ActorClient.unbindEventBus(EventBusActionCreators.broadcastEvent);\n      dispatch(ActionTypes.AUTH_SET_LOGGED_OUT);\n    }\n  },\n\n  restartAuth() {\n    dispatch(ActionTypes.AUTH_RESTART)\n  }\n};\n\nexport default LoginActionCreators;\n"]}