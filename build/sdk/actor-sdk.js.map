{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport RouterContainer from '../utils/RouterContainer';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, bugsnagApiKey, mixpanelAPIKey } from '../constants/ActorAppConstants'\nimport Pace from 'pace';\n\nimport React, { Component, PropTypes } from 'react';\nimport Router from 'react-router';\nimport ReactMixin from 'react-mixin';\nimport Actor from 'actor-js';\n\nimport { IntlMixin } from 'react-intl';\nimport crosstab from 'crosstab';\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport Deactivated from '../components/Deactivated.react.js';\nimport Login from '../components/Login.react.js';\nimport Main from '../components/Main.react.js';\nimport JoinGroup from '../components/JoinGroup.react.js';\nimport Install from '../components/Install.react.js';\n\nimport { initBugsnag } from '../utils/Bugsnag';\nimport { initMixpanel } from '../utils/Mixpanel';\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst { DefaultRoute, Route, RouteHandler } = Router;\n\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => {\n  window.isJsAppLoaded = true;\n};\n\nclass App extends Component {\n  static childContextTypes =  {\n    delegate: PropTypes.object\n  };\n\n  static propTypes =  {\n    delegate: PropTypes.object\n  };\n\n  getChildContext() {\n    return {\n      delegate: this.props.delegate\n    };\n  }\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return <RouteHandler/>;\n  }\n}\n\nReactMixin.onClass(App, IntlMixin);\n\nclass ActorSDK {\n  constructor(options) {\n    options = options || {};\n\n    this.endpoints = (options.endpoints && options.endpoints.length > 0) ? options.endpoints : endpoints;\n    this.bugsnagApiKey = options.bugsnagApiKey ? options.bugsnagApiKey : bugsnagApiKey;\n    this.mixpanelAPIKey = options.mixpanelAPIKey ? options.mixpanelAPIKey : mixpanelAPIKey;\n\n    this.delegate = options.delegate ? options.delegate : new SDKDelegate();\n    DelegateContainer.set(this.delegate);\n\n    initBugsnag(this.bugsnagApiKey);\n    initMixpanel(this.mixpanelAPIKey);\n\n    if (this.delegate.l18n) {\n      extendL18n();\n    }\n  }\n\n  _starter() {\n    const ActorInitEvent = 'concurrentActorInit';\n\n    if (crosstab.supported) {\n      crosstab.on(ActorInitEvent, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          window.location.assign('#/deactivated');\n          window.location.reload();\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById('actor-web-app');\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported)\n        crosstab.broadcast(ActorInitEvent, {});\n\n      window.messenger = Actor.create(this.endpoints);\n    }\n\n    const loginComponent = this.delegate.components.login || Login;\n    const intlData = getIntlData();\n\n    const routes = (\n      <Route handler={App} name=\"app\" path=\"/\">\n        <Route handler={loginComponent} name=\"login\" path=\"/auth\"/>\n\n        <Route handler={Main} name=\"main\" path=\"/im/:id\"/>\n        <Route handler={JoinGroup} name=\"join\" path=\"/join/:token\"/>\n        <Route handler={Deactivated} name=\"deactivated\" path=\"/deactivated\"/>\n        <Route handler={Install} name=\"install\" path=\"/install\"/>\n\n        <DefaultRoute handler={Main}/>\n      </Route>\n    );\n\n    const router = Router.create(routes, Router.HashLocation);\n\n    RouterContainer.set(router);\n\n    router.run((Root) => React.render(<Root {...intlData} delegate={this.delegate}/>, appRootElemet));\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) {\n        LoginActionCreators.setLoggedIn({redirect: false});\n      }\n    }\n  };\n\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter.bind(this);\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}