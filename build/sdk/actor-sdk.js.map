{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport '../utils/intl-polyfill';\nimport '../workers'\n\nimport RouterContainer from '../utils/RouterContainer';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, bugsnagApiKey, mixpanelAPIKey } from '../constants/ActorAppConstants'\nimport Pace from 'pace';\n\nimport React, { Component, PropTypes } from 'react';\nimport Router from 'react-router';\nimport ReactMixin from 'react-mixin';\nimport Actor from 'actor-js';\n\nimport { IntlMixin } from 'react-intl';\nimport crosstab from 'crosstab';\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultLogin from '../components/Login.react';\nimport Main from '../components/Main.react';\nimport DefaultJoinGroup from '../components/JoinGroup.react';\nimport DefaultInstall from '../components/Install.react';\n\nimport { initBugsnag } from '../utils/Bugsnag';\nimport { initMixpanel } from '../utils/Mixpanel';\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst { DefaultRoute, Route, RouteHandler } = Router;\n\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => {\n  window.isJsAppLoaded = true;\n};\n\nclass App extends Component {\n  static childContextTypes =  {\n    delegate: PropTypes.object,\n    isExperimental: PropTypes.bool\n  };\n\n  static propTypes =  {\n    delegate: PropTypes.object,\n    isExperimental: PropTypes.bool\n  };\n\n  getChildContext() {\n    return {\n      delegate: this.props.delegate,\n      isExperimental: this.props.isExperimental\n    };\n  }\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return <RouteHandler/>;\n  }\n}\n\nReactMixin.onClass(App, IntlMixin);\n\n/** Class represents ActorSKD itself */\nclass ActorSDK {\n  /**\n   * @constructor\n   * @param {object} options - Object contains custom components, actions and localisation strings.\n   */\n  constructor(options = {}) {\n\n    this.endpoints = (options.endpoints && options.endpoints.length > 0) ? options.endpoints : endpoints;\n    this.bugsnagApiKey = options.bugsnagApiKey ? options.bugsnagApiKey : bugsnagApiKey;\n    this.mixpanelAPIKey = options.mixpanelAPIKey ? options.mixpanelAPIKey : mixpanelAPIKey;\n    this.isExperimental = options.isExperimental ? options.isExperimental : false;\n\n    this.delegate = options.delegate ? options.delegate : new SDKDelegate();\n    DelegateContainer.set(this.delegate);\n\n    initBugsnag(this.bugsnagApiKey);\n    initMixpanel(this.mixpanelAPIKey);\n\n    if (this.delegate.l18n) {\n      extendL18n();\n    }\n  }\n\n  _starter() {\n    const ActorInitEvent = 'concurrentActorInit';\n\n    if (crosstab.supported) {\n      crosstab.on(ActorInitEvent, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          window.location.assign('#/deactivated');\n          window.location.reload();\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById('actor-web-app');\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) {\n        crosstab.broadcast(ActorInitEvent, {});\n      }\n\n      window.messenger = Actor.create(this.endpoints);\n    }\n\n    const Login = this.delegate.components.login || DefaultLogin;\n    const Deactivated = this.delegate.components.deactivated || DefaultDeactivated;\n    const Install = this.delegate.components.install || DefaultInstall;\n    const JoinGroup = this.delegate.components.joinGroup || DefaultJoinGroup;\n    const intlData = getIntlData();\n\n    const routes = (\n      <Route handler={App} name=\"app\" path=\"/\">\n        <Route handler={Login} name=\"login\" path=\"/auth\"/>\n\n        <Route handler={Main} name=\"main\" path=\"/im/:id\"/>\n        <Route handler={JoinGroup} name=\"join\" path=\"/join/:token\"/>\n        <Route handler={Deactivated} name=\"deactivated\" path=\"/deactivated\"/>\n        <Route handler={Install} name=\"install\" path=\"/install\"/>\n\n        <DefaultRoute handler={Main}/>\n      </Route>\n    );\n\n    const router = Router.create(routes, Router.HashLocation);\n\n    RouterContainer.set(router);\n\n    router.run((Root) => React.render(<Root {...intlData} delegate={this.delegate} isExperimental={this.isExperimental}/>, appRootElemet));\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) {\n        LoginActionCreators.setLoggedIn({redirect: false});\n      }\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter.bind(this);\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}