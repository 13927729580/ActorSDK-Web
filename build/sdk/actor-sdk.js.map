{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport { intlData } from '../l18n';\nimport RouterContainer from '../utils/RouterContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, bugsnagApiKey, mixpanelAPIKey } from '../constants/ActorAppConstants'\nimport Pace from 'pace';\n\nimport React, { Component } from 'react';\nimport Router from 'react-router';\nimport ReactMixin from 'react-mixin';\nimport Actor from 'actor-js';\n\nimport { IntlMixin } from 'react-intl';\nimport crosstab from 'crosstab';\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport Deactivated from '../components/Deactivated.react.js';\nimport Login from '../components/Login.react.js';\nimport Main from '../components/Main.react.js';\nimport JoinGroup from '../components/JoinGroup.react.js';\nimport Install from '../components/Install.react.js';\n\nimport { initBugsnag } from '../utils/Bugsnag';\nimport { initMixpanel } from '../utils/Mixpanel';\n\nconst { DefaultRoute, Route, RouteHandler } = Router;\n\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => {\n  window.isJsAppLoaded = true;\n};\n\nclass App extends Component {\n  render() {\n    return <RouteHandler/>;\n  }\n}\n\nReactMixin.onClass(App, IntlMixin);\n\nclass ActorSDK {\n  constructor(options) {\n    options = options || {};\n\n    this.endpoints = (options.endpoints && options.endpoints.length > 0) ? options.endpoints : endpoints;\n    this.delegate = options.delegate ? options.delegate : new SDKDelegate();\n    this.bugsnagApiKey = options.bugsnagApiKey ? options.bugsnagApiKey : bugsnagApiKey;\n    this.mixpanelAPIKey = options.mixpanelAPIKey ? options.mixpanelAPIKey : mixpanelAPIKey;\n\n    initBugsnag(this.bugsnagApiKey);\n    initMixpanel(this.mixpanelAPIKey);\n  }\n\n  _starter() {\n    const ActorInitEvent = 'concurrentActorInit';\n\n    if (crosstab.supported) {\n      crosstab.on(ActorInitEvent, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          window.location.assign('#/deactivated');\n          window.location.reload();\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById('actor-web-app');\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported)\n        crosstab.broadcast(ActorInitEvent, {});\n\n      window.messenger = Actor.create(this.endpoints);\n    }\n\n    const loginComponent = this.delegate.loginComponent || Login;\n\n    const routes = (\n      <Route handler={App} name=\"app\" path=\"/\">\n        <Route handler={loginComponent} name=\"login\" path=\"/auth\"/>\n\n        <Route handler={Main} name=\"main\" path=\"/im/:id\"/>\n        <Route handler={JoinGroup} name=\"join\" path=\"/join/:token\"/>\n        <Route handler={Deactivated} name=\"deactivated\" path=\"/deactivated\"/>\n        <Route handler={Install} name=\"install\" path=\"/install\"/>\n\n        <DefaultRoute handler={Main}/>\n      </Route>\n    );\n\n    const router = Router.create(routes, Router.HashLocation);\n\n    RouterContainer.set(router);\n\n    router.run((Root) => React.render(<Root {...intlData}/>, appRootElemet));\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) {\n        LoginActionCreators.setLoggedIn(router, {redirect: false});\n      }\n    }\n  };\n\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter.bind(this);\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}