{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport '../utils/intl-polyfill';\n\nimport Actor from 'actor-js';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SharedContainer from '../utils/SharedContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, rootElement, homePage, twitter, helpPhone, appName } from '../constants/ActorAppConstants'\nimport Pace from 'pace';\n\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Router, Route, IndexRoute } from 'react-router';\nimport history from '../utils/history';\nimport { IntlProvider } from 'react-intl';\nimport crosstab from 'crosstab';\nimport { lightbox } from '../utils/ImageUtils'\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport App from '../components/App.react';\nimport Main from '../components/Main.react';\nimport DefaultLogin from '../components/Login.react';\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultJoin from '../components/Join.react';\nimport DefaultInstall from '../components/Install.react';\nimport Modal from 'react-modal';\n\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst ACTOR_INIT_EVENT = 'INIT';\n\n// Init app loading progressbar\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\n// Init lightbox\nlightbox.load({\n  animation: false,\n  controlClose: '<i class=\"material-icons\">close</i>'\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\n\n/**\n * Class represents ActorSKD itself\n *\n * @param {object} options - Object contains custom components, actions and localisation strings.\n */\nclass ActorSDK {\n  constructor(options = {}) {\n    this.endpoints = (options.endpoints && options.endpoints.length > 0) ? options.endpoints : endpoints;\n    this.isExperimental = options.isExperimental ? options.isExperimental : false;\n    this.forceLocale = options.forceLocale ? options.forceLocale : null;\n    this.rootElement = options.rootElement ? options.rootElement : rootElement;\n    this.homePage = options.homePage ? options.homePage : homePage;\n    this.twitter = options.twitter ? options.twitter : twitter;\n    this.helpPhone = options.helpPhone ? options.helpPhone : helpPhone;\n    this.appName = options.appName ? options.appName : appName;\n    this.delegate = options.delegate ? options.delegate : new SDKDelegate();\n\n    DelegateContainer.set(this.delegate);\n\n    if (this.delegate.l18n) extendL18n();\n\n    SharedContainer.set(this);\n  }\n\n  _starter = () => {\n    if (crosstab.supported) {\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          history.push('deactivated');\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById(this.rootElement);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\n      window.messenger = Actor.create(this.endpoints);\n    }\n\n    const Login = this.delegate.components.login || DefaultLogin;\n    const Deactivated = this.delegate.components.deactivated || DefaultDeactivated;\n    const Install = this.delegate.components.install || DefaultInstall;\n    const Join = this.delegate.components.join || DefaultJoin;\n    const intlData = getIntlData(this.forceLocale);\n\n    const requireAuth = (nextState, replaceState) => {\n      if (!LoginStore.isLoggedIn()) {\n        replaceState({\n          pathname: '/auth',\n          state: {nextPathname: nextState.location.pathname}\n        })\n      }\n    };\n\n    /**\n     * Method for pulling props to router components\n     *\n     * @param RoutedComponent component for extending\n     * @param props props to extend\n     * @returns {object} extended component\n     */\n    const createElement = (Component, props) => {\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\n    };\n\n    const root = (\n      <IntlProvider {...intlData}>\n        <Router history={history} createElement={createElement}>\n          <Route path=\"/\" component={App}>\n            <Route path=\"auth\" component={Login}/>\n            <Route path=\"deactivated\" component={Deactivated}/>\n            <Route path=\"install\" component={Install}/>\n            <Route path=\"join/:token\" component={Join}/>\n\n            <Route path=\"im/:id\" component={Main}/>\n\n            <IndexRoute component={Main} onEnter={requireAuth}/>\n          </Route>\n        </Router>\n      </IntlProvider>\n    );\n\n    render(root, appRootElemet);\n\n    // initial setup fot react modal\n    Modal.setAppElement(appRootElemet);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({redirect: false});\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter;\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}