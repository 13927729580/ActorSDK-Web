{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport 'setimmediate';\nimport 'intl';\n\nimport Actor from 'actor-js';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Router, Route, IndexRoute, Redirect, IndexRedirect } from 'react-router';\nimport Modal from 'react-modal';\nimport Pace from 'pace';\nimport crosstab from 'crosstab';\nimport assignDeep from 'assign-deep';\n\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SharedContainer from '../utils/SharedContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, rootElement, helpPhone, appName } from '../constants/ActorAppConstants'\n\nimport history from '../utils/history';\nimport RouterHooks from '../utils/RouterHooks';\nimport { IntlProvider } from 'react-intl';\nimport { lightbox } from '../utils/ImageUtils'\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\nimport defaultLogHandler from '../utils/defaultLogHandler';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport App from '../components/App.react';\nimport Main from '../components/Main.react';\nimport DefaultLogin from '../components/Login.react';\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultJoin from '../components/Join.react';\nimport DefaultInstall from '../components/Install.react';\nimport DefaultArchive from '../components/Archive.react';\nimport DefaultDialog from '../components/Dialog.react';\nimport DefaultEmpty from '../components/Empty.react';\n\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst ACTOR_INIT_EVENT = 'INIT';\n\n// Init app loading progressbar\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\n// Init lightbox\nlightbox.load({\n  animation: false,\n  controlClose: '<i class=\"material-icons\">close</i>'\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\n\n/**\n * Class represents ActorSKD itself\n *\n * @param {object} options - Object contains custom components, actions and localisation strings.\n */\nclass ActorSDK {\n  static defaultOptions = {\n    endpoints,\n    rootElement,\n    appName,\n    helpPhone,\n    homePage: null,\n    twitter: null,\n    facebook: null,\n    delegate: null,\n    forceLocale: null,\n    features: {\n      calls: true,\n      search: false\n    },\n    routes: null,\n    isExperimental: false,\n    logHandler: defaultLogHandler\n  };\n\n  constructor(options = {}) {\n    assignDeep(this, ActorSDK.defaultOptions, options);\n\n    if (!this.delegate) {\n      this.delegate = new SDKDelegate();\n    }\n\n    DelegateContainer.set(this.delegate);\n\n    if (this.delegate.l18n) extendL18n();\n\n    SharedContainer.set(this);\n  }\n\n  getRoutes() {\n    if (this.routes) {\n      return this.routes;\n    }\n\n    const Login = (typeof this.delegate.components.login == 'function') ? this.delegate.components.login : DefaultLogin;\n    const Deactivated = (typeof this.delegate.components.deactivated == 'function') ? this.delegate.components.deactivated : DefaultDeactivated;\n    const Install = (typeof this.delegate.components.install == 'function') ? this.delegate.components.install : DefaultInstall;\n    const Archive = (typeof this.delegate.components.archive == 'function') ? this.delegate.components.archive : DefaultArchive; // TODO: Rename this component\n    const Join = (typeof this.delegate.components.join == 'function') ? this.delegate.components.join : DefaultJoin;\n    const Empty = (typeof this.delegate.components.empty == 'function') ? this.delegate.components.empty : DefaultEmpty;\n    const Dialog = (typeof this.delegate.components.dialog == 'function') ? this.delegate.components.dialog : DefaultDialog;\n\n    return (\n      <Route path=\"/\" component={App}>\n        <Route path=\"auth\" component={Login}/>\n        <Route path=\"deactivated\" component={Deactivated}/>\n        <Route path=\"install\" component={Install}/>\n\n        <Route path=\"im\" component={Main} onEnter={RouterHooks.requireAuth}>\n          <Route path=\"history\" component={Archive} />\n          <Route path=\"join/:token\" component={Join} />\n          <Route path=\":id\" component={Dialog} />\n          <IndexRoute component={Empty} />\n        </Route>\n\n        <Redirect from=\"join/:token\" to=\"im/join/:token\" />\n        <IndexRedirect to=\"im\"/>\n      </Route>\n    );\n  }\n\n  _starter = () => {\n    if (crosstab.supported) {\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          history.push('deactivated');\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById(this.rootElement);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\n      window.messenger = Actor.create({\n        endpoints: this.endpoints,\n        logHandler: this.logHandler\n      });\n    }\n\n    const intlData = getIntlData(this.forceLocale);\n\n    /**\n     * Method for pulling props to router components\n     *\n     * @param RoutedComponent component for extending\n     * @param props props to extend\n     * @returns {object} extended component\n     */\n    const createElement = (Component, props) => {\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\n    };\n\n    const root = (\n      <IntlProvider {...intlData}>\n        <Router history={history} createElement={createElement}>\n          {this.getRoutes()}\n        </Router>\n      </IntlProvider>\n    );\n\n    render(root, appRootElemet);\n\n    // initial setup fot react modal\n    Modal.setAppElement(appRootElemet);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({ redirect: false });\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter;\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}