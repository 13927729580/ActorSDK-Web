{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport 'setimmediate';\nimport 'intl';\n\nimport Actor from 'actor-js';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Router, Route, IndexRoute, IndexRedirect } from 'react-router';\nimport Modal from 'react-modal';\nimport Pace from 'pace';\nimport crosstab from 'crosstab';\nimport assignDeep from 'assign-deep';\n\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SharedContainer from '../utils/SharedContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, rootElement, helpPhone, appName } from '../constants/ActorAppConstants'\n\nimport history from '../utils/history';\nimport RouterHooks from '../utils/RouterHooks';\nimport { IntlProvider } from 'react-intl';\nimport { lightbox } from '../utils/ImageUtils'\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\nimport defaultLogHandler from '../utils/defaultLogHandler';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport App from '../components/App.react';\nimport Main from '../components/Main.react';\nimport DefaultLogin from '../components/Login.react';\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultJoin from '../components/Join.react';\nimport DefaultInstall from '../components/Install.react';\nimport DefaultArchive from '../components/Archive.react';\nimport DefaultDialog from '../components/Dialog.react';\nimport DefaultEmpty from '../components/Empty.react';\n\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst ACTOR_INIT_EVENT = 'INIT';\n\n// Init app loading progressbar\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\n// Init lightbox\nlightbox.load({\n  animation: false,\n  controlClose: '<i class=\"material-icons\">close</i>'\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\n\n/**\n * Class represents ActorSKD itself\n *\n * @param {object} options - Object contains custom components, actions and localisation strings.\n */\nclass ActorSDK {\n  static defaultOptions = {\n    endpoints,\n    rootElement,\n    appName,\n    helpPhone,\n    homePage: null,\n    twitter: null,\n    facebook: null,\n    delegate: null,\n    forceLocale: null,\n    features: {\n      calls: true,\n      search: false\n    },\n    isExperimental: false,\n    logHandler: defaultLogHandler\n  };\n\n  constructor(options = {}) {\n    assignDeep(this, ActorSDK.defaultOptions, options);\n\n    if (!this.delegate) {\n      this.delegate = new SDKDelegate();\n    }\n\n    DelegateContainer.set(this.delegate);\n\n    if (this.delegate.l18n) extendL18n();\n\n    SharedContainer.set(this);\n  }\n\n  _starter = () => {\n    if (crosstab.supported) {\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          history.push('deactivated');\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById(this.rootElement);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\n      window.messenger = Actor.create({\n        endpoints: this.endpoints,\n        logHandler: this.logHandler\n      });\n    }\n\n    const Login = (typeof this.delegate.components.login == 'function') ? this.delegate.components.login : DefaultLogin;\n    const Deactivated = (typeof this.delegate.components.deactivated == 'function') ? this.delegate.components.deactivated : DefaultDeactivated;\n    const Install = (typeof this.delegate.components.install == 'function') ? this.delegate.components.install : DefaultInstall;\n    const Archive = (typeof this.delegate.components.archive == 'function') ? this.delegate.components.archive : DefaultArchive;\n    const Join = (typeof this.delegate.components.join == 'function') ? this.delegate.components.join : DefaultJoin;\n    const Empty = (typeof this.delegate.components.empty == 'function') ? this.delegate.components.empty : DefaultEmpty;\n    const Dialog = (typeof this.delegate.components.dialog == 'function') ? this.delegate.components.dialog : DefaultDialog;\n    const intlData = getIntlData(this.forceLocale);\n\n    /**\n     * Method for pulling props to router components\n     *\n     * @param RoutedComponent component for extending\n     * @param props props to extend\n     * @returns {object} extended component\n     */\n    const createElement = (Component, props) => {\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\n    };\n\n    const root = (\n      <IntlProvider {...intlData}>\n        <Router history={history} createElement={createElement}>\n          <Route path=\"/\" component={App}>\n            <Route path=\"auth\" component={Login}/>\n            <Route path=\"deactivated\" component={Deactivated}/>\n            <Route path=\"install\" component={Install}/>\n            <Route path=\"join/:token\" component={Join} onEnter={RouterHooks.requireAuth}/>\n\n            <Route path=\"im\" component={Main} onEnter={RouterHooks.requireAuth}>\n              <Route path=\"archive\" component={Archive}/>\n              <Route path=\":id\" component={Dialog}/>\n              <IndexRoute component={Empty}/>\n            </Route>\n\n            <IndexRedirect to=\"im\"/>\n          </Route>\n        </Router>\n      </IntlProvider>\n    );\n\n    render(root, appRootElemet);\n\n    // initial setup fot react modal\n    Modal.setAppElement(appRootElemet);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({redirect: false});\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter;\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}