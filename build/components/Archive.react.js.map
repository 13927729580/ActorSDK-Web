{"version":3,"sources":["../../src/components/Archive.react.js"],"names":[],"mappings":"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","file":"Archive.react.js","sourcesContent":["/*\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\n */\n\nimport { map, debounce } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { Link } from 'react-router';\n\nimport ArchiveActionCreators from '../actions/ArchiveActionCreators';\n\nimport ArchiveStore from '../stores/ArchiveStore';\n\nimport AvatarItem from './common/AvatarItem.react';\nimport ConnectionState from './common/ConnectionState.react';\nimport Scrollbar from './common/Scrollbar.react';\n\nclass Archive extends Component {\n  constructor(props){\n    super(props);\n  }\n\n  static getStores = () => [ArchiveStore];\n\n  static calculateState() {\n    return {\n      isLoading: ArchiveStore.isArchiveLoading(),\n      isInitialLoadingComplete: ArchiveStore.isInitialLoadingComplete(),\n      isAllLoaded: ArchiveStore.isAllLoaded(),\n      dialogs: ArchiveStore.getDialogs()\n    }\n  };\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  componentWillMount() {\n    ArchiveActionCreators.loadArchivedDialogs();\n  }\n\n  componentDidUpdate() {\n    const { isInitialLoadingComplete, isAllLoaded, isLoading } = this.state;\n    if (isInitialLoadingComplete && !isAllLoaded && !isLoading) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollContent = scrollNode.getElementsByClassName('ss-content')[0];\n      if (scrollContent.scrollHeight < scrollNode.scrollHeight) {\n        setTimeout(() => {\n          ArchiveActionCreators.loadMoreArchivedDialogs();\n        }, 0);\n      }\n    }\n  }\n\n  loadArchiveByScroll = debounce(() => {\n    const { isAllLoaded, isLoading } = this.state;\n    const threshold = 100;\n    if (!isLoading && !isAllLoaded) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollArea = scrollNode.getElementsByClassName('ss-scrollarea')[0];\n\n      if (scrollNode.scrollHeight + scrollArea.scrollTop > scrollArea.scrollHeight - threshold) {\n        ArchiveActionCreators.loadMoreArchivedDialogs();\n      }\n    }\n  }, 5, {maxWait: 30});\n\n  render() {\n    const { isLoading, dialogs, isAllLoaded } = this.state;\n    const archiveClassname = classnames('archive-section', {\n      'archive-section--loading': isLoading\n    });\n\n    const dialogsList = map(dialogs, (dialog, index) => {\n      const { counter, peer } = dialog;\n\n      return (\n        <div className=\"archive-section__list__item col-xs-12 col-sm-6 col-md-4 col-lg-3\" key={index}>\n          <Link to={`/im/${peer.peer.key}`} className=\"archive-item row\">\n            <div className=\"archive-item__avatar\">\n              <AvatarItem image={peer.avatar}\n                          placeholder={peer.placeholder}\n                          size=\"medium\"\n                          title={peer.title}/>\n              {\n                counter !== 0\n                  ? <div className=\"archive-item__counter\">{counter}</div>\n                  : null\n              }\n            </div>\n            <div className=\"col-xs\">\n              <h4 className=\"archive-item__title\">{peer.title}</h4>\n            </div>\n          </Link>\n        </div>\n      )\n    });\n\n    return (\n      <section className=\"main\">\n        <header className=\"toolbar row\">\n          <h3>Archive</h3>\n        </header>\n        <ConnectionState/>\n        <div className=\"flexrow\">\n          <section className={archiveClassname}>\n            <Scrollbar ref=\"archiveScroll\" onScroll={this.loadArchiveByScroll}>\n              <div className=\"archive-section__list row\">\n                {\n                  dialogs.length !== 0\n                    ? dialogsList\n                    : !isLoading\n                        ? <div className=\"archive-section__list__item archive-section__list__item--empty col-xs-12\">\n                            <h3>No dialogs in archive</h3>\n                          </div>\n                        : null\n                }\n                {\n                  isLoading\n                    ? <div className=\"archive-section__list__item archive-section__list__item--loading col-xs-12 col-sm-6 col-md-4 col-lg-3\">\n                        <div className=\"preloader\"><div/><div/><div/><div/><div/></div>\n                      </div>\n                    : null\n                }\n              </div>\n            </Scrollbar>\n          </section>\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Archive, {pure: false});\n"]}