{"version":3,"sources":["../../src/components/Archive.react.js"],"names":[],"mappings":"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","file":"Archive.react.js","sourcesContent":["/*\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\n */\n\nimport { map, debounce } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { Link } from 'react-router';\n\nimport ArchiveActionCreators from '../actions/ArchiveActionCreators';\n\nimport ArchiveStore from '../stores/ArchiveStore';\n\nimport AvatarItem from './common/AvatarItem.react';\nimport ConnectionState from './common/ConnectionState.react';\nimport Scrollbar from './common/Scrollbar.react';\n\nclass Archive extends Component {\n  constructor(props){\n    super(props);\n  }\n\n  static getStores = () => [ArchiveStore];\n\n  static calculateState() {\n    return {\n      isLoading: ArchiveStore.isArchiveLoading(),\n      isInitialLoadingComplete: ArchiveStore.isInitialLoadingComplete(),\n      isAllLoaded: ArchiveStore.isAllLoaded(),\n      dialogs: ArchiveStore.getDialogs()\n    }\n  };\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  componentWillMount() {\n    ArchiveActionCreators.loadArchivedDialogs();\n  }\n\n  componentDidUpdate() {\n    const { isInitialLoadingComplete, isAllLoaded, isLoading } = this.state;\n    if (isInitialLoadingComplete && !isAllLoaded && !isLoading) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollContent = scrollNode.getElementsByClassName('ss-content')[0];\n      if (scrollContent.scrollHeight < scrollNode.scrollHeight) {\n        setTimeout(() => {\n          ArchiveActionCreators.loadMoreArchivedDialogs();\n        }, 0);\n      }\n    }\n  }\n\n  loadArchiveByScroll = debounce(() => {\n    const { isAllLoaded, isLoading } = this.state;\n    const threshold = 100;\n    if (!isLoading && !isAllLoaded) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollArea = scrollNode.getElementsByClassName('ss-scrollarea')[0];\n\n      if (scrollNode.scrollHeight + scrollArea.scrollTop > scrollArea.scrollHeight - threshold) {\n        ArchiveActionCreators.loadMoreArchivedDialogs();\n      }\n    }\n  }, 5, {maxWait: 30});\n\n  render() {\n    const { isLoading, dialogs, isAllLoaded } = this.state;\n    const archiveClassname = classnames('archive-section', {\n      'archive-section--loading': isLoading\n    });\n\n    const dialogsList = map(dialogs, (dialog, index) => {\n      const { counter, peer } = dialog;\n\n      return (\n        <div className=\"archive-section__list__item col-xs-12 col-sm-6 col-md-4 col-lg-3\" key={index}>\n          <Link to={`/im/${peer.peer.key}`} className=\"archive-item row\">\n            <div className=\"archive-item__avatar\">\n              <AvatarItem image={peer.avatar}\n                          placeholder={peer.placeholder}\n                          size=\"medium\"\n                          title={peer.title}/>\n              {\n                counter !== 0\n                  ? <div className=\"archive-item__counter\">{counter}</div>\n                  : null\n              }\n            </div>\n            <div className=\"col-xs\">\n              <h4 className=\"archive-item__title\">{peer.title}</h4>\n            </div>\n          </Link>\n        </div>\n      )\n    });\n\n    return (\n      <section className=\"main\">\n        <header className=\"toolbar row\">\n          <h3>Archive</h3>\n        </header>\n        <ConnectionState/>\n        <div className=\"flexrow\">\n          <section className={archiveClassname}>\n            <Scrollbar ref=\"archiveScroll\" onScroll={this.loadArchiveByScroll}>\n              <div className=\"archive-section__list row\">\n                {\n                  dialogs.length !== 0\n                    ? dialogsList\n                    : !isLoading\n                        ? <div className=\"archive-section__list__item archive-section__list__item--empty col-xs-12\">\n                            <h3>No dialogs in archive</h3>\n                          </div>\n                        : null\n                }\n                {\n                  isLoading\n                    ? <div className=\"archive-section__list__item archive-section__list__item--loading col-xs-12 col-sm-6 col-md-4 col-lg-3\">\n                        <div className=\"preloader\"><div/><div/><div/><div/><div/></div>\n                      </div>\n                    : null\n                }\n              </div>\n            </Scrollbar>\n          </section>\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Archive, {pure: false});\n"]}