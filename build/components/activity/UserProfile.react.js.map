{"version":3,"sources":["../../../src/components/activity/UserProfile.react.js"],"names":[],"mappings":"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","file":"UserProfile.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage } from 'react-intl';\nimport classnames from 'classnames';\nimport { lightbox } from '../../utils/ImageUtils';\n\nimport ActorClient from '../../utils/ActorClient';\nimport confirm from '../../utils/confirm';\nimport { escapeWithEmoji } from '../../utils/EmojiUtils';\n\nimport ContactActionCreators from '../../actions/ContactActionCreators';\nimport DialogActionCreators from '../../actions/DialogActionCreators';\nimport NotificationsActionCreators from '../../actions/NotificationsActionCreators';\nimport CallActionCreators from '../../actions/CallActionCreators';\nimport BlockedUsersActionCreators from '../../actions/BlockedUsersActionCreators';\n\nimport UserStore from '../../stores/UserStore';\nimport NotificationsStore from '../../stores/NotificationsStore';\nimport OnlineStore from '../../stores/OnlineStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport ContactDetails from '../common/ContactDetails.react';\nimport ToggleNotifications from '../common/ToggleNotifications.react';\n\nclass UserProfile extends Component {\n  static propTypes = {\n    user: PropTypes.object.isRequired\n  };\n\n  static getStores() {\n    return [NotificationsStore, OnlineStore];\n  }\n\n  static calculateState(prevState, nextProps) {\n    const uid = nextProps.user.id;\n    const peer = uid ? UserStore.getUser(uid) : null;\n\n    return {\n      ...prevState,\n      peer,\n      isNotificationsEnabled: peer ? NotificationsStore.isNotificationsEnabled(peer) : true,\n      message: OnlineStore.getMessage()\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isMoreDropdownOpen: false\n    };\n\n    this.onClearChat = this.onClearChat.bind(this);\n    this.onDeleteChat = this.onDeleteChat.bind(this);\n    this.onBlockUser = this.onBlockUser.bind(this);\n    this.onRemoveFromContacts = this.onRemoveFromContacts.bind(this);\n    this.onAddToContacts = this.onAddToContacts.bind(this);\n    this.onNotificationChange = this.onNotificationChange.bind(this);\n    this.closeActionsDropdown = this.closeActionsDropdown.bind(this);\n    this.toggleActionsDropdown = this.toggleActionsDropdown.bind(this);\n    this.handleAvatarClick = this.handleAvatarClick.bind(this);\n    this.makeCall = this.makeCall.bind(this);\n  }\n\n  onAddToContacts() {\n     ContactActionCreators.addContact(this.props.user.id);\n  }\n\n  onNotificationChange(event) {\n    const { peer } = this.state;\n    NotificationsActionCreators.changeNotificationsEnabled(peer, event.target.checked);\n  }\n\n  toggleActionsDropdown() {\n    const { isActionsDropdownOpen } = this.state;\n\n    if (!isActionsDropdownOpen) {\n      this.setState({ isActionsDropdownOpen: true });\n      document.addEventListener('click', this.closeActionsDropdown, false);\n    } else {\n      this.closeActionsDropdown();\n    }\n  }\n\n  closeActionsDropdown() {\n    this.setState({ isActionsDropdownOpen: false });\n    document.removeEventListener('click', this.closeActionsDropdown, false);\n  }\n\n  onClearChat() {\n    const { user } = this.props;\n    confirm(\n      <FormattedMessage id=\"modal.confirm.user.clear\" values={{ name: user.name }} />\n    ).then(\n      () => {\n        const peer = ActorClient.getUserPeer(user.id);\n        DialogActionCreators.clearChat(peer);\n      },\n      () => {}\n    );\n  }\n\n  onRemoveFromContacts() {\n    const { user } = this.props;\n    confirm(\n      <FormattedMessage id=\"modal.confirm.user.removeContact\" values={{ name: user.name }}/>\n    ).then(\n      () => ContactActionCreators.removeContact(user.id),\n      () => {}\n    );\n  }\n\n  onDeleteChat() {\n    const { user } = this.props;\n\n    confirm(\n      <FormattedMessage id=\"modal.confirm.user.delete\" values={{ name: user.name }} />\n    ).then(\n      () => {\n        const peer = ActorClient.getUserPeer(user.id);\n        DialogActionCreators.deleteChat(peer);\n      },\n      () => {}\n    );\n  }\n\n  onBlockUser() {\n    const { user } = this.props;\n\n    confirm(\n      <FormattedMessage id=\"modal.confirm.user.block\" values={{ name: user.name }} />\n    ).then(\n      () => BlockedUsersActionCreators.blockUser(user.id),\n      () => {}\n    );\n  }\n\n  handleAvatarClick() {\n    lightbox.open(this.props.user.bigAvatar)\n  }\n\n  makeCall() {\n    const { user } = this.props;\n    CallActionCreators.makeCall(user.id);\n  }\n\n  renderAbout() {\n    const { about } = this.props.user;\n    if (!about) return null;\n\n    return (\n      <div\n        className=\"user_profile__meta__about\"\n        dangerouslySetInnerHTML={{ __html: escapeWithEmoji(about).replace(/\\n/g, '<br/>') }}/>\n    )\n  }\n\n  renderToggleContact() {\n    const { isContact } = this.props.user;\n\n    if (isContact) {\n      return (\n        <li className=\"dropdown__menu__item\" onClick={this.onRemoveFromContacts}>\n          <FormattedMessage id=\"removeFromContacts\"/>\n        </li>\n      );\n    }\n\n    return (\n      <li className=\"dropdown__menu__item\" onClick={this.onAddToContacts}>\n        <FormattedMessage id=\"addToContacts\"/>\n      </li>\n    );\n  }\n\n  render() {\n    const { user } = this.props;\n    const { isNotificationsEnabled, isActionsDropdownOpen, message } = this.state;\n\n    const dropdownClassNames = classnames('dropdown', {\n      'dropdown--opened': isActionsDropdownOpen\n    });\n\n    return (\n      <div className=\"activity__body user_profile\">\n\n        <ul className=\"profile__list\">\n          <li className=\"profile__list__item user_profile__meta\">\n            <header>\n              <AvatarItem\n                className=\"profile__avatar\"\n                size=\"large\"\n                image={user.bigAvatar}\n                placeholder={user.placeholder}\n                title={user.name}\n                onClick={this.handleAvatarClick}\n              />\n\n              <h3 className=\"user_profile__meta__title\" dangerouslySetInnerHTML={{ __html: escapeWithEmoji(user.name) }}/>\n              <div className=\"user_profile__meta__message\">{message}</div>\n            </header>\n\n            {this.renderAbout()}\n\n            <footer className=\"row\">\n              <div className=\"col-xs\">\n                <button className=\"button button--green button--wide\" onClick={this.makeCall}>\n                  <i className=\"material-icons\">phone</i>\n                  <FormattedMessage id=\"button.call\"/>\n                </button>\n              </div>\n              <div style={{ width: 10 }}/>\n              <div className=\"col-xs\">\n                <div className={dropdownClassNames}>\n                  <button className=\"dropdown__button button button--flat button--wide\" onClick={this.toggleActionsDropdown}>\n                    <i className=\"material-icons\">more_horiz</i>\n                    <FormattedMessage id=\"actions\"/>\n                  </button>\n                  <ul className=\"dropdown__menu dropdown__menu--right\">\n                    {this.renderToggleContact()}\n                    <li className=\"dropdown__menu__item\" onClick={this.onBlockUser}>\n                      <FormattedMessage id=\"blockUser\"/>\n                    </li>\n                    <li className=\"dropdown__menu__item\" onClick={this.onClearChat}>\n                      <FormattedMessage id=\"clearConversation\"/>\n                    </li>\n                    <li className=\"dropdown__menu__item\" onClick={this.onDeleteChat}>\n                      <FormattedMessage id=\"deleteConversation\"/>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </footer>\n          </li>\n\n          <li className=\"profile__list__item user_profile__contact_info no-p\">\n            <ContactDetails peerInfo={user}/>\n          </li>\n\n          <li className=\"profile__list__item user_profile__notifications no-p\">\n            <ToggleNotifications\n              isNotificationsEnabled={isNotificationsEnabled}\n              onNotificationChange={this.onNotificationChange}/>\n          </li>\n\n        </ul>\n      </div>\n    );\n  }\n}\n\nexport default Container.create(UserProfile, { pure:false, withProps: true });\n"]}