{"version":3,"sources":["../../../src/components/sidebar/Recent.react.js"],"names":[],"mappings":"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","file":"Recent.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { forEach, throttle } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport GroupListActionCreators from '../../actions/GroupListActionCreators';\nimport ContactActionCreators from '../../actions/ContactActionCreators';\nimport CreateGroupActionCreators from '../../actions/CreateGroupActionCreators';\nimport AddContactActionCreators from '../../actions/AddContactActionCreators';\n\nimport CustomScroller from '../common/CustomScroller.react';\nimport RecentGroup from './RecentGroup.react';\nimport SidebarLink from './SidebarLink.react';\n\nclass Recent extends Component {\n  static propTypes = {\n    currentPeer: PropTypes.object,\n    dialogs: PropTypes.array.isRequired,\n    archive: PropTypes.object.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      haveUnreadAbove: false,\n      haveUnreadBelow: false,\n      lastUnreadBelow: null,\n      firstUnreadAbove: null\n    };\n\n    this.checkInvisibleCounters = throttle(this.checkInvisibleCounters.bind(this), 300);\n    this.scrollToFirstHiddenAbove = this.scrollToFirstHiddenAbove.bind(this);\n    this.scrollToLastHiddenBelow = this.scrollToLastHiddenBelow.bind(this);\n    this.handleGroupListTitleClick = this.handleGroupListTitleClick.bind(this);\n    this.handlePrivateListTitleClick = this.handlePrivateListTitleClick.bind(this);\n  }\n\n  handleGroupListTitleClick () {\n    GroupListActionCreators.open();\n  }\n\n  handlePrivateListTitleClick() {\n    ContactActionCreators.open();\n  }\n\n  handleAddContact() {\n    AddContactActionCreators.open();\n  }\n\n  handleCreateGroup() {\n    CreateGroupActionCreators.open();\n  }\n\n  checkInvisibleCounters() {\n    const { scroller } = this.refs;\n    const recentRect = scroller.getBoundingClientRect();\n    // TODO: refactor this\n    const unreadNodes = scroller.container.getElementsByClassName('recent__item--unread');\n\n    let haveUnreadAbove = false,\n        haveUnreadBelow = false,\n        lastUnreadBelow = null,\n        firstUnreadAbove = null;\n\n    forEach(unreadNodes, (node) => {\n      const rect = node.getBoundingClientRect();\n      if ((recentRect.top + recentRect.height) < rect.top) {\n        haveUnreadBelow = true;\n        lastUnreadBelow = node;\n      }\n      if (recentRect.top > (rect.top + rect.height)) {\n        haveUnreadAbove = true;\n        if (!firstUnreadAbove) {\n          firstUnreadAbove = node;\n        }\n      }\n    });\n\n    this.setState({ haveUnreadAbove, haveUnreadBelow, firstUnreadAbove, lastUnreadBelow });\n  }\n\n  scrollToFirstHiddenAbove() {\n    const { scroller } = this.refs;\n    const { firstUnreadAbove } = this.state;\n    const rect = firstUnreadAbove.getBoundingClientRect();\n    const dimensions = scroller.getDimensions();\n    const scrollerRect = scroller.getBoundingClientRect();\n\n    scroller.scrollTo(dimensions.scrollTop + rect.top - scrollerRect.top);\n  }\n\n  scrollToLastHiddenBelow() {\n    const { scroller } = this.refs;\n    const { lastUnreadBelow } = this.state;\n    const rect = lastUnreadBelow.getBoundingClientRect();\n    const dimensions = scroller.getDimensions();\n    const scrollerRect = scroller.getBoundingClientRect();\n\n    scroller.scrollTo(dimensions.scrollTop + rect.top - (scrollerRect.top + scrollerRect.height - rect.height));\n  }\n\n  getGroupProps(group) {\n    switch (group.key) {\n      case 'groups':\n        return {\n          onTitleClick: this.handleGroupListTitleClick,\n          onPlusClick: this.handleCreateGroup,\n          renderEmptyHint: this.renderGroupHint\n        };\n\n      case 'privates':\n        return {\n          onTitleClick: this.handlePrivateListTitleClick,\n          onPlusClick: this.handleAddContact,\n          renderEmptyHint: this.renderPrivateHint\n        };\n\n      default:\n        return {};\n    }\n  }\n\n  renderGroupHint() {\n    return (\n      <div className=\"recent__group__hint\">\n        <FormattedMessage id=\"sidebar.group.empty\"/>\n        <div className=\"stem\"/>\n      </div>\n    );\n  }\n\n  renderPrivateHint() {\n    return (\n      <div className=\"recent__group__hint\">\n        <FormattedMessage id=\"sidebar.private.empty\"/>\n        <button className=\"button button--outline button--wide hide\">\n          <FormattedMessage id=\"button.invite\"/>\n        </button>\n      </div>\n    );\n  }\n\n  renderRecentGroups() {\n    const { currentPeer, archive } = this.props;\n    return this.props.dialogs.map((group) => (\n      <RecentGroup\n        items={group.shorts}\n        key={group.key}\n        group={group.key}\n        currentPeer={currentPeer}\n        archive={archive}\n        {...this.getGroupProps(group)}\n        onItemUpdate={this.checkInvisibleCounters}\n      />\n    ));\n  }\n\n  renderUnreadAbove() {\n    if (!this.state.haveUnreadAbove) return null;\n\n    return (\n      <div className=\"recent__unread recent__unread--above\" onClick={this.scrollToFirstHiddenAbove}>\n        <i className=\"material-icons\">keyboard_arrow_up</i>\n      </div>\n    )\n  }\n\n  renderUnreadBelow() {\n    if (!this.state.haveUnreadBelow) return null;\n\n    return (\n      <div className=\"recent__unread recent__unread--below\" onClick={this.scrollToLastHiddenBelow}>\n        <i className=\"material-icons\">keyboard_arrow_down</i>\n      </div>\n    )\n  }\n\n  renderHistoryButton() {\n    // actually this is hack, but it's ok while we haven't real flag\n    const isArchiveEmpty = this.props.dialogs.some((group) => !group.shorts.length);\n    if (isArchiveEmpty) {\n      return null;\n    }\n\n    return (\n      <SidebarLink\n        className=\"sidebar__history\"\n        to=\"/im/history\"\n        title={<FormattedMessage id=\"sidebar.recents.history\" />}\n        glyph=\"history\"\n        key=\"history\"\n      />\n    );\n  }\n\n  renderScrollableContent() {\n    return [\n      this.renderRecentGroups(),\n      this.renderHistoryButton()\n    ];\n  }\n\n  render() {\n    return (\n      <section className=\"recent\">\n        {this.renderUnreadAbove()}\n        <CustomScroller\n          className=\"recent__container\"\n          ref=\"scroller\"\n          onScroll={this.checkInvisibleCounters}\n          onResize={this.checkInvisibleCounters}\n        >\n          {this.renderScrollableContent()}\n        </CustomScroller>\n        {this.renderUnreadBelow()}\n      </section>\n    );\n  }\n}\n\nexport default Recent;\n"]}