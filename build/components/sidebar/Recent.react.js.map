{"version":3,"sources":["../../../src/components/sidebar/Recent.react.js"],"names":[],"mappings":"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","file":"Recent.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { forEach, map, debounce } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Link } from 'react-router';\nimport { FormattedMessage } from 'react-intl';\nimport  classnames from 'classnames';\nimport PeerUtils from '../../utils/PeerUtils';\n\nimport CreateGroupActionCreators from '../../actions/CreateGroupActionCreators';\nimport ContactActionCreators from '../../actions/ContactActionCreators';\nimport GroupListActionCreators from '../../actions/GroupListActionCreators';\nimport AddContactActionCreators from '../../actions/AddContactActionCreators';\n\nimport Tooltip from 'rc-tooltip';\nimport Scrollbar from '../common/Scrollbar.react';\nimport RecentItem from './RecentItem.react';\n\nclass Recent extends Component {\n  constructor(props) {\n    super(props);\n\n    this.checkInvisibleCounters = debounce(this.checkInvisibleCounters, 50, {\n      maxWait: 150,\n      leading: true\n    });\n\n    this.state = {\n      haveUnreadAbove: false,\n      haveUnreadBelow: false,\n      lastUnreadBelow: null,\n      firstUnreadAbove: null\n    };\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  static propTypes = {\n    currentPeer: PropTypes.object,\n    dialogs: PropTypes.array.isRequired,\n    archive: PropTypes.object.isRequired\n  };\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.dialogs !== this.props.dialogs) {\n      this.checkInvisibleCounters();\n    }\n  }\n\n  handleCreateGroup = () => CreateGroupActionCreators.open();\n\n  handleCreatePrivate = () => AddContactActionCreators.open();\n\n  handleGroupListClick = () => GroupListActionCreators.open();\n\n  handlePrivateListClick = () => ContactActionCreators.open();\n\n  handleRecentScroll = () => this.checkInvisibleCounters();\n\n  checkInvisibleCounters = () => {\n    const unreadNodes = document.getElementsByClassName('sidebar__list__item--unread');\n    const scrollNode = findDOMNode(this.refs.container);\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    let haveUnreadAbove = false,\n        haveUnreadBelow = false,\n        lastUnreadBelow = null,\n        firstUnreadAbove = null;\n\n    forEach(unreadNodes, (node) => {\n      const rect = node.getBoundingClientRect();\n      if ((scrollNodeRect.top + scrollNodeRect.height) < rect.top) {\n        haveUnreadBelow = true;\n        lastUnreadBelow = node;\n      }\n      if (scrollNodeRect.top > (rect.top + rect.height)) {\n        haveUnreadAbove = true;\n        if (!firstUnreadAbove) {\n          firstUnreadAbove = node;\n        }\n      }\n    });\n\n    this.setState({ haveUnreadAbove, haveUnreadBelow, firstUnreadAbove, lastUnreadBelow });\n  };\n\n  scrollToFirstHiddenAbove = () => {\n    const { firstUnreadAbove } = this.state;\n    const rect = firstUnreadAbove.getBoundingClientRect();\n    const scrollNode = findDOMNode(this.refs.container).getElementsByClassName('ss-scrollarea')[0];\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    this.refs.container.scrollTo(scrollNode.scrollTop + rect.top - scrollNodeRect.top)\n  };\n\n  scrollToLastHiddenBelow = () => {\n    const { lastUnreadBelow } = this.state;\n    const rect = lastUnreadBelow.getBoundingClientRect();\n    const scrollNode = findDOMNode(this.refs.container).getElementsByClassName('ss-scrollarea')[0];\n    const scrollNodeRect = scrollNode.getBoundingClientRect();\n\n    this.refs.container.scrollTo(scrollNode.scrollTop + rect.top - (scrollNodeRect.top + scrollNodeRect.height - rect.height));\n  };\n\n  render() {\n    const { dialogs, archive, currentPeer } = this.props;\n    const { haveUnreadAbove, haveUnreadBelow } = this.state;\n    const { intl } = this.context;\n\n    const recentGroups = map(dialogs, (dialogGroup, index) => {\n      const isEmpty = dialogGroup.shorts.length === 0;\n      let groupTitle;\n\n      switch (dialogGroup.key) {\n        case 'groups':\n          groupTitle = (\n            <li className=\"sidebar__list__title\">\n              <Tooltip\n                placement=\"right\"\n                mouseEnterDelay={0.15} mouseLeaveDelay={0}\n                overlay={<FormattedMessage id=\"tooltip.recent.groupList\"/>}\n              >\n                <a onClick={this.handleGroupListClick}>\n                  <FormattedMessage id={`sidebar.recents.${dialogGroup.key}`}/>\n                </a>\n              </Tooltip>\n              <Tooltip\n                placement=\"top\"\n                mouseEnterDelay={0.15} mouseLeaveDelay={0}\n                overlay={<FormattedMessage id=\"tooltip.recent.createGroup\"/>}\n              >\n                <i className=\"material-icons sidebar__list__title__icon pull-right\"\n                   onClick={this.handleCreateGroup}>add_circle_outline</i>\n              </Tooltip>\n            </li>\n          );\n          break;\n        case 'privates':\n          groupTitle = (\n            <li className=\"sidebar__list__title\">\n              <Tooltip\n                placement=\"right\"\n                mouseEnterDelay={0.15} mouseLeaveDelay={0}\n                overlay={<FormattedMessage id=\"tooltip.recent.privateList\"/>}\n              >\n                <a onClick={this.handlePrivateListClick}>\n                  <FormattedMessage id={`sidebar.recents.${dialogGroup.key}`}/>\n                </a>\n              </Tooltip>\n              <Tooltip\n                placement=\"top\"\n                mouseEnterDelay={0.15} mouseLeaveDelay={0}\n                overlay={<FormattedMessage id=\"tooltip.recent.addContact\"/>}\n              >\n                <i className=\"material-icons sidebar__list__title__icon pull-right\"\n                   onClick={this.handleCreatePrivate}>add_circle_outline</i>\n               </Tooltip>\n            </li>\n          );\n          break;\n        default:\n          groupTitle = <li className=\"sidebar__list__title\">{intl.messages[`sidebar.recents.${dialogGroup.key}`]}</li>;\n      }\n\n      const groupList = map(dialogGroup.shorts, (dialog) => {\n        const peer = dialog.peer.peer;\n        const peerKey = PeerUtils.peerToString(peer);\n\n        return (\n          <RecentItem\n            dialog={dialog}\n            archiveState={archive[peerKey]}\n            isActive={PeerUtils.equals(peer, currentPeer)}\n            key={peerKey}\n          />\n        );\n      });\n\n      const groupClassname = classnames(`sidebar__list sidebar__list--${dialogGroup.key}`, {\n       'sidebar__list--empty': isEmpty\n      });\n\n      const getEmptyMessage = () => {\n        switch (dialogGroup.key) {\n          case 'groups':\n            return (\n              <li className=\"sidebar__list__item sidebar__list__item--empty\">\n                <FormattedMessage id=\"sidebar.group.empty\"/>\n                <div className=\"stem\"/>\n              </li>\n            );\n          case 'privates':\n            return (\n              <li className=\"sidebar__list__item sidebar__list__item--empty\">\n                <FormattedMessage id=\"sidebar.private.empty\"/>\n                <button className=\"button button--outline button--wide hide\">\n                  <FormattedMessage id=\"button.invite\"/>\n                </button>\n              </li>\n            );\n          default:\n            return null;\n        }\n      };\n\n      return (\n        <ul className={groupClassname} key={index}>\n          {groupTitle}\n          {\n            isEmpty\n              ? getEmptyMessage()\n              : groupList\n          }\n        </ul>\n      )\n    });\n\n    return (\n      <section className=\"sidebar__recent\">\n        {\n          haveUnreadAbove\n            ? <div className=\"sidebar__recent__unread sidebar__recent__unread--above\" onClick={this.scrollToFirstHiddenAbove}>\n                <i className=\"material-icons\">keyboard_arrow_up</i>\n              </div>\n            : null\n        }\n        <Scrollbar ref=\"container\" onScroll={this.handleRecentScroll}>\n          <div>\n            {recentGroups}\n\n            <footer>\n              <Link to=\"/im/archive\" className=\"button button--rised button--wide\">\n                <FormattedMessage id=\"button.archive\"/>\n              </Link>\n            </footer>\n          </div>\n        </Scrollbar>\n        {\n          haveUnreadBelow\n            ? <div className=\"sidebar__recent__unread sidebar__recent__unread--below\" onClick={this.scrollToLastHiddenBelow}>\n                <i className=\"material-icons\">keyboard_arrow_down</i>\n              </div>\n            : null\n        }\n      </section>\n    );\n  }\n}\n\nexport default Recent;\n"]}