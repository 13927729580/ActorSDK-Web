{"version":3,"sources":["../../src/components/Dialog.react.js"],"names":[],"mappings":"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","file":"Dialog.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { isFunction } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\n\nimport PeerUtils from '../utils/PeerUtils';\n\nimport DefaultMessages from './dialog/MessagesSection.react';\nimport DialogFooter from './dialog/DialogFooter.react';\nimport DefaultToolbar from './Toolbar.react';\nimport DefaultActivity from './Activity.react';\nimport DefaultSearch from './search/SearchSection.react';\nimport DefaultCall from './Call.react';\nimport ConnectionState from './common/ConnectionState.react';\n\nimport ActivityStore from '../stores/ActivityStore';\nimport DialogStore from '../stores/DialogStore';\n\nimport DialogActionCreators from '../actions/DialogActionCreators';\n\nclass DialogSection extends Component {\n  static contextTypes = {\n    router: PropTypes.object.isRequired,\n    delegate: PropTypes.object.isRequired\n  };\n\n  static propTypes = {\n    params: PropTypes.shape({\n      id: PropTypes.string.isRequired\n    }).isRequired\n  };\n\n  static getStores() {\n    return [ActivityStore, DialogStore];\n  }\n\n  static calculateState() {\n    return {\n      peer: DialogStore.getCurrentPeer(),\n      isMember: DialogStore.isMember(),\n      isActivityOpen: ActivityStore.isOpen()\n    };\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.updatePeer(this.props.params.id);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.params.id !== this.props.params.id) {\n      this.updatePeer(nextProps.params.id);\n    }\n  }\n\n  componentWillUnmount() {\n    DialogActionCreators.selectDialogPeer(null);\n  }\n\n  updatePeer(id) {\n    const peer = PeerUtils.stringToPeer(id);\n    if (PeerUtils.hasPeer(peer)) {\n      DialogActionCreators.selectDialogPeer(peer);\n    } else {\n      this.context.router.replace('/im');\n    }\n  }\n\n  getActivityComponents() {\n    const { features, components: { dialog } } = this.context.delegate;\n    if (dialog && dialog.activity) {\n      return dialog.activity;\n    }\n\n    const activity = [DefaultActivity];\n    if (features.calls) {\n      activity.push(DefaultCall);\n    }\n\n    if (features.search) {\n      activity.push(DefaultSearch);\n    }\n\n    return activity;\n  }\n\n  getComponents() {\n    const { dialog } = this.context.delegate.components;\n    const activity = this.getActivityComponents();\n\n    if (dialog && !isFunction(dialog)) {\n      return {\n        activity,\n        ToolbarSection: dialog.toolbar || DefaultToolbar,\n        MessagesSection: isFunction(dialog.messages) ? dialog.messages : DefaultMessages\n      };\n    }\n\n    return {\n      activity,\n      ToolbarSection: DefaultToolbar,\n      MessagesSection: DefaultMessages\n    };\n  }\n\n  render() {\n    const { peer, isMember } = this.state;\n    if (!peer) {\n      return <section className=\"main\" />;\n    }\n\n    const {\n      ToolbarSection,\n      MessagesSection,\n      activity\n    } = this.getComponents();\n\n    return (\n      <section className=\"main\">\n        <ToolbarSection />\n        <div className=\"flexrow\">\n          <section className=\"dialog\">\n            <ConnectionState/>\n            <MessagesSection peer={peer} isMember={isMember} />\n            <DialogFooter isMember={isMember} />\n          </section>\n          {activity.map((Activity, index) => <Activity key={index} />)}\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(DialogSection, {withProps: true});\n"]}