{"version":3,"sources":["../../src/components/Dialog.react.js"],"names":[],"mappings":"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","file":"Dialog.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map, isFunction } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport PeerUtils from '../utils/PeerUtils';\n\nimport DefaultMessages from './dialog/MessagesSection.react';\nimport DefaultTyping from './dialog/TypingSection.react';\nimport DefaultCompose from './dialog/ComposeSection.react';\nimport DialogFooter from './dialog/DialogFooter.react';\nimport DefaultToolbar from './Toolbar.react';\nimport DefaultActivity from './Activity.react';\nimport DefaultCall from './Call.react';\nimport DefaultLogger from './dev/LoggerSection.react';\nimport ConnectionState from './common/ConnectionState.react';\n\nimport ActivityStore from '../stores/ActivityStore';\nimport DialogStore from '../stores/DialogStore';\nimport MessageStore from '../stores/MessageStore';\n\nimport DialogActionCreators from '../actions/DialogActionCreators';\n\nclass DialogSection extends Component {\n  static contextTypes = {\n    delegate: PropTypes.object\n  };\n\n  static propTypes = {\n    params: PropTypes.object\n  };\n\n  static getStores() {\n    return [ActivityStore, MessageStore, DialogStore]\n  }\n\n  static calculateState() {\n    return {\n      peer: DialogStore.getCurrentPeer(),\n      isMember: DialogStore.isMember(),\n      messages: MessageStore.getMessages(),\n      overlay: MessageStore.getOverlay(),\n      messagesCount: MessageStore.getRenderMessagesCount(),\n      isActivityOpen: ActivityStore.isOpen()\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    const peer = PeerUtils.stringToPeer(props.params.id);\n    DialogActionCreators.selectDialogPeer(peer);\n\n    this.onLoadMoreMessages = this.onLoadMoreMessages.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { params } = nextProps;\n    if (this.props.params.id === params.id) {\n      return;\n    }\n\n    const peer = PeerUtils.stringToPeer(params.id);\n    DialogActionCreators.selectDialogPeer(peer);\n  }\n\n  componentWillUnmount() {\n    // Unbind from current peer\n    DialogActionCreators.selectDialogPeer(null);\n  }\n\n  onLoadMoreMessages() {\n    const { peer } = this.state;\n    if (peer) {\n      DialogActionCreators.loadMoreMessages(peer);\n    }\n  }\n\n  getComponents() {\n    const { dialog, logger } = this.context.delegate.components;\n    const LoggerSection = logger || DefaultLogger;\n    if (dialog && !isFunction(dialog)) {\n      const activity = dialog.activity || [\n        DefaultActivity,\n        DefaultCall,\n        LoggerSection\n      ];\n\n      return {\n        LoggerSection,\n        ToolbarSection: dialog.toolbar || DefaultToolbar,\n        MessagesSection: isFunction(dialog.messages) ? dialog.messages : DefaultMessages,\n        TypingSection: dialog.typing || DefaultTyping,\n        ComposeSection: dialog.compose || DefaultCompose,\n        activity: map(activity, (Activity, index) => <Activity key={index} />)\n      };\n    }\n\n    return {\n      LoggerSection,\n      ToolbarSection: DefaultToolbar,\n      MessagesSection: DefaultMessages,\n      TypingSection: DefaultTyping,\n      ComposeSection: DefaultCompose,\n      activity: [\n        <DefaultActivity key={1} />,\n        <DefaultCall key={2} />,\n        <LoggerSection key={3} />\n      ]\n    };\n  }\n\n  render() {\n    const { peer, isMember, messages, overlay, messagesCount } = this.state;\n\n    const {\n      ToolbarSection,\n      MessagesSection,\n      TypingSection,\n      ComposeSection,\n      activity\n    } = this.getComponents();\n\n    return (\n      <section className=\"main\">\n        <ToolbarSection />\n        <div className=\"flexrow\">\n          <section className=\"dialog\">\n            <ConnectionState/>\n            <MessagesSection\n              peer={peer}\n              messages={messages}\n              overlay={overlay}\n              count={messagesCount}\n              isMember={isMember}\n              onLoadMore={this.onLoadMoreMessages}\n            />\n            <DialogFooter isMember={isMember} components={{TypingSection, ComposeSection}} />\n          </section>\n          {activity}\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(DialogSection);\n"]}