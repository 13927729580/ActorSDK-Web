{"version":3,"sources":["../../src/components/Dialog.react.js"],"names":[],"mappings":";;;;;;AAIA;;AACA;;;;AACA;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;IAEM,M;;;SAOG,S,wBAAY;AACjB,WAAO,sJAAP;AACD,G;;SAEM,c,6BAAiB;AACtB,QAAM,OAAO,sBAAY,cAAZ,EAAb;AACA,QAAM,aAAa,0BAAgB,QAAhB,EAAnB;;AAEA,WAAO;AACL,gBADK;AAEL,4BAFK;AAGL,WAAK,oBAAU,OAAV,EAHA;AAIL,gBAAU,sBAAY,QAAZ,EAJL;AAKL,sBAAgB,wBAAc,MAAd,EALX;AAML,eAAS,sBAAY,UAAZ,EANJ;AAOL,kBAAY,sBAAY,UAAZ,CAAuB,KAAK,EAA5B,CAPP;AAQL,YAAM,OAAO,kBAAP,CAA0B,IAA1B,CARD;AASL,cAAQ,8BAAoB,QAApB;AATH,KAAP;AAWD,G;;SAEM,kB,+BAAmB,I,EAAM;AAC9B,QAAM,OAAO,oBAAU,QAAV,EAAb;;AAEA,QAAI,CAAC,KAAK,MAAN,IAAgB,CAAC,oBAAU,MAAV,CAAiB,IAAjB,EAAuB,KAAK,IAA5B,CAArB,EAAwD;AACtD,aAAO;AACL,mBAAW;AADN,OAAP;AAGD;;AAED,wBACK,IADL;AAEE,iBAAW;AAFb;AAID,G;;AAED,kBAAY,KAAZ,EAAmB,OAAnB,EAA4B;AAAA;;AAAA,iDAC1B,sBAAM,KAAN,EAAa,OAAb,CAD0B;;AAE1B,UAAK,UAAL,CAAgB,MAAK,KAAL,CAAW,MAAX,CAAkB,EAAlC;;AAEA,UAAK,gBAAL,GAAwB,MAAK,gBAAL,CAAsB,IAAtB,OAAxB;AACA,UAAK,aAAL,GAAqB,MAAK,aAAL,CAAmB,IAAnB,OAArB;AACA,UAAK,wBAAL,GAAgC,MAAK,wBAAL,CAA8B,IAA9B,OAAhC;AACA,UAAK,wBAAL,GAAgC,MAAK,wBAAL,CAA8B,IAA9B,OAAhC;;AAEA,UAAK,UAAL,GAAkB,MAAK,aAAL,EAAlB;AAT0B;AAU3B;;mBAED,yB,sCAA0B,S,EAAW;AACnC,QAAI,UAAU,MAAV,CAAiB,EAAjB,KAAwB,KAAK,KAAL,CAAW,MAAX,CAAkB,EAA9C,EAAkD;AAChD,WAAK,UAAL,CAAgB,UAAU,MAAV,CAAiB,EAAjC;AACD;AACF,G;;mBAED,oB,mCAAuB;AACrB,mCAAqB,gBAArB,CAAsC,IAAtC;AACD,G;;mBAED,U,uBAAW,E,EAAI;AACb,QAAM,OAAO,oBAAU,YAAV,CAAuB,EAAvB,CAAb;AACA,QAAI,oBAAU,OAAV,CAAkB,IAAlB,CAAJ,EAA6B;AAC3B,qCAAqB,gBAArB,CAAsC,IAAtC;AACD,KAFD,MAEO;AACL,wBAAQ,OAAR,CAAgB,KAAhB;AACD;AACF,G;;mBAED,gB,+BAAmB;AAAA,QACT,IADS,GACA,KAAK,KADL,CACT,IADS;;AAEjB,oCAAsB,eAAtB,CAAsC,IAAtC,EAA4C,QAA5C;AACD,G;;mBAED,a,4BAAgB;AAAA,QACN,UADM,GACS,KAAK,KADd,CACN,UADM;;AAEd,yCAA2B,WAA3B,CAAuC,WAAW,EAAlD;AACD,G;;mBAED,wB,qCAAyB,K,EAAO;AAC9B,2CAA6B,QAA7B,CAAsC,KAAtC;AACD,G;;mBAED,wB,uCAA2B;AACzB,2CAA6B,KAA7B;AACD,G;;mBAED,qB,oCAAwB;AAAA,gCACW,4BAAkB,GAAlB,EADX;;AAAA,QACd,QADc,yBACd,QADc;AAAA,QACJ,UADI,yBACJ,UADI;AAAA,QAEd,MAFc,GAEH,UAFG,CAEd,MAFc;;;AAItB,QAAI,UAAU,OAAO,QAArB,EAA+B;AAC7B,aAAO,OAAO,QAAd;AACD;;AAED,QAAM,WAAW,oBAAjB;AACA,QAAI,SAAS,KAAb,EAAoB;AAClB,eAAS,IAAT;AACD;;AAED,WAAO,QAAP;AACD,G;;mBAED,a,4BAAgB;AAAA,iCACqB,4BAAkB,GAAlB,EADrB;;AAAA,QACQ,MADR,0BACN,UADM,CACQ,MADR;;AAEd,QAAM,WAAW,KAAK,qBAAL,EAAjB;;AAEA,QAAI,UAAU,CAAC,wBAAW,MAAX,CAAf,EAAmC;AACjC,aAAO;AACL,0BADK;AAEL,sBAAc,wBAAW,OAAO,MAAlB,IAA4B,OAAO,MAAnC,yBAFT;AAGL,yBAAiB,wBAAW,OAAO,QAAlB,IAA8B,OAAO,QAArC,4BAHZ;AAIL,sBAAc,wBAAW,OAAO,MAAlB,IAA4B,OAAO,MAAnC;AAJT,OAAP;AAMD;;AAED,WAAO;AACL,wBADK;AAEL,0CAFK;AAGL,gDAHK;AAIL;AAJK,KAAP;AAMD,G;;mBAED,gB,+BAAmB;AAAA,QACT,QADS,GACI,KAAK,UADT,CACT,QADS;;AAEjB,WAAO,SAAS,GAAT,CAAa,UAAC,QAAD,EAAW,KAAX;AAAA,aAAqB,8BAAC,QAAD,IAAU,KAAK,KAAf,GAArB;AAAA,KAAb,CAAP;AACD,G;;mBAED,kB,iCAAqB;AAAA,QACX,MADW,GACA,KAAK,KADL,CACX,MADW;;;AAGnB,WACE;AACE,cAAQ,OAAO,MADjB;AAEE,aAAO,OAAO,KAFhB;AAGE,gBAAU,KAAK,wBAHjB;AAIE,gBAAU,KAAK;AAJjB,MADF;AAQD,G;;mBAED,a,4BAAgB;AAAA,iBACsC,KAAK,KAD3C;AAAA,QACN,GADM,UACN,GADM;AAAA,QACD,IADC,UACD,IADC;AAAA,QACK,QADL,UACK,QADL;AAAA,QACe,UADf,UACe,UADf;AAAA,QAC2B,MAD3B,UAC2B,MAD3B;AAAA,sBAE4B,KAAK,UAFjC;AAAA,QAEN,eAFM,eAEN,eAFM;AAAA,QAEW,YAFX,eAEW,YAFX;;;AAId,QAAI,OAAO,MAAX,EAAmB;AACjB,aACE;AACE,eAAO,OAAO,KADhB;AAEE,iBAAS,OAAO,OAFlB;AAGE,qBAAa,OAAO;AAHtB,QADF;AAOD;;AAED,WACE;AAAA;AAAA,QAAK,WAAU,MAAf;AACE,oCAAC,eAAD;AACE,aAAK,GADP;AAEE,cAAM,IAFR;AAGE,kBAAU;AAHZ,QADF;AAME,oCAAC,YAAD;AACE,cAAM,UADR;AAEE,kBAAU,QAFZ;AAGE,mBAAW,KAAK,aAHlB;AAIE,iBAAS,KAAK;AAJhB;AANF,KADF;AAeD,G;;mBAED,M,qBAAS;AAAA,kBACyE,KAAK,KAD9E;AAAA,QACC,IADD,WACC,IADD;AAAA,QACO,UADP,WACO,UADP;AAAA,QACmB,OADnB,WACmB,OADnB;AAAA,QAC4B,UAD5B,WAC4B,UAD5B;AAAA,QACwC,IADxC,WACwC,IADxC;AAAA,QAC8C,cAD9C,WAC8C,cAD9C;AAAA,QAC8D,MAD9D,WAC8D,MAD9D;AAAA,QAEC,YAFD,GAEkB,KAAK,UAFvB,CAEC,YAFD;;;AAIP,QAAI,CAAC,IAAL,EAAW;AACT,aAAO,2CAAS,WAAU,MAAnB,GAAP;AACD;;AAED,WACE;AAAA;AAAA,QAAS,WAAU,MAAnB;AACE,oCAAC,YAAD;AACE,cAAM,UADR;AAEE,iBAAS,OAFX;AAGE,cAAM,IAHR;AAIE,cAAM,IAJR;AAKE,oBAAY,UALd;AAME,4BAAoB,OAAO,MAN7B;AAOE,wBAAgB;AAPlB,QADF;AAUG,WAAK,kBAAL,EAVH;AAWE;AAAA;AAAA,UAAK,WAAU,SAAf;AACE;AAAA;AAAA,YAAS,WAAU,QAAnB;AACG,eAAK,aAAL;AADH,SADF;AAIG,aAAK,gBAAL;AAJH;AAXF,KADF;AAoBD,G;;;;;AA9MG,M,CACG,S,GAAY;AACjB,UAAQ,iBAAU,KAAV,CAAgB;AACtB,QAAI,iBAAU,MAAV,CAAiB;AADC,GAAhB,EAEL;AAHc,C;kBAgNN,iBAAU,MAAV,CAAiB,MAAjB,EAAyB,EAAE,WAAW,IAAb,EAAzB,C","file":"Dialog.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { isFunction } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport DelegateContainer from '../utils/DelegateContainer';\n\nimport PeerUtils from '../utils/PeerUtils';\nimport history from '../utils/history';\n\nimport DefaultMessages from './dialog/MessagesSection.react';\nimport DefaultDialogHeader from './dialog/DialogHeader.react';\nimport DefaultDialogFooter from './dialog/DialogFooter.react';\nimport DefaultActivity from './Activity.react';\nimport DefaultCall from './Call.react';\nimport DialogSearch from './search/DialogSearch.react';\nimport SearchResults from './search/SearchResults.react';\n\nimport UserStore from '../stores/UserStore';\nimport DialogStore from '../stores/DialogStore';\nimport DialogInfoStore from '../stores/DialogInfoStore';\nimport ActivityStore from '../stores/ActivityStore';\nimport OnlineStore from '../stores/OnlineStore';\nimport CallStore from '../stores/CallStore';\nimport SearchMessagesStore from '../stores/SearchMessagesStore'\n\nimport DialogActionCreators from '../actions/DialogActionCreators';\nimport MessageActionCreators from '../actions/MessageActionCreators';\nimport BlockedUsersActionCreators from '../actions/BlockedUsersActionCreators';\nimport SearchMessagesActionCreators from '../actions/SearchMessagesActionCreators';\n\nclass Dialog extends Component {\n  static propTypes = {\n    params: PropTypes.shape({\n      id: PropTypes.string.isRequired\n    }).isRequired\n  };\n\n  static getStores() {\n    return [ActivityStore, DialogStore, DialogInfoStore, OnlineStore, CallStore, SearchMessagesStore];\n  }\n\n  static calculateState() {\n    const peer = DialogStore.getCurrentPeer();\n    const dialogInfo = DialogInfoStore.getState();\n\n    return {\n      peer,\n      dialogInfo,\n      uid: UserStore.getMyId(),\n      isMember: DialogStore.isMember(),\n      isActivityOpen: ActivityStore.isOpen(),\n      message: OnlineStore.getMessage(),\n      isFavorite: DialogStore.isFavorite(peer.id),\n      call: Dialog.calculateCallState(peer),\n      search: SearchMessagesStore.getState()\n    };\n  }\n\n  static calculateCallState(peer) {\n    const call = CallStore.getState();\n\n    if (!call.isOpen || !PeerUtils.equals(peer, call.peer)) {\n      return {\n        isCalling: false\n      };\n    }\n\n    return {\n      ...call,\n      isCalling: true\n    };\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.updatePeer(this.props.params.id);\n\n    this.handleStartClick = this.handleStartClick.bind(this);\n    this.handleUnblock = this.handleUnblock.bind(this);\n    this.handleDialogSearchCancel = this.handleDialogSearchCancel.bind(this);\n    this.handleDialogSearchChange = this.handleDialogSearchChange.bind(this);\n\n    this.components = this.getComponents();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.params.id !== this.props.params.id) {\n      this.updatePeer(nextProps.params.id);\n    }\n  }\n\n  componentWillUnmount() {\n    DialogActionCreators.selectDialogPeer(null);\n  }\n\n  updatePeer(id) {\n    const peer = PeerUtils.stringToPeer(id);\n    if (PeerUtils.hasPeer(peer)) {\n      DialogActionCreators.selectDialogPeer(peer);\n    } else {\n      history.replace('/im');\n    }\n  }\n\n  handleStartClick() {\n    const { peer } = this.state;\n    MessageActionCreators.sendTextMessage(peer, '/start');\n  }\n\n  handleUnblock() {\n    const { dialogInfo } = this.state;\n    BlockedUsersActionCreators.unblockUser(dialogInfo.id);\n  }\n\n  handleDialogSearchChange(query) {\n    SearchMessagesActionCreators.setQuery(query);\n  }\n\n  handleDialogSearchCancel() {\n    SearchMessagesActionCreators.close();\n  }\n\n  getActivityComponents() {\n    const { features, components } = DelegateContainer.get();\n    const { dialog } = components;\n\n    if (dialog && dialog.activity) {\n      return dialog.activity;\n    }\n\n    const activity = [DefaultActivity];\n    if (features.calls) {\n      activity.push(DefaultCall);\n    }\n\n    return activity;\n  }\n\n  getComponents() {\n    const { components: { dialog } } = DelegateContainer.get();\n    const activity = this.getActivityComponents();\n\n    if (dialog && !isFunction(dialog)) {\n      return {\n        activity,\n        DialogHeader: isFunction(dialog.header) ? dialog.header : DefaultDialogHeader,\n        MessagesSection: isFunction(dialog.messages) ? dialog.messages : DefaultMessages,\n        DialogFooter: isFunction(dialog.footer) ? dialog.footer : DefaultDialogFooter\n      };\n    }\n\n    return {\n      activity,\n      DialogHeader: DefaultDialogHeader,\n      MessagesSection: DefaultMessages,\n      DialogFooter: DefaultDialogFooter\n    };\n  }\n\n  renderActivities() {\n    const { activity } = this.components;\n    return activity.map((Activity, index) => <Activity key={index} />)\n  }\n\n  renderDialogSearch() {\n    const { search } = this.state;\n\n    return (\n      <DialogSearch\n        isOpen={search.isOpen}\n        query={search.query}\n        onCancel={this.handleDialogSearchCancel}\n        onChange={this.handleDialogSearchChange}\n      />\n    )\n  }\n\n  renderContent() {\n    const { uid, peer, isMember, dialogInfo, search } = this.state;\n    const { MessagesSection, DialogFooter } = this.components;\n\n    if (search.isOpen) {\n      return (\n        <SearchResults\n          query={search.query}\n          results={search.results}\n          isSearching={search.isSearching}\n        />\n      );\n    }\n\n    return (\n      <div className=\"chat\">\n        <MessagesSection\n          uid={uid}\n          peer={peer}\n          isMember={isMember}\n        />\n        <DialogFooter\n          info={dialogInfo}\n          isMember={isMember}\n          onUnblock={this.handleUnblock}\n          onStart={this.handleStartClick}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const { peer, dialogInfo, message, isFavorite, call, isActivityOpen, search } = this.state;\n    const { DialogHeader } = this.components;\n\n    if (!peer) {\n      return <section className=\"main\" />;\n    }\n\n    return (\n      <section className=\"main\">\n        <DialogHeader\n          info={dialogInfo}\n          message={message}\n          call={call}\n          peer={peer}\n          isFavorite={isFavorite}\n          isDialogSearchOpen={search.isOpen}\n          isActivityOpen={isActivityOpen}\n        />\n        {this.renderDialogSearch()}\n        <div className=\"flexrow\">\n          <section className=\"dialog\">\n            {this.renderContent()}\n          </section>\n          {this.renderActivities()}\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Dialog, { withProps: true });\n"]}