{"version":3,"sources":["../../../src/components/modals/MyProfile.react.js"],"names":[],"mappings":"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","file":"MyProfile.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component } from 'react';\nimport { Container } from 'flux/utils';\nimport Modal from 'react-modal';\nimport ReactMixin from 'react-mixin';\nimport { IntlMixin } from 'react-intl';\n\nimport ActorClient from '../../utils/ActorClient';\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport MyProfileActions from '../../actions/MyProfileActionCreators';\nimport CropAvatarActionCreators from '../../actions/CropAvatarActionCreators';\n\nimport MyProfileStore from '../../stores/MyProfileStore';\nimport CropAvatarStore from '../../stores/CropAvatarStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport CropAvatarModal from './CropAvatar.react';\n\nimport TextField from '../common/TextField.react';\n\nlet currentName = '',\n    currentNick = '',\n    currentAbout = '';\n\nclass MyProfile extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  static getStores = () => [MyProfileStore, CropAvatarStore];\n\n  static calculateState() {\n    return {\n      profile: MyProfileStore.getProfile(),\n      name: MyProfileStore.getName(),\n      nick: MyProfileStore.getNick(),\n      about: MyProfileStore.getAbout(),\n      isOpen: MyProfileStore.isModalOpen(),\n      isCropModalOpen: CropAvatarStore.isOpen()\n    };\n  }\n\n  componentWillMount() {\n    const { name, nick, about } = this.state;\n\n    currentName = name;\n    currentNick = nick;\n    currentAbout = about;\n\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.removeListeners();\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.isOpen) {\n      if (nextState.isCropModalOpen) {\n        this.removeListeners();\n      } else {\n        this.setListeners();\n      }\n    }\n  }\n\n  setListeners = () => document.addEventListener('keydown', this.onKeyDown, false);\n  removeListeners = () => document.removeEventListener('keydown', this.onKeyDown, false);\n\n  handleClose = () => MyProfileActions.hide();\n\n  onKeyDown = event => {\n    if (event.keyCode === KeyCodes.ESC) {\n      event.preventDefault();\n      this.handleClose();\n    }\n  };\n\n  handleNameChange = event => this.setState({name: event.target.value});\n  handleNicknameChange = event => this.setState({nick: event.target.value});\n  handleAboutChange = event => this.setState({about: event.target.value});\n\n  isProfileChanged = () => {\n    const { name, nick, about } = this.state;\n    return name !== currentName || nick !== currentNick || about !== currentAbout\n  };\n\n  handleSave = () => {\n    const { nick, name, about } = this.state;\n\n    if (name !== currentName) MyProfileActions.saveName(name);\n    if (nick !== currentNick) MyProfileActions.saveNickname(nick);\n    if (about !== currentAbout) MyProfileActions.editMyAbout(about);\n\n    this.handleClose();\n  };\n\n  onProfilePictureInputChange = () => {\n    const imageInput = React.findDOMNode(this.refs.imageInput);\n    const imageForm = React.findDOMNode(this.refs.imageForm);\n    const file = imageInput.files[0];\n\n    let reader = new FileReader();\n    reader.onload = (event) => {\n      CropAvatarActionCreators.show(event.target.result);\n      imageForm.reset();\n    };\n    reader.readAsDataURL(file);\n  };\n\n  handleChangeAvatarClick = () => {\n    const imageInput = React.findDOMNode(this.refs.imageInput);\n    imageInput.click()\n  };\n\n  onProfilePictureRemove = () => MyProfileActions.removeMyAvatar();\n\n  changeMyAvatar = (croppedImage) => MyProfileActions.changeMyAvatar(croppedImage);\n\n  render() {\n    const { isOpen, isCropModalOpen, profile, nick, name, about } = this.state;\n    const isProfileChanged = this.isProfileChanged();\n\n    const cropAvatar = isCropModalOpen ? <CropAvatarModal onCropFinish={this.changeMyAvatar}/> : null;\n\n    if (profile !== null && isOpen) {\n      return (\n        <Modal className=\"modal-new modal-new--profile\"\n               closeTimeoutMS={150}\n               isOpen={isOpen}\n               style={{width: 440}}>\n\n          <header className=\"modal-new__header\">\n            <a className=\"modal-new__header__icon material-icons\">person</a>\n            <h3 className=\"modal-new__header__title\">{this.getIntlMessage('modal.profile.title')}</h3>\n            <div className=\"pull-right\">\n              {\n                isProfileChanged\n                  ? <button className=\"button button--lightblue\" onClick={this.handleSave}>{this.getIntlMessage('button.save')}</button>\n                  : <button className=\"button\" onClick={this.handleClose}>{this.getIntlMessage('button.close')}</button>\n              }\n            </div>\n          </header>\n          <div className=\"modal-new__body row\">\n            <div className=\"col-xs\">\n              <div className=\"name\">\n                <TextField className=\"input__material--wide\"\n                           floatingLabel={this.getIntlMessage('modal.profile.name')}\n                           onChange={this.handleNameChange}\n                           type=\"text\"\n                           value={name}/>\n              </div>\n              <div className=\"nick\">\n                <TextField className=\"input__material--wide\"\n                           floatingLabel={this.getIntlMessage('modal.profile.nick')}\n                           onChange={this.handleNicknameChange}\n                           type=\"text\"\n                           value={nick}/>\n              </div>\n              {\n                profile.phones[0]\n                  ? <div className=\"phone\">\n                      <TextField className=\"input__material--wide\"\n                                 floatingLabel={this.getIntlMessage('modal.profile.phone')}\n                                 disabled\n                                 type=\"tel\"\n                                 value={(profile.phones[0] || {}).number}/>\n                    </div>\n                  : null\n              }\n              {\n                profile.emails[0]\n                  ? <div className=\"phone\">\n                      <TextField className=\"input__material--wide\"\n                                 floatingLabel={this.getIntlMessage('modal.profile.email')}\n                                 disabled\n                                 type=\"email\"\n                                 value={(profile.emails[0] || {}).email}/>\n                    </div>\n                  : null\n              }\n              <div className=\"about\">\n                <label htmlFor=\"about\">{this.getIntlMessage('modal.profile.about')}</label>\n                <textarea className=\"textarea\"\n                          id=\"about\"\n                          onChange={this.handleAboutChange}\n                          value={about}/>\n              </div>\n            </div>\n            <div className=\"profile-picture text-center\">\n              <div className=\"profile-picture__changer\">\n                <AvatarItem image={profile.bigAvatar}\n                            placeholder={profile.placeholder}\n                            size=\"big\"\n                            title={profile.name}/>\n                <a onClick={this.handleChangeAvatarClick}>\n                  <span>{this.getIntlMessage('modal.profile.avatarChange')}</span>\n                </a>\n              </div>\n              {\n                profile.bigAvatar\n                  ? <div className=\"profile-picture__controls\">\n                      <a onClick={this.onProfilePictureRemove}>{this.getIntlMessage('modal.profile.avatarRemove')}</a>\n                    </div>\n                  : null\n              }\n              <form className=\"hide\" ref=\"imageForm\">\n                <input onChange={this.onProfilePictureInputChange} ref=\"imageInput\" type=\"file\"/>\n              </form>\n            </div>\n          </div>\n\n          {cropAvatar}\n        </Modal>\n      );\n    } else {\n      return null;\n    }\n  }\n}\n\nReactMixin.onClass(MyProfile, IntlMixin);\n\nexport default Container.create(MyProfile, {pure: false});\n"]}