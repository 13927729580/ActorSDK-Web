{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":[],"mappings":"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","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedHTMLMessage } from 'react-intl';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport isInside from '../../utils/isInside';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\nimport Scrollbar from '../common/Scrollbar.react';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport QuickSearchActionCreators from '../../actions/QuickSearchActionCreators';\n\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  static getStores() {\n    return [QuickSearchStore];\n  }\n\n  static calculateState() {\n    return {\n      isOpen: QuickSearchStore.isOpen(),\n      results: QuickSearchStore.getResults(),\n      selectedIndex: 0\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  componentDidMount() {\n    this.setFocus();\n    document.addEventListener('keydown', this.handleKeyDown, false);\n    document.addEventListener('click', this.handleDocumentClick, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n    document.removeEventListener('click', this.handleDocumentClick, false);\n  }\n\n  setFocus = () => {\n    setImmediate(() => {\n      findDOMNode(this.refs.query).focus();\n    });\n  };\n\n  handleClose = () => QuickSearchActionCreators.hide();\n\n  handleSearch = (event) => {\n    const query = event.target.value;\n    this.setState({ query });\n    QuickSearchActionCreators.search(query);\n  };\n\n  handleDialogSelect = (peer) => {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  };\n\n  handleKeyDown = (event) => {\n    const { results, selectedIndex } = this.state;\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n\n      case KeyCodes.ESC:\n        event.preventDefault();\n        this.handleClose();\n        break;\n\n      default:\n    }\n  };\n\n  handleScroll = (top) => this.refs.results.scrollTo(top);\n\n  handleDocumentClick = (event) => {\n    const modal = findDOMNode(this.refs.modal);\n    const modalRect = modal.getBoundingClientRect();\n    const coords = {\n      x: event.pageX || event.clientX,\n      y: event.pageY || event.clientY\n    };\n\n    if (!isInside(coords, modalRect)) {\n      this.handleClose();\n    }\n  };\n\n  render() {\n    const { isOpen, results, selectedIndex, query } = this.state;\n    const { intl } = this.context;\n\n    const resultsList = map(results, (result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li className={resultClassName}\n            key={index}\n            onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n            onMouseOver={() => this.setState({ selectedIndex: index })}>\n          <AvatarItem image={result.peerInfo.avatar}\n                      placeholder={result.peerInfo.placeholder}\n                      size=\"small\"\n                      title={result.peerInfo.title}/>\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\">{intl.messages['modal.quickSearch.openDialog']}</div>\n            {result.peerInfo.title}\n          </div>\n        </li>\n      );\n    });\n\n    const modalStyle = {\n      content : {\n        position: null,\n        top: null,\n        left: null,\n        right: null,\n        bottom: null,\n        border: null,\n        background: null,\n        overflow: null,\n        outline: null,\n        padding: null,\n        borderRadius: null,\n        width: 460\n      }\n    };\n\n    return (\n      <Modal className=\"modal modal--quick-search\"\n             closeTimeoutMS={150}\n             isOpen={isOpen}\n             style={modalStyle}>\n        <div ref=\"modal\">\n\n          <header className=\"header\">\n            <div className=\"pull-left\">{intl.messages['modal.quickSearch.title']}</div>\n            <div className=\"pull-right\"><strong>esc</strong>&nbsp; {intl.messages['modal.quickSearch.toClose']}</div>\n            <div className=\"pull-right\"><strong>↵</strong>&nbsp; {intl.messages['modal.quickSearch.toSelect']}</div>\n            <div className=\"pull-right\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; {intl.messages['modal.quickSearch.toNavigate']}</div>\n          </header>\n\n          <div className=\"input\">\n            <input type=\"text\"\n                   placeholder={intl.messages['modal.quickSearch.placeholder']}\n                   onChange={this.handleSearch}\n                   value={query}\n                   ref=\"query\"/>\n          </div>\n\n          <Scrollbar style={{ height: RESULT_ITEM_HEIGHT * 8 }} ref=\"results\">\n            <ul className=\"results\">\n              {\n                resultsList.length > 0\n                  ? resultsList\n                  : <li className=\"results__item results__item--suggestion row\">\n                      <FormattedHTMLMessage id=\"modal.quickSearch.notFound\"\n                                            values={{ query }}/>\n                      <button className=\"button button--rised hide\">Create new dialog {query}</button>\n                    </li>\n              }\n            </ul>\n          </Scrollbar>\n        </div>\n      </Modal>\n    );\n  }\n\n}\n\nexport default Container.create(QuickSearch, { pure: false });\n"]}