{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,IAAM,kBAAkB,GAAG,EAAE,CAAC;AAC9B,IAAI,WAAW,GAAG,CAAC,CAAC;;IAEd,WAAW;YAAX,WAAW;;AACf,WADI,WAAW,CACH,KAAK,EAAE;0BADf,WAAW;;uEAAX,WAAW,aAEP,KAAK;;UAyFb,QAAQ,GAAG,YAAM;AACf,gBAAU,CAAC,YAAM;AACf,wBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,CAAC;OAC5C,EAAE,CAAC,CAAC,CAAC;KACP;;UAED,WAAW,GAAG;aAAM,oCAA0B,IAAI,EAAE;KAAA;;UAEpD,YAAY,GAAG,UAAC,KAAK,EAAK;AACxB,UAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;AACjC,YAAK,QAAQ,CAAC,EAAC,KAAK,EAAL,KAAK,EAAC,CAAC,CAAC;AACvB,0CAA0B,MAAM,CAAC,KAAK,CAAC,CAAC;KACzC;;UAED,kBAAkB,GAAG,UAAC,IAAI,EAAK;AAC7B,qCAAqB,gBAAgB,CAAC,IAAI,CAAC,CAAC;AAC5C,YAAK,WAAW,EAAE,CAAC;KACpB;;UAED,aAAa,GAAG,UAAC,KAAK,EAAK;wBACU,MAAK,KAAK;UAArC,OAAO,eAAP,OAAO;UAAE,aAAa,eAAb,aAAa;;AAC9B,UAAM,YAAY,GAAG,CAAC,CAAC;AACvB,UAAI,KAAK,GAAG,aAAa,CAAC;;AAE1B,cAAQ,KAAK,CAAC,OAAO;AACnB,aAAK,4BAAS,KAAK;AACjB,eAAK,CAAC,eAAe,EAAE,CAAC;AACxB,eAAK,CAAC,cAAc,EAAE,CAAC;AACvB,gBAAK,kBAAkB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC9D,gBAAM;;AAAA,AAER,aAAK,4BAAS,QAAQ;AACpB,eAAK,CAAC,eAAe,EAAE,CAAC;AACxB,eAAK,CAAC,cAAc,EAAE,CAAC;;AAEvB,cAAI,KAAK,GAAG,CAAC,EAAE;AACb,iBAAK,IAAI,CAAC,CAAC;WACZ,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE;AACtB,iBAAK,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;WAC5B;;AAED,cAAI,WAAW,GAAG,KAAK,EAAE;AACvB,uBAAW,GAAG,KAAK,CAAC;WACrB,MAAM,IAAI,KAAK,KAAK,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;AACvC,uBAAW,GAAG,OAAO,CAAC,MAAM,GAAG,YAAY,CAAC;WAC7C;;AAED,gBAAK,YAAY,CAAC,WAAW,GAAG,kBAAkB,CAAC,CAAC;AACpD,gBAAK,QAAQ,CAAC,EAAC,aAAa,EAAE,KAAK,EAAC,CAAC,CAAC;AACtC,gBAAM;AAAA,AACR,aAAK,4BAAS,UAAU,CAAC;AACzB,aAAK,4BAAS,GAAG;AACf,eAAK,CAAC,eAAe,EAAE,CAAC;AACxB,eAAK,CAAC,cAAc,EAAE,CAAC;;AAEvB,cAAI,KAAK,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;AAC9B,iBAAK,IAAI,CAAC,CAAC;WACZ,MAAM,IAAI,KAAK,KAAK,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;AACvC,iBAAK,GAAG,CAAC,CAAC;WACX;;AAED,cAAI,KAAK,GAAG,CAAC,GAAG,WAAW,GAAG,YAAY,EAAE;AAC1C,uBAAW,GAAG,KAAK,GAAG,CAAC,GAAG,YAAY,CAAC;WACxC,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE;AACtB,uBAAW,GAAG,CAAC,CAAC;WACjB;;AAED,gBAAK,YAAY,CAAC,WAAW,GAAG,kBAAkB,CAAC,CAAC;AACpD,gBAAK,QAAQ,CAAC,EAAC,aAAa,EAAE,KAAK,EAAC,CAAC,CAAC;AACtC,gBAAM;;AAAA,AAER,aAAK,4BAAS,GAAG;AACf,eAAK,CAAC,cAAc,EAAE,CAAC;AACvB,gBAAK,WAAW,EAAE,CAAC;AACnB,gBAAM;;AAAA,AAER,gBAAQ;OACT;KACF;;UAED,YAAY,GAAG,UAAC,GAAG,EAAK;AACtB,UAAM,WAAW,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,OAAO,CAAC,CAAC;AACzD,iBAAW,CAAC,SAAS,GAAG,GAAG,CAAC;KAC7B;;UAED,mBAAmB,GAAG,UAAC,KAAK,EAAK;AAC/B,UAAM,KAAK,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,KAAK,CAAC,CAAC;AACjD,UAAM,SAAS,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC;AAChD,UAAM,MAAM,GAAG;AACb,SAAC,EAAE,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO;AAC/B,SAAC,EAAE,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO;OAChC,CAAC;;AAEF,UAAI,CAAC,wBAAS,MAAM,EAAE,SAAS,CAAC,EAAE;AAChC,cAAK,WAAW,EAAE,CAAC;OACpB;KACF;;;GAxLA;;eAHG,WAAW;;wCAeK;AAClB,UAAI,CAAC,QAAQ,EAAE,CAAC;AAChB,cAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;AAChE,cAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;KACrE;;;2CAEsB;AACrB,cAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;AACnE,cAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;KACxE;;;6BAEQ;;;mBAC2C,IAAI,CAAC,KAAK;UAApD,MAAM,UAAN,MAAM;UAAE,OAAO,UAAP,OAAO;UAAE,aAAa,UAAb,aAAa;UAAE,KAAK,UAAL,KAAK;;AAE7C,UAAM,WAAW,GAAG,iBAAI,OAAO,EAAE,UAAC,MAAM,EAAE,KAAK,EAAK;AAClD,YAAM,eAAe,GAAG,0BAAW,mBAAmB,EAAE;AACtD,iCAAuB,EAAE,aAAa,KAAK,KAAK;SACjD,CAAC,CAAC;;AAEH,eACE;;YAAI,SAAS,EAAE,eAAe,AAAC;AAC3B,eAAG,EAAE,KAAK,AAAC;AACX,mBAAO,EAAE;qBAAM,OAAK,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;aAAA,AAAC;AAC7D,uBAAW,EAAE;qBAAM,OAAK,QAAQ,CAAC,EAAC,aAAa,EAAE,KAAK,EAAC,CAAC;aAAA,AAAC;UAC3D,sDAAY,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,MAAM,AAAC;AAC9B,uBAAW,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW,AAAC;AACzC,gBAAI,EAAC,OAAO;AACZ,iBAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,KAAK,AAAC,GAAE;UAC3C;;cAAK,SAAS,EAAC,cAAc;YAC3B;;gBAAK,SAAS,EAAC,iBAAiB;cAAE,OAAK,cAAc,CAAC,8BAA8B,CAAC;aAAO;YAC3F,MAAM,CAAC,QAAQ,CAAC,KAAK;WAClB;SACH,CACL;OACH,CAAC,CAAC;;AAEH,aACE;;UAAO,SAAS,EAAC,2BAA2B;AACrC,wBAAc,EAAE,GAAG,AAAC;AACpB,gBAAM,EAAE,MAAM,AAAC;AACf,eAAK,EAAE,EAAC,KAAK,EAAE,GAAG,EAAC,AAAC;QACzB;;YAAK,GAAG,EAAC,OAAO;UAEd;;cAAQ,SAAS,EAAC,QAAQ;YACxB;;gBAAK,SAAS,EAAC,WAAW;cAAE,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC;aAAO;YACjF;;gBAAK,SAAS,EAAC,YAAY;cAAC;;;;eAAoB;;cAAQ,IAAI,CAAC,cAAc,CAAC,2BAA2B,CAAC;aAAO;YAC/G;;gBAAK,SAAS,EAAC,YAAY;cAAC;;;;eAAkB;;cAAQ,IAAI,CAAC,cAAc,CAAC,4BAA4B,CAAC;aAAO;YAC9G;;gBAAK,SAAS,EAAC,YAAY;cAAC;;;;eAAoB;;cAAgB;;;;eAAkB;cAAA;;;;eAAkB;;cAAQ,IAAI,CAAC,cAAc,CAAC,8BAA8B,CAAC;aAAO;WAC/J;UAET;;cAAK,SAAS,EAAC,OAAO;YACpB,yCAAO,IAAI,EAAC,MAAM;AACX,yBAAW,EAAE,IAAI,CAAC,cAAc,CAAC,+BAA+B,CAAC,AAAC;AAClE,sBAAQ,EAAE,IAAI,CAAC,YAAY,AAAC;AAC5B,mBAAK,EAAE,KAAK,AAAC;AACb,iBAAG,EAAC,OAAO,GAAE;WAChB;UAEN;;cAAI,SAAS,EAAC,SAAS,EAAC,GAAG,EAAC,SAAS;YAEjC,WAAW,CAAC,MAAM,GAAG,CAAC,GAClB,WAAW,GACX;;gBAAI,SAAS,EAAC,6CAA6C;cACzD;AACE,uBAAO,EAAE,IAAI,CAAC,cAAc,CAAC,4BAA4B,CAAC,AAAC;AAC3D,qBAAK,EAAE,KAAK,AAAC,GAAG;cAClB;;kBAAQ,SAAS,EAAC,2BAA2B;;gBAAoB,KAAK;eAAU;aAC7E;WAER;SAED;OACA,CACR;KACH;;;qCAlFuB;AACtB,aAAO;AACL,cAAM,EAAE,2BAAiB,MAAM,EAAE;AACjC,eAAO,EAAE,2BAAiB,UAAU,EAAE;AACtC,qBAAa,EAAE,CAAC;OACjB,CAAA;KACF;;;SAbG,WAAW;;;AAAX,WAAW,CAKR,SAAS,GAAG;SAAM,4BAAkB;CAAA;;AAyL7C,qBAAW,OAAO,CAAC,WAAW,uBAAY,CAAC;;kBAE5B,iBAAU,MAAM,CAAC,WAAW,EAAE,EAAC,IAAI,EAAE,KAAK,EAAC,CAAC","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\n\nimport React, { Component } from 'react';\nimport { Container } from 'flux/utils';\nimport ReactMixin from 'react-mixin';\nimport { IntlMixin, FormattedHTMLMessage } from 'react-intl';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport isInside from '../../utils/isInside';\n\nimport { KeyCodes, PeerTypes } from '../../constants/ActorAppConstants';\n\nimport QuickSearchActionCreators from '../../actions/QuickSearchActionCreators';\nimport DialogActionCreators from '../../actions/DialogActionCreators';\n\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  static getStores = () => [QuickSearchStore];\n\n  static calculateState() {\n    return {\n      isOpen: QuickSearchStore.isOpen(),\n      results: QuickSearchStore.getResults(),\n      selectedIndex: 0\n    }\n  }\n\n  componentDidMount() {\n    this.setFocus();\n    document.addEventListener('keydown', this.handleKeyDown, false);\n    document.addEventListener('click', this.handleDocumentClick, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n    document.removeEventListener('click', this.handleDocumentClick, false);\n  }\n\n  render() {\n    const { isOpen, results, selectedIndex, query } = this.state;\n\n    const resultsList = map(results, (result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li className={resultClassName}\n            key={index}\n            onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n            onMouseOver={() => this.setState({selectedIndex: index})}>\n          <AvatarItem image={result.peerInfo.avatar}\n                      placeholder={result.peerInfo.placeholder}\n                      size=\"small\"\n                      title={result.peerInfo.title}/>\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\">{this.getIntlMessage('modal.quickSearch.openDialog')}</div>\n            {result.peerInfo.title}\n          </div>\n        </li>\n      );\n    });\n\n    return (\n      <Modal className=\"modal modal--quick-search\"\n             closeTimeoutMS={150}\n             isOpen={isOpen}\n             style={{width: 460}}>\n        <div ref=\"modal\">\n\n          <header className=\"header\">\n            <div className=\"pull-left\">{this.getIntlMessage('modal.quickSearch.title')}</div>\n            <div className=\"pull-right\"><strong>esc</strong>&nbsp; {this.getIntlMessage('modal.quickSearch.toClose')}</div>\n            <div className=\"pull-right\"><strong>↵</strong>&nbsp; {this.getIntlMessage('modal.quickSearch.toSelect')}</div>\n            <div className=\"pull-right\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; {this.getIntlMessage('modal.quickSearch.toNavigate')}</div>\n          </header>\n\n          <div className=\"input\">\n            <input type=\"text\"\n                   placeholder={this.getIntlMessage('modal.quickSearch.placeholder')}\n                   onChange={this.handleSearch}\n                   value={query}\n                   ref=\"query\"/>\n          </div>\n\n          <ul className=\"results\" ref=\"results\">\n            {\n              resultsList.length > 0\n                ? resultsList\n                : <li className=\"results__item results__item--suggestion row\">\n                    <FormattedHTMLMessage\n                      message={this.getIntlMessage('modal.quickSearch.notFound')}\n                      query={query} />\n                    <button className=\"button button--rised hide\">Create new dialog {query}</button>\n                  </li>\n            }\n          </ul>\n\n        </div>\n      </Modal>\n    );\n  }\n\n  setFocus = () => {\n    setTimeout(() => {\n      React.findDOMNode(this.refs.query).focus();\n    }, 0);\n  };\n\n  handleClose = () => QuickSearchActionCreators.hide();\n\n  handleSearch = (event) => {\n    const query = event.target.value;\n    this.setState({query});\n    QuickSearchActionCreators.search(query);\n  };\n\n  handleDialogSelect = (peer) => {\n    DialogActionCreators.selectDialogPeer(peer);\n    this.handleClose();\n  };\n\n  handleKeyDown = (event) => {\n    const { results, selectedIndex } = this.state;\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({selectedIndex: index});\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({selectedIndex: index});\n        break;\n\n      case KeyCodes.ESC:\n        event.preventDefault();\n        this.handleClose();\n        break;\n\n      default:\n    }\n  };\n\n  handleScroll = (top) => {\n    const resultsNode = React.findDOMNode(this.refs.results);\n    resultsNode.scrollTop = top;\n  };\n\n  handleDocumentClick = (event) => {\n    const modal = React.findDOMNode(this.refs.modal);\n    const modalRect = modal.getBoundingClientRect();\n    const coords = {\n      x: event.pageX || event.clientX,\n      y: event.pageY || event.clientY\n    };\n\n    if (!isInside(coords, modalRect)) {\n      this.handleClose();\n    }\n  };\n}\n\nReactMixin.onClass(QuickSearch, IntlMixin);\n\nexport default Container.create(QuickSearch, {pure: false});\n"]}