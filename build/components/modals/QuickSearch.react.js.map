{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":[],"mappings":"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","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport EventListener from 'fbjs/lib/EventListener';\nimport fuzzaldrin from 'fuzzaldrin';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport QuickSearchActionCreators from '../../actions/QuickSearchActionCreators';\n\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  static getStores() {\n    return [QuickSearchStore];\n  }\n\n  static calculateState() {\n    return {\n      list: QuickSearchStore.getState(),\n      selectedIndex: 0\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object.isRequired\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.setFocus = this.setFocus.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleSearch = this.handleSearch.bind(this);\n    this.handleDialogSelect = this.handleDialogSelect.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n  }\n\n  componentDidMount() {\n    this.setFocus();\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      EventListener.listen(document, 'keydown', this.handleKeyDown)\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => listener.remove());\n      this.listeners = null;\n    }\n  }\n\n  setFocus() {\n    setImmediate(() => findDOMNode(this.refs.query).focus());\n  }\n\n  handleClose() {\n    QuickSearchActionCreators.hide();\n  }\n\n  handleSearch(event) {\n    this.setState({ query: event.target.value });\n  }\n\n  handleDialogSelect(peer) {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  }\n\n  handleKeyDown(event) {\n    const { selectedIndex } = this.state;\n    const results = this.getResults();\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n\n      default:\n    }\n  }\n\n  handleScroll(top) {\n    findDOMNode(this.refs.results).scrollTop = top;\n  }\n\n  getResults() {\n    const { list, query } = this.state;\n    if (!query || query === '') return list;\n\n    return list.filter((result) => {\n      return fuzzaldrin.score(result.peerInfo.title, query) > 0 ||\n             fuzzaldrin.score(result.peerInfo.userName, query) > 0;\n    });\n  }\n\n  renderResults() {\n    const { selectedIndex, query } = this.state;\n    const results = this.getResults();\n\n    if (!results.length) {\n      return (\n        <li className=\"results__item results__item--suggestion row\">\n          <FormattedHTMLMessage id=\"modal.quickSearch.notFound\" values={{ query }}/>\n          <button className=\"button button--rised hide\">Create new dialog {query}</button>\n        </li>\n      )\n    }\n\n    return results.map((result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li\n          className={resultClassName} key={`r${index}`}\n          onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n          onMouseOver={() => this.setState({ selectedIndex: index })}>\n          <AvatarItem\n            className=\"quick-search__avatar\"\n            size=\"small\"\n            image={result.peerInfo.avatar}\n            placeholder={result.peerInfo.placeholder}\n            title={result.peerInfo.title}\n          />\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\"><FormattedMessage id=\"modal.quickSearch.openDialog\"/></div>\n            {result.peerInfo.title}\n          </div>\n        </li>\n      );\n    });\n  }\n\n  renderHeader() {\n    return (\n      <header className=\"header\">\n        <div className=\"pull-left\"><FormattedMessage id=\"modal.quickSearch.title\"/></div>\n        <div className=\"pull-right\"><strong>esc</strong>&nbsp; <FormattedMessage id=\"modal.quickSearch.toClose\"/></div>\n        <div className=\"pull-right\"><strong>↵</strong>&nbsp; <FormattedMessage id=\"modal.quickSearch.toSelect\"/></div>\n        <div className=\"pull-right\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; <FormattedMessage id=\"modal.quickSearch.toNavigate\"/></div>\n      </header>\n    );\n  }\n\n  renderSearchInput() {\n    const { query } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <div className=\"large-search\">\n        <input\n          className=\"input\"\n          type=\"text\"\n          placeholder={intl.messages['modal.quickSearch.placeholder']}\n          onChange={this.handleSearch}\n          value={query}\n          ref=\"query\"/>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <Modal\n        overlayClassName=\"modal-overlay\"\n        className=\"modal\"\n        onRequestClose={this.handleClose}\n        isOpen>\n\n        <div className=\"quick-search\">\n          <div className=\"modal__content\">\n\n            {this.renderHeader()}\n\n            {this.renderSearchInput()}\n\n            <ul className=\"results\" ref=\"results\">\n              {this.renderResults()}\n            </ul>\n\n          </div>\n        </div>\n\n      </Modal>\n    );\n  }\n}\n\nexport default Container.create(QuickSearch, { pure: false });\n"]}