{"version":3,"sources":["../../../src/components/modals/InviteUser.react.js"],"names":[],"mappings":"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","file":"InviteUser.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport Modal from 'react-modal';\nimport { Container } from 'flux/utils';\nimport fuzzaldrin from 'fuzzaldrin';\nimport classNames from 'classnames';\n\nimport { KeyCodes, AsyncActionStates } from '../../constants/ActorAppConstants';\nimport { hasMember } from '../../utils/GroupUtils';\n\nimport InviteUserActions from '../../actions/InviteUserActions';\nimport InviteUserByLinkActions from '../../actions/InviteUserByLinkActions';\n\nimport ContactsStore from '../../stores/ContactsStore';\nimport InviteUserStore from '../../stores/InviteUserStore';\n\nimport ContactItem from '../common/ContactItem.react';\nimport Stateful from '../common/Stateful.react';\n\nclass InviteUser extends Component {\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  static getStores() {\n    return [InviteUserStore, ContactsStore];\n  }\n\n  static calculateState() {\n    const contacts = ContactsStore.getState();\n    const { isOpen, group, users, query } = InviteUserStore.getState();\n\n    return {\n      contacts,\n      isOpen,\n      group,\n      users,\n      query\n    };\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.onClose = this.onClose.bind(this);\n    this.onSearchChange = this.onSearchChange.bind(this);\n    this.onContactSelect = this.onContactSelect.bind(this);\n    this.onInviteUrlByClick = this.onInviteUrlByClick.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.isOpen && !this.state.isOpen) {\n      document.addEventListener('keydown', this.onKeyDown, false);\n    } else if (!nextState.isOpen && this.state.isOpen) {\n      document.removeEventListener('keydown', this.onKeyDown, false);\n    }\n  }\n\n  onClose() {\n    InviteUserActions.hide();\n  }\n\n  onSearchChange(event) {\n    InviteUserActions.setQuery(event.target.value);\n  }\n\n  onContactSelect(uid) {\n    InviteUserActions.inviteUser(this.state.group.id, uid);\n  }\n\n  onInviteUrlByClick() {\n    const { group } = this.state;\n\n    InviteUserByLinkActions.show(group);\n    InviteUserActions.hide();\n  }\n\n  onKeyDown(event) {\n    if (event.keyCode === KeyCodes.ESC) {\n      event.preventDefault();\n      this.onClose();\n    }\n  }\n\n  getContacts() {\n    const { contacts, query } = this.state;\n\n    if (!query) {\n      return contacts;\n    }\n\n    return contacts.filter((contact) => {\n      const score = fuzzaldrin.score(contact.name, query);\n      return score > 0;\n    });\n  }\n\n  renderContacts() {\n    const { intl } = this.context;\n    const { group, users } = this.state;\n    const contacts = this.getContacts();\n\n    if (!contacts.length) {\n      return (\n        <li className=\"contacts__list__item contacts__list__item--empty text-center\">\n          {intl.messages['inviteModalNotFound']}\n        </li>\n      );\n    }\n\n    return contacts.map((contact) => {\n      const isMember = hasMember(group.id, contact.uid);\n      const currentState = isMember ? AsyncActionStates.SUCCESS : (users[contact.uid] || AsyncActionStates.PENDING);\n\n      const onClick = () => {\n        console.log(`%c Trying to invite \"${contact.name}\"(uid=${contact.uid}) to group ${group.id}`, 'color: #fd5c52');\n        this.onContactSelect(contact.uid)\n      };\n\n      const contactClassName = classNames({\n        'contact--disabled': currentState === AsyncActionStates.SUCCESS\n      });\n\n      return (\n        <ContactItem {...contact} className={contactClassName} key={contact.uid}>\n          <Stateful\n            currentState={currentState}\n            pending={<a className=\"material-icons\" onClick={onClick}>person_add</a>}\n            processing={<i className=\"material-icons spin\">autorenew</i>}\n            success={<i className=\"material-icons\">check</i>}\n            failure={<i className=\"material-icons\">warning</i>}\n          />\n        </ContactItem>\n      );\n    });\n  }\n\n  render() {\n    const { isOpen, search } = this.state;\n    const { intl } = this.context;\n\n    if (!isOpen) {\n      return null;\n    }\n\n    const modalStyle = {\n      content : {\n        position: null,\n        top: null,\n        left: null,\n        right: null,\n        bottom: null,\n        border: null,\n        background: null,\n        overflow: null,\n        outline: null,\n        padding: null,\n        borderRadius: null,\n        width: 440\n      }\n    };\n\n    return (\n      <Modal className=\"modal-new modal-new--invite contacts\"\n             closeTimeoutMS={150}\n             isOpen={isOpen}\n             style={modalStyle}>\n\n        <header className=\"modal-new__header\">\n          <a className=\"modal-new__header__icon material-icons\">person_add</a>\n          <h3 className=\"modal-new__header__title\">{intl.messages['inviteModalTitle']}</h3>\n\n          <div className=\"pull-right\">\n            <button className=\"button button--lightblue\" onClick={this.onClose}>{intl.messages['button.done']}</button>\n          </div>\n        </header>\n\n        <div className=\"modal-new__body\">\n          <div className=\"modal-new__search\">\n            <i className=\"material-icons\">search</i>\n            <input className=\"input input--search\"\n                   onChange={this.onSearchChange}\n                   placeholder={intl.messages['inviteModalSearch']}\n                   type=\"search\"\n                   value={search}/>\n          </div>\n\n          <a className=\"link link--blue\" onClick={this.onInviteUrlByClick}>\n            <i className=\"material-icons\">link</i>\n            {intl.messages['inviteByLink']}\n          </a>\n        </div>\n\n        <div className=\"contacts__body\">\n          <ul className=\"contacts__list\">\n            {this.renderContacts()}\n          </ul>\n        </div>\n\n      </Modal>\n    );\n  }\n}\n\nexport default Container.create(InviteUser);\n"]}