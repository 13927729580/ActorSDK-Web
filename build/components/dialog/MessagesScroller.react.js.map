{"version":3,"sources":["../../../src/components/dialog/MessagesScroller.react.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAIA;;;;AACA;;AAEA;;;;;;;;;AAKA,IAAM,kBAAkB,GAAlB;;;;IAEA;;;AAQJ,WARI,gBAQJ,CAAY,KAAZ,EAAmB;wCARf,kBAQe;;+DACjB,sBAAM,KAAN,GADiB;;AAGjB,UAAK,KAAL,GAAa,MAAK,KAAL,CAAW,IAAX,OAAb,CAHiB;AAIjB,UAAK,QAAL,GAAgB,MAAK,QAAL,CAAc,IAAd,OAAhB,CAJiB;;GAAnB;;AARI,6BAeJ,iDAAoB;AAClB,SAAK,cAAL,GADkB;;;AAfhB,6BAmBJ,mDAAoB,WAAW;AAC7B,QAAM,aAAa,oBAAU,MAAV,CAAiB,UAAU,IAAV,EAAgB,KAAK,KAAL,CAAW,IAAX,CAA9C,CADuB;AAE7B,QAAI,UAAJ,EAAgB;kBACoC,KAAK,IAAL,CADpC;UACN,4BADM;UACK,kCADL;UACmB,kCADnB;;AAEd,WAAK,UAAL,GAAkB,SAAlB,CAFc;AAGd,WAAK,aAAL,GAAqB,YAArB,CAHc;AAId,WAAK,mBAAL,GAA2B,YAAY,YAAZ,KAA6B,YAA7B,CAJb;KAAhB,MAKO;AACL,WAAK,mBAAL,GAA2B,IAA3B,CADK;KALP;;;AArBE,6BA+BJ,mDAAqB;;;QACX,eAAiB,KAAK,IAAL,CAAjB;;AADW;AAGnB,QAAI,eAAe,KAAK,aAAL,EAAoB;AACrC,4BAAsB,YAAM;AAC1B,eAAK,IAAL,CAAU,SAAV,GAAsB,OAAK,UAAL,IAAmB,eAAe,OAAK,aAAL,CAAlC,CADI;OAAN,CAAtB,CADqC;AAIrC,aAJqC;KAAvC;;QAOQ,YAAc,KAAK,IAAL,CAAd;;AAVW;AAYnB,QAAI,cAAc,CAAd,EAAiB;AACnB,kCAAa,YAAM;AACjB,eAAK,KAAL,CAAW,UAAX,GADiB;OAAN,CAAb,CADmB;AAInB,aAJmB;KAArB;;AAOA,QAAI,KAAK,mBAAL,EAA0B;AAC5B,WAAK,cAAL,GAD4B;KAA9B;;;AAlDE,6BAuDJ,2CAAiB;AACf,SAAK,IAAL,CAAU,SAAV,GAAsB,KAAK,IAAL,CAAU,YAAV,CADP;;;AAvDb,6BA2DJ,uBAAM,MAAM;AACV,SAAK,IAAL,GAAY,IAAZ,CADU;;;AA3DR,6BA+DJ,6BAAS,OAAO;QACI,YAAgB,MAA1B,OAAU,UADJ;;AAEd,QAAI,aAAa,eAAb,EAA8B;AAChC,WAAK,KAAL,CAAW,UAAX,GADgC;KAAlC;;;AAjEE,6BAsEJ,2BAAS;AACP,WACE;;QAAK,WAAW,KAAK,KAAL,CAAW,SAAX,EAAsB,UAAU,KAAK,QAAL,EAAe,KAAK,KAAK,KAAL,EAApE;MACG,KAAK,KAAL,CAAW,QAAX;KAFL,CADO;;;SAtEL;;;iBACG,YAAY;AACjB,QAAM,iBAAU,MAAV,CAAiB,UAAjB;AACN,aAAW,iBAAU,MAAV;AACX,YAAU,iBAAU,IAAV,CAAe,UAAf;AACV,cAAY,iBAAU,IAAV,CAAe,UAAf;;kBA0ED","file":"MessagesScroller.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\n\nimport PeerUtils from '../../utils/PeerUtils';\n\n/**\n * On which scrollTop value start loading older messages\n */\nconst MAX_LOAD_HEIGHT = 100;\n\nclass MessagesScroller extends Component {\n  static propTypes = {\n    peer: PropTypes.object.isRequired,\n    className: PropTypes.string,\n    children: PropTypes.node.isRequired,\n    onLoadMore: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.onRef = this.onRef.bind(this);\n    this.onScroll = this.onScroll.bind(this);\n  }\n\n  componentDidMount() {\n    this.scrollToBottom();\n  }\n\n  componentWillUpdate(nextProps) {\n    const isSamePeer = PeerUtils.equals(nextProps.peer, this.props.peer);\n    if (isSamePeer) {\n      const { scrollTop, offsetHeight, scrollHeight } = this.node;\n      this._scrollTop = scrollTop;\n      this._scrollHeight = scrollHeight;\n      this._shouldScrollBottom = scrollTop + offsetHeight === scrollHeight;\n    } else {\n      this._shouldScrollBottom = true;\n    }\n  }\n\n  componentDidUpdate() {\n    const { scrollHeight } = this.node;\n    // check if container become bigger\n    if (scrollHeight > this._scrollHeight) {\n      requestAnimationFrame(() => {\n        this.node.scrollTop = this._scrollTop + (scrollHeight - this._scrollHeight);\n      });\n      return;\n    }\n\n    const { scrollTop } = this.node;\n    // check if scroll on top on container\n    if (scrollTop === 0) {\n      setImmediate(() => {\n        this.props.onLoadMore();\n      });\n      return;\n    }\n\n    if (this._shouldScrollBottom) {\n      this.scrollToBottom();\n    }\n  }\n\n  scrollToBottom() {\n    this.node.scrollTop = this.node.scrollHeight;\n  }\n\n  onRef(node) {\n    this.node = node;\n  }\n\n  onScroll(event) {\n    const { target: { scrollTop } } = event;\n    if (scrollTop <= MAX_LOAD_HEIGHT) {\n      this.props.onLoadMore();\n    }\n  }\n\n  render() {\n    return (\n      <div className={this.props.className} onScroll={this.onScroll} ref={this.onRef}>\n        {this.props.children}\n      </div>\n    );\n  }\n}\n\nexport default MessagesScroller;\n"]}