{"version":3,"sources":["../../../src/components/dialog/ComposeSection.react.js"],"names":[],"mappings":"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","file":"ComposeSection.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { forEach } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage } from 'react-intl';\n\nimport ActorClient from '../../utils/ActorClient';\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport MessageActionCreators from '../../actions/MessageActionCreators';\nimport ComposeActionCreators from '../../actions/ComposeActionCreators';\nimport AttachmentsActionCreators from '../../actions/AttachmentsActionCreators';\nimport EmojiActionCreators from '../../actions/EmojiActionCreators';\nimport StickersActionCreators from '../../actions/StickersActionCreators';\n\nimport GroupStore from '../../stores/GroupStore';\nimport PreferencesStore from '../../stores/PreferencesStore';\nimport ComposeStore from '../../stores/ComposeStore';\nimport DialogStore from '../../stores/DialogStore';\nimport MessageArtStore from '../../stores/MessageArtStore';\n\nimport ComposeTextArea from './compose/ComposeTextArea.react';\nimport ComposeMarkdownHint from './compose/ComposeMarkdownHint.react';\nimport BotCommandsHint from './compose/BotCommandsHint.react';\nimport AvatarItem from '../common/AvatarItem.react';\nimport MentionDropdown from '../common/MentionDropdown.react';\nimport MessageArt from '../messageArt/MessageArt.react';\nimport VoiceRecorder from '../common/VoiceRecorder.react';\nimport DropZone from '../common/DropZone.react';\n\nclass ComposeSection extends Component {\n  static contextTypes = {\n    intl: PropTypes.object.isRequired,\n    delegate: PropTypes.object.isRequired\n  };\n\n  static getStores() {\n    return [DialogStore, GroupStore, PreferencesStore, ComposeStore, MessageArtStore];\n  }\n\n  static calculateState() {\n    return {\n      peer: DialogStore.getCurrentPeer(),\n      compose: ComposeStore.getState(),\n      profile: ActorClient.getUser(ActorClient.getUid()),\n      sendByEnter: PreferencesStore.isSendByEnterEnabled(),\n      isMessageArtOpen: MessageArtStore.getState().isOpen,\n      stickers: MessageArtStore.getState().stickers\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.onTyping = this.onTyping.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.onPaste = this.onPaste.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.onEditTyping = this.onEditTyping.bind(this);\n    this.onEditCancel = this.onEditCancel.bind(this);\n    this.onEditSubmit = this.onEditSubmit.bind(this);\n    this.onEditKeyDown = this.onEditKeyDown.bind(this);\n    this.onCommandSelect = this.onCommandSelect.bind(this);\n    this.onCommandClose = this.onCommandClose.bind(this);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.peer !== this.state.peer) {\n      this.refs.area.autoFocus();\n    } else if (prevState.compose.editMessage !== this.state.compose.editMessage) {\n      this.refs.area.blur();\n      this.refs.area.focus(true);\n    }\n  }\n\n  onTyping(text, caretPosition) {\n    ComposeActionCreators.onTyping(this.state.peer, text, caretPosition);\n  }\n\n  onSubmit() {\n    const { peer, compose: { text } } = this.state;\n\n    if (text.trim().length) {\n      MessageActionCreators.sendTextMessage(peer, text);\n    }\n\n    ComposeActionCreators.cleanText();\n  }\n\n  onPaste(event) {\n    const attachments = Array.from(event.clipboardData.items)\n      .filter((item) => item.type.indexOf('image') !== -1)\n      .map((item) => item.getAsFile());\n\n    if (attachments.length) {\n      event.preventDefault();\n      AttachmentsActionCreators.show(attachments);\n    }\n  }\n\n  onKeyDown(event) {\n    const { delegate } = this.context;\n    if (delegate.features.editing && event.keyCode === KeyCodes.ARROW_UP && !event.target.value) {\n      event.preventDefault();\n      MessageActionCreators.editLastMessage();\n    }\n  }\n\n  onEditSubmit() {\n    const { peer, compose: { text, editMessage } } = this.state;\n\n    if (text) {\n      MessageActionCreators.editTextMessage(peer, editMessage.rid, text);\n    } else {\n      MessageActionCreators.deleteMessage(peer, editMessage.rid);\n      ComposeActionCreators.cleanText();\n    }\n  }\n\n  onEditTyping(text, caretPosition) {\n    ComposeActionCreators.changeText(this.state.peer, text, caretPosition);\n  }\n\n  onEditKeyDown(event) {\n    if (event.keyCode === KeyCodes.ESC) {\n      event.preventDefault();\n      this.onEditCancel();\n    }\n  }\n\n  onEditCancel() {\n    ComposeActionCreators.cancelEdit();\n  }\n\n  resetAttachmentForm = () => {\n    const form = findDOMNode(this.refs.attachmentForm);\n    form.reset();\n  };\n\n  // TODO: move this to textarea component\n  onMentionSelect = (mention) => {\n    const { peer, compose: { text } } = this.state;\n\n    ComposeActionCreators.insertMention(peer, text, this.getCaretPosition(), mention);\n    this.setFocus();\n  };\n\n  onMentionClose = () => {\n    ComposeActionCreators.closeMention();\n  };\n\n  // TODO: move this to textarea component\n  handleEmojiSelect = (emoji) => {\n    const { compose: { text } } = this.state;\n    EmojiActionCreators.insertEmoji(text, this.getCaretPosition(), emoji);\n    this.setFocus();\n  };\n\n  onCommandSelect(command) {\n    const { peer } = this.state;\n    MessageActionCreators.sendTextMessage(peer, `/${command}`);\n    ComposeActionCreators.cleanText();\n  }\n\n  onCommandClose() {\n    ComposeActionCreators.cleanText();\n  }\n\n  handleStickerSelect = (sticker) => {\n    const { peer } = this.state;\n    StickersActionCreators.sendSticker(peer, sticker);\n    this.setFocus();\n  };\n\n  setFocus = () => {\n    findDOMNode(this.refs.area).focus();\n  };\n\n  handleDrop = (files) => {\n    let attachments = [];\n\n    forEach(files, (file) => attachments.push(file));\n\n    if (attachments.length > 0) {\n      AttachmentsActionCreators.show(attachments);\n    }\n  };\n\n  handleAttachmentClick = () => {\n    const attachmentInputNode = findDOMNode(this.refs.attachment);\n    attachmentInputNode.setAttribute('multiple', true);\n    attachmentInputNode.click();\n  };\n\n  handleComposeAttachmentChange = () => {\n    const attachmentInputNode = findDOMNode(this.refs.attachment);\n    let attachments = [];\n\n    forEach(attachmentInputNode.files, (file) => attachments.push(file));\n\n    AttachmentsActionCreators.show(attachments);\n    this.resetAttachmentForm();\n  };\n\n  sendVoiceRecord = (duration, record) => {\n    const { peer } = this.state;\n    MessageActionCreators.sendVoiceMessage(peer, duration, record);\n  };\n\n  // TODO: remove this method\n  getCaretPosition() {\n    if (this.refs.area) {\n      return this.refs.area.getCaretPosition();\n    }\n\n    return 0;\n  }\n\n  renderCommands() {\n    const { compose } = this.state;\n    if (!compose.commands) {\n      return null;\n    }\n\n    return (\n      <BotCommandsHint\n        commands={compose.commands}\n        onSelect={this.onCommandSelect}\n        onClose={this.onCommandClose}\n      />\n    );\n  }\n\n  renderMentions() {\n    const { compose } = this.state;\n    if (!compose.mentions) {\n      return null;\n    }\n\n    return (\n      <MentionDropdown\n        mentions={compose.mentions}\n        onSelect={this.onMentionSelect}\n        onClose={this.onMentionClose}\n      />\n    );\n  }\n\n  renderEditing() {\n    const { compose, profile, stickers, isMessageArtOpen, sendByEnter } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <section className=\"compose compose--editing\">\n\n        {this.renderMentions()}\n        {this.renderCommands()}\n\n        <MessageArt\n          onSelect={this.handleEmojiSelect}\n          onStickerSelect={this.handleStickerSelect}\n          isActive={isMessageArtOpen}\n          stickers={stickers}\n        />\n\n        <AvatarItem\n          className=\"my-avatar\"\n          image={profile.avatar}\n          placeholder={profile.placeholder}\n          title={profile.name}\n        />\n\n        <ComposeMarkdownHint isActive={compose.text.length >= 3} />\n        <ComposeTextArea\n          autoFocus\n          ref=\"area\"\n          value={compose.text}\n          sendByEnter={sendByEnter}\n          sendEnabled={!compose.mentions && !compose.commands}\n          onTyping={this.onEditTyping}\n          onSubmit={this.onEditSubmit}\n          onKeyDown={this.onEditKeyDown}\n        />\n\n        <footer className=\"compose__footer row\">\n          <span className=\"col-xs\"/>\n          <p className=\"compose__edit-title\">\n            <FormattedMessage id=\"compose.editTitle\" />\n          </p>\n          <button className=\"button button--cancel\" onClick={this.onEditCancel}>\n            {intl.messages['compose.cancel']}\n          </button>\n          <button className=\"button button--lightblue\" onClick={this.onEditSubmit}>\n            {intl.messages['compose.edit']}\n          </button>\n        </footer>\n      </section>\n    );\n  }\n\n  renderPosting() {\n    const { compose, profile, stickers, isMessageArtOpen, sendByEnter } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <section className=\"compose\">\n\n        {this.renderMentions()}\n        {this.renderCommands()}\n\n        <MessageArt\n          onSelect={this.handleEmojiSelect}\n          onStickerSelect={this.handleStickerSelect}\n          isActive={isMessageArtOpen}\n          stickers={stickers}\n        />\n\n        <VoiceRecorder onFinish={this.sendVoiceRecord}/>\n\n        <AvatarItem\n          className=\"my-avatar\"\n          image={profile.avatar}\n          placeholder={profile.placeholder}\n          title={profile.name}\n        />\n\n        <ComposeMarkdownHint isActive={compose.text.length >= 3} />\n        <ComposeTextArea\n          ref=\"area\"\n          value={compose.text}\n          autoFocus={compose.autoFocus}\n          sendByEnter={sendByEnter}\n          sendEnabled={!compose.mentions && !compose.commands}\n          onTyping={this.onTyping}\n          onSubmit={this.onSubmit}\n          onPaste={this.onPaste}\n          onKeyDown={this.onKeyDown}\n        />\n\n        <DropZone onDropComplete={this.handleDrop}>\n          {intl.messages['compose.dropzone']}\n        </DropZone>\n\n        <footer className=\"compose__footer row\">\n          <button className=\"button attachment\" onClick={this.handleAttachmentClick}>\n            <i className=\"material-icons\">attachment</i> {intl.messages['compose.attach']}\n          </button>\n          <span className=\"col-xs\"/>\n          <button className=\"button button--lightblue\" onClick={this.onSubmit}>\n            {intl.messages['compose.send']}\n          </button>\n        </footer>\n\n        <form className=\"compose__hidden\" ref=\"attachmentForm\">\n          <input ref=\"attachment\" onChange={this.handleComposeAttachmentChange} type=\"file\"/>\n        </form>\n      </section>\n    );\n  }\n\n  render() {\n    const { delegate } = this.context;\n    const { compose } = this.state;\n    if (delegate.features.editing && compose.editMessage) {\n      return this.renderEditing();\n    }\n\n    return this.renderPosting();\n  }\n}\n\nexport default Container.create(ComposeSection, { pure: false });\n"]}