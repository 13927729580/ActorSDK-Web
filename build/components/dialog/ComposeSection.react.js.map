{"version":3,"sources":["../../../src/components/dialog/ComposeSection.react.js"],"names":[],"mappings":"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","file":"ComposeSection.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { forEach } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\n\nimport ActorClient from '../../utils/ActorClient';\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport MessageActionCreators from '../../actions/MessageActionCreators';\nimport ComposeActionCreators from '../../actions/ComposeActionCreators';\nimport AttachmentsActionCreators from '../../actions/AttachmentsActionCreators';\nimport EmojiActionCreators from '../../actions/EmojiActionCreators';\nimport StickersActionCreators from '../../actions/StickersActionCreators';\n\nimport GroupStore from '../../stores/GroupStore';\nimport PreferencesStore from '../../stores/PreferencesStore';\nimport ComposeStore from '../../stores/ComposeStore';\nimport DialogStore from '../../stores/DialogStore';\nimport MessageArtStore from '../../stores/MessageArtStore';\n\nimport ComposeTextArea from './compose/ComposeTextArea.react';\nimport ComposeMarkdownHint from './compose/ComposeMarkdownHint.react';\nimport AvatarItem from '../common/AvatarItem.react';\nimport MentionDropdown from '../common/MentionDropdown.react';\nimport MessageArt from '../messageArt/MessageArt.react';\nimport VoiceRecorder from '../common/VoiceRecorder.react';\nimport DropZone from '../common/DropZone.react';\n\nclass ComposeSection extends Component {\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  static getStores() {\n    return [DialogStore, GroupStore, PreferencesStore, ComposeStore, MessageArtStore];\n  }\n\n  static calculateState() {\n    return {\n      peer: DialogStore.getCurrentPeer(),\n      text: ComposeStore.getText(),\n      profile: ActorClient.getUser(ActorClient.getUid()),\n      sendByEnter: PreferencesStore.isSendByEnterEnabled(),\n      mentions: ComposeStore.getMentions(),\n      isAutoFocusEnabled: ComposeStore.isAutoFocusEnabled(),\n      isMessageArtOpen: MessageArtStore.getState().isOpen,\n      stickers: MessageArtStore.getState().stickers\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.peer !== this.state.peer) {\n      if (this.refs.area) {\n        this.refs.area.autoFocus();\n      }\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.onTyping = this.onTyping.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.onPaste = this.onPaste.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  onTyping(text, caretPosition) {\n    ComposeActionCreators.onTyping(this.state.peer, text, caretPosition);\n  }\n\n  onSubmit() {\n    const { peer, text } = this.state;\n\n    if (text.trim().length) {\n      MessageActionCreators.sendTextMessage(peer, text);\n    }\n\n    ComposeActionCreators.cleanText();\n  }\n\n  onPaste(event) {\n    const attachments = Array.from(event.clipboardData.items)\n      .filter((item) => item.type.indexOf('image') !== -1)\n      .map((item) => item.getAsFile());\n\n    if (attachments.length) {\n      event.preventDefault();\n      AttachmentsActionCreators.show(attachments);\n    }\n  }\n\n  onKeyDown(event) {\n    if (event.keyCode === KeyCodes.ARROW_UP && !event.target.value) {\n      MessageActionCreators.editLastMessage();\n    }\n  }\n\n  resetAttachmentForm = () => {\n    const form = findDOMNode(this.refs.attachmentForm);\n    form.reset();\n  };\n\n  onMentionSelect = (mention) => {\n    const { peer, text } = this.state;\n\n    ComposeActionCreators.insertMention(peer, text, this.getCaretPosition(), mention);\n    this.setFocus();\n  };\n\n  onMentionClose = () => {\n    ComposeActionCreators.closeMention();\n  };\n\n  handleEmojiSelect = (emoji) => {\n    EmojiActionCreators.insertEmoji(this.state.text, this.getCaretPosition(), emoji);\n    this.setFocus();\n  };\n\n  handleStickerSelect = (sticker) => {\n    const { peer } = this.state;\n    StickersActionCreators.sendSticker(peer, sticker);\n    this.setFocus();\n  };\n\n  setFocus = () => {\n    findDOMNode(this.refs.area).focus();\n  };\n\n  handleDrop = (files) => {\n    let attachments = [];\n\n    forEach(files, (file) => attachments.push(file));\n\n    if (attachments.length > 0) {\n      AttachmentsActionCreators.show(attachments);\n    }\n  };\n\n  handleAttachmentClick = () => {\n    const attachmentInputNode = findDOMNode(this.refs.attachment);\n    attachmentInputNode.setAttribute('multiple', true);\n    attachmentInputNode.click();\n  };\n\n  handleComposeAttachmentChange = () => {\n    const attachmentInputNode = findDOMNode(this.refs.attachment);\n    let attachments = [];\n\n    forEach(attachmentInputNode.files, (file) => attachments.push(file));\n\n    AttachmentsActionCreators.show(attachments);\n    this.resetAttachmentForm();\n  };\n\n  sendVoiceRecord = (duration, record) => {\n    const { peer } = this.state;\n    MessageActionCreators.sendVoiceMessage(peer, duration, record);\n  };\n\n  render() {\n    const { text, profile, mentions, stickers, isAutoFocusEnabled, isMessageArtOpen, sendByEnter } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <section className=\"compose\">\n\n        <MentionDropdown\n          mentions={mentions}\n          onSelect={this.onMentionSelect}\n          onClose={this.onMentionClose}\n        />\n\n        <MessageArt\n          onSelect={this.handleEmojiSelect}\n          onStickerSelect={this.handleStickerSelect}\n          isActive={isMessageArtOpen}\n          stickers={stickers}\n        />\n\n        <VoiceRecorder onFinish={this.sendVoiceRecord}/>\n\n        <AvatarItem\n          className=\"my-avatar\"\n          image={profile.avatar}\n          placeholder={profile.placeholder}\n          title={profile.name}\n        />\n\n        <ComposeMarkdownHint isActive={text.length >= 3} />\n        <ComposeTextArea\n          ref=\"area\"\n          value={text}\n          autoFocus={isAutoFocusEnabled}\n          sendByEnter={sendByEnter}\n          onTyping={this.onTyping}\n          onSubmit={this.onSubmit}\n          onPaste={this.onPaste}\n          onKeyDown={this.onKeyDown}\n        />\n\n        <DropZone onDropComplete={this.handleDrop}>\n          {intl.messages['compose.dropzone']}\n        </DropZone>\n\n        <footer className=\"compose__footer row\">\n          <button className=\"button attachment\" onClick={this.handleAttachmentClick}>\n            <i className=\"material-icons\">attachment</i> {intl.messages['compose.attach']}\n          </button>\n          <span className=\"col-xs\"/>\n          <button className=\"button button--lightblue\" onClick={this.sendTextMessage}>\n            {intl.messages['compose.send']}\n          </button>\n        </footer>\n\n        <form className=\"compose__hidden\" ref=\"attachmentForm\">\n          <input ref=\"attachment\" onChange={this.handleComposeAttachmentChange} type=\"file\"/>\n        </form>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(ComposeSection, { pure: false });\n"]}