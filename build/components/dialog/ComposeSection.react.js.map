{"version":3,"sources":["../../../src/components/dialog/ComposeSection.react.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAkCM,cAAc;YAAd,cAAc;;eAAd,cAAc;;mCAGI,SAAS,EAAE;AAC/B,aAAO;AACL,YAAI,EAAE,sBAAY,cAAc,EAAE;AAClC,YAAI,EAAE,uBAAa,OAAO,EAAE;AAC5B,eAAO,EAAE,sBAAY,OAAO,CAAC,sBAAY,MAAM,EAAE,CAAC;AAClD,mBAAW,EAAE,2BAAiB,oBAAoB,EAAE;AACpD,gBAAQ,EAAE,uBAAa,WAAW,EAAE;AACpC,4BAAoB,EAAE,0BAAgB,MAAM,EAAE;AAC9C,0BAAkB,EAAE,SAAS,GAAG,SAAS,CAAC,kBAAkB,IAAI,KAAK,GAAG,KAAK;AAC7E,uBAAe,EAAE,uBAAa,eAAe,EAAE;OAChD,CAAC;KACH;;;AAMD,WApBI,cAAc,CAoBN,KAAK,EAAE;0BApBf,cAAc;;uEAAd,cAAc,aAqBV,KAAK;;UAmBb,aAAa,GAAG,UAAC,KAAK,EAAK;AACzB,UAAI,CAAC,KAAK,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;AACxE,cAAK,QAAQ,EAAE,CAAC;OACjB;KACF;;UAED,eAAe,GAAG,UAAA,KAAK,EAAI;AACzB,UAAM,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;UACxB,IAAI,GAAK,MAAK,KAAK,CAAnB,IAAI;;AAEZ,UAAI,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;AACpB,cAAK,QAAQ,CAAC,EAAC,kBAAkB,EAAE,IAAI,EAAC,CAAC,CAAA;OAC1C,MAAM;AACL,cAAK,QAAQ,CAAC,EAAC,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAA;OAC3C;;AAED,sCAAsB,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAE,MAAK,gBAAgB,EAAE,CAAC,CAAC;KACrE;;UAED,SAAS,GAAG,UAAA,KAAK,EAAI;wBACe,MAAK,KAAK;UAApC,QAAQ,eAAR,QAAQ;UAAE,WAAW,eAAX,WAAW;;AAE7B,UAAM,IAAI,GAAG,SAAP,IAAI,GAAS;AACjB,aAAK,CAAC,cAAc,EAAE,CAAC;AACvB,cAAK,eAAe,EAAE,CAAC;AACvB,cAAK,QAAQ,CAAC,EAAC,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAA;OAC3C,CAAC;;AAEF,UAAI,QAAQ,KAAK,IAAI,EAAE;AACrB,YAAI,WAAW,KAAK,IAAI,EAAE;AACxB,cAAI,KAAK,CAAC,OAAO,KAAK,4BAAS,KAAK,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;AACvD,gBAAI,EAAE,CAAC;WACR;SACF,MAAM;AACL,cAAI,KAAK,CAAC,OAAO,KAAK,4BAAS,KAAK,IAAI,KAAK,CAAC,OAAO,EAAE;AACrD,gBAAI,EAAE,CAAC;WACR;SACF;OACF;KACF;;UAED,eAAe,GAAG,YAAM;yBACC,MAAK,KAAK;UAAzB,IAAI,gBAAJ,IAAI;UAAE,IAAI,gBAAJ,IAAI;;AAElB,UAAI,IAAI,CAAC,IAAI,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE;AAC5B,wCAAsB,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACnD;AACD,sCAAsB,SAAS,EAAE,CAAC;KACnC;;UAED,mBAAmB,GAAG,YAAM;AAC1B,UAAM,IAAI,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,cAAc,CAAC,CAAC;AACzD,UAAI,CAAC,KAAK,EAAE,CAAC;KACd;;UAED,OAAO,GAAG,UAAA,KAAK,EAAI;AACjB,UAAI,cAAc,GAAG,KAAK,CAAC;;AAE3B,2BAAQ,KAAK,CAAC,aAAa,CAAC,KAAK,EAAE,UAAC,IAAI,EAAK;AAC3C,YAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE;AACrC,wBAAc,GAAG,IAAI,CAAC;AACtB,0CAAsB,yBAAyB,CAAC,MAAK,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;SACpF;OACF,QAAO,CAAC;;AAET,UAAI,cAAc,EAAE;AAClB,aAAK,CAAC,cAAc,EAAE,CAAC;OACxB;KACF;;UAED,eAAe,GAAG,UAAC,OAAO,EAAK;yBACN,MAAK,KAAK;UAAzB,IAAI,gBAAJ,IAAI;UAAE,IAAI,gBAAJ,IAAI;;AAElB,sCAAsB,aAAa,CAAC,IAAI,EAAE,IAAI,EAAE,MAAK,gBAAgB,EAAE,EAAE,OAAO,CAAC,CAAC;AAClF,sBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;KAC3C;;UAED,cAAc,GAAG,YAAM;AACrB,sCAAsB,YAAY,EAAE,CAAC;KACtC;;UAED,gBAAgB,GAAG,YAAM;AACvB,UAAM,WAAW,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,IAAI,CAAC,CAAC;AACtD,UAAM,SAAS,GAAG,iBAAO,iBAAiB,CAAC,WAAW,CAAC,CAAC;AACxD,aAAO,SAAS,CAAC,KAAK,CAAC;KACxB;;UAED,iBAAiB,GAAG,UAAC,KAAK,EAAK;AAC7B,oCAAoB,WAAW,CAAC,MAAK,KAAK,CAAC,IAAI,EAAE,MAAK,gBAAgB,EAAE,EAAE,KAAK,CAAC,CAAC;AACjF,sBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAA;KAC1C;;UAED,QAAQ,GAAG,YAAM;UACP,eAAe,GAAK,MAAK,KAAK,CAA9B,eAAe;;AAEvB,UAAI,CAAC,eAAe,EAAE;AACpB,wBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;OAC3C;KAEF;;UAED,UAAU,GAAG,UAAC,KAAK,EAAK;AACtB,UAAI,WAAW,GAAG,EAAE,CAAC;;AAErB,2BAAQ,KAAK,EAAE,UAAC,IAAI;eAAK,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC;OAAA,CAAC,CAAC;;AAEjD,UAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AAC1B,4CAA0B,IAAI,CAAC,WAAW,CAAC,CAAC;OAC7C;KACF;;UAED,qBAAqB,GAAG,YAAM;AAC5B,UAAM,mBAAmB,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,UAAU,CAAC,CAAC;AACpE,yBAAmB,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;AACnD,yBAAmB,CAAC,KAAK,EAAE,CAAC;KAC7B;;UAED,6BAA6B,GAAG,YAAM;AACpC,UAAM,mBAAmB,GAAG,gBAAM,WAAW,CAAC,MAAK,IAAI,CAAC,UAAU,CAAC,CAAC;AACpE,UAAI,WAAW,GAAG,EAAE,CAAC;;AAErB,2BAAQ,mBAAmB,CAAC,KAAK,EAAE,UAAC,IAAI;eAAK,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC;OAAA,CAAC,CAAC;;AAErE,0CAA0B,IAAI,CAAC,WAAW,CAAC,CAAC;AAC5C,YAAK,mBAAmB,EAAE,CAAC;KAC5B;;UAED,eAAe,GAAG,UAAC,MAAM,EAAK;AAC5B,aAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAA;KAC3C;;AAlJC,UAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAK,QAAQ,CAAC,CAAC;AAChD,YAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAK,aAAa,EAAE,KAAK,CAAC,CAAC;;GACjE;;eAzBG,cAAc;;2CA2BK;AACrB,YAAM,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;AACnD,cAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;KACpE;;;wCAEmB;AAClB,UAAI,CAAC,QAAQ,EAAE,CAAC;KACjB;;;yCAEoB;AACnB,UAAI,CAAC,QAAQ,EAAE,CAAC;KACjB;;;6BAqIQ;mBACsE,IAAI,CAAC,KAAK;UAA/E,IAAI,UAAJ,IAAI;UAAE,OAAO,UAAP,OAAO;UAAE,QAAQ,UAAR,QAAQ;UAAE,iBAAiB,UAAjB,iBAAiB;UAAE,oBAAoB,UAApB,oBAAoB;UAChE,cAAc,GAAK,IAAI,CAAC,OAAO,CAA/B,cAAc;;AACtB,UAAM,qBAAqB,GAAG,0BAAW,wBAAwB,EAAE;AACjE,wCAAgC,EAAE,iBAAiB;OACpD,CAAC,CAAC;;AAEH,aACE;;UAAS,SAAS,EAAC,SAAS;QAC1B,2DAAiB,QAAQ,EAAE,QAAQ,AAAC;AACnB,kBAAQ,EAAE,IAAI,CAAC,eAAe,AAAC;AAC/B,iBAAO,EAAE,IAAI,CAAC,cAAc,AAAC,GAAE;QAEhD,yDAAe,QAAQ,EAAE,IAAI,CAAC,iBAAiB,AAAC,GAAE;QAGhD,cAAc,GACV,yDAAe,QAAQ,EAAE,IAAI,CAAC,eAAe,AAAC,GAAE,GAChD,IAAI;QAGV;;YAAK,SAAS,EAAE,qBAAqB,AAAC;UACpC;;;;YAAK,IAAI,CAAC,cAAc,CAAC,uBAAuB,CAAC;;WAAM;;UAEvD;;;;YAAK,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC;;WAAM;;UAEzD;;;;YAAU,IAAI,CAAC,cAAc,CAAC,+BAA+B,CAAC;;WAAW;SACrE;QAEN,sDAAY,SAAS,EAAC,WAAW;AACrB,eAAK,EAAE,OAAO,CAAC,MAAM,AAAC;AACtB,qBAAW,EAAE,OAAO,CAAC,WAAW,AAAC;AACjC,eAAK,EAAE,OAAO,CAAC,IAAI,AAAC,GAAE;QAElC,4CAAU,SAAS,EAAC,kBAAkB;AAC5B,kBAAQ,EAAE,IAAI,CAAC,eAAe,AAAC;AAC/B,mBAAS,EAAE,IAAI,CAAC,SAAS,AAAC;AAC1B,iBAAO,EAAE,IAAI,CAAC,OAAO,AAAC;AACtB,eAAK,EAAE,IAAI,AAAC;AACZ,aAAG,EAAC,MAAM,GAAE;QAEtB;;YAAU,cAAc,EAAE,IAAI,CAAC,UAAU,AAAC;UAAE,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;SAAY;QAE/F;;YAAQ,SAAS,EAAC,qBAAqB;UACrC;;cAAQ,SAAS,EAAC,mBAAmB,EAAC,OAAO,EAAE,IAAI,CAAC,qBAAqB,AAAC;YACxE;;gBAAG,SAAS,EAAC,gBAAgB;;aAAe;;YAAE,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC;WAC5E;UACT,wCAAM,SAAS,EAAC,QAAQ,GAAE;UAC1B;;cAAQ,SAAS,EAAC,0BAA0B,EAAC,OAAO,EAAE,IAAI,CAAC,eAAe,AAAC;YACxE,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC;WAC7B;SACF;QAET;;YAAM,SAAS,EAAC,iBAAiB,EAAC,GAAG,EAAC,gBAAgB;UACpD,yCAAO,GAAG,EAAC,YAAY,EAAC,QAAQ,EAAE,IAAI,CAAC,6BAA6B,AAAC,EAAC,IAAI,EAAC,MAAM,GAAE;SAC9E;QAGN,oBAAoB,GAAG,6DAAiB,GAAG,IAAI;OAExC,CACV;KACH;;;SAzOG,cAAc;;;AAAd,cAAc,CACX,SAAS,GAAG;SAAM,4HAA0E;CAAA;;AAD/F,cAAc,CAgBX,YAAY,GAAG;AACpB,gBAAc,EAAE,iBAAU,IAAI;CAC/B;;AA0NH,qBAAW,OAAO,CAAC,cAAc,uBAAY,CAAC;;kBAE/B,iBAAU,MAAM,CAAC,cAAc,CAAC","file":"ComposeSection.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { assign, forEach } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport ReactMixin from 'react-mixin';\nimport { IntlMixin } from 'react-intl';\nimport { Container } from 'flux/utils';\n\nimport ActorClient from '../../utils/ActorClient';\nimport Inputs from '../../utils/Inputs';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport MessageActionCreators from '../../actions/MessageActionCreators';\nimport ComposeActionCreators from '../../actions/ComposeActionCreators';\nimport AttachmentsActionCreators from '../../actions/AttachmentsActionCreators';\nimport EmojiActionCreators from '../../actions/EmojiActionCreators';\n\nimport GroupStore from '../../stores/GroupStore';\nimport PreferencesStore from '../../stores/PreferencesStore';\nimport ComposeStore from '../../stores/ComposeStore';\nimport AttachmentStore from '../../stores/AttachmentStore';\nimport DialogStore from '../../stores/DialogStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport MentionDropdown from '../common/MentionDropdown.react';\nimport EmojiDropdown from '../common/EmojiDropdown.react';\nimport VoiceRecorder from '../common/VoiceRecorder.react';\nimport DropZone from '../common/DropZone.react';\nimport SendAttachment from '../modals/SendAttachment';\n\nclass ComposeSection extends Component {\n  static getStores = () => [DialogStore, GroupStore, PreferencesStore, AttachmentStore, ComposeStore];\n\n  static calculateState(prevState) {\n    return {\n      peer: DialogStore.getCurrentPeer(),\n      text: ComposeStore.getText(),\n      profile: ActorClient.getUser(ActorClient.getUid()),\n      sendByEnter: PreferencesStore.isSendByEnterEnabled(),\n      mentions: ComposeStore.getMentions(),\n      isSendAttachmentOpen: AttachmentStore.isOpen(),\n      isMarkdownHintShow: prevState ? prevState.isMarkdownHintShow || false : false,\n      isFocusDisabled: ComposeStore.isFocusDisabled()\n    };\n  }\n\n  static contextTypes = {\n    isExperimental: PropTypes.bool\n  };\n\n  constructor(props) {\n    super(props);\n\n    window.addEventListener('focus', this.setFocus);\n    document.addEventListener('keydown', this.handleKeyDown, false);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('focus', this.setFocus);\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n  }\n\n  componentDidMount() {\n    this.setFocus();\n  }\n\n  componentDidUpdate() {\n    this.setFocus();\n  }\n\n  handleKeyDown = (event) => {\n    if (!event.metaKey && !event.altKey && !event.ctrlKey && !event.shiftKey) {\n      this.setFocus();\n    }\n  };\n\n  onMessageChange = event => {\n    const text = event.target.value;\n    const { peer } = this.state;\n\n    if (text.length >= 3) {\n      this.setState({isMarkdownHintShow: true})\n    } else {\n      this.setState({isMarkdownHintShow: false})\n    }\n\n    ComposeActionCreators.onTyping(peer, text, this.getCaretPosition());\n  };\n\n  onKeyDown = event => {\n    const { mentions, sendByEnter } = this.state;\n\n    const send = () => {\n      event.preventDefault();\n      this.sendTextMessage();\n      this.setState({isMarkdownHintShow: false})\n    };\n\n    if (mentions === null) {\n      if (sendByEnter === true) {\n        if (event.keyCode === KeyCodes.ENTER && !event.shiftKey) {\n          send();\n        }\n      } else {\n        if (event.keyCode === KeyCodes.ENTER && event.metaKey) {\n          send();\n        }\n      }\n    }\n  };\n\n  sendTextMessage = () => {\n    const { peer, text } = this.state;\n\n    if (text.trim().length !== 0) {\n      MessageActionCreators.sendTextMessage(peer, text);\n    }\n    ComposeActionCreators.cleanText();\n  };\n\n  resetAttachmentForm = () => {\n    const form = React.findDOMNode(this.refs.attachmentForm);\n    form.reset();\n  };\n\n  onPaste = event => {\n    let preventDefault = false;\n\n    forEach(event.clipboardData.items, (item) => {\n      if (item.type.indexOf('image') !== -1) {\n        preventDefault = true;\n        MessageActionCreators.sendClipboardPhotoMessage(this.props.peer, item.getAsFile());\n      }\n    }, this);\n\n    if (preventDefault) {\n      event.preventDefault();\n    }\n  };\n\n  onMentionSelect = (mention) => {\n    const { peer, text } = this.state;\n\n    ComposeActionCreators.insertMention(peer, text, this.getCaretPosition(), mention);\n    React.findDOMNode(this.refs.area).focus();\n  };\n\n  onMentionClose = () => {\n    ComposeActionCreators.closeMention();\n  };\n\n  getCaretPosition = () => {\n    const composeArea = React.findDOMNode(this.refs.area);\n    const selection = Inputs.getInputSelection(composeArea);\n    return selection.start;\n  };\n\n  handleEmojiSelect = (emoji) => {\n    EmojiActionCreators.insertEmoji(this.state.text, this.getCaretPosition(), emoji);\n    React.findDOMNode(this.refs.area).focus()\n  };\n\n  setFocus = () => {\n    const { isFocusDisabled } = this.state;\n\n    if (!isFocusDisabled) {\n      React.findDOMNode(this.refs.area).focus();\n    }\n\n  };\n\n  handleDrop = (files) => {\n    let attachments = [];\n\n    forEach(files, (file) => attachments.push(file));\n\n    if (attachments.length > 0) {\n      AttachmentsActionCreators.show(attachments);\n    }\n  };\n\n  handleAttachmentClick = () => {\n    const attachmentInputNode = React.findDOMNode(this.refs.attachment);\n    attachmentInputNode.setAttribute('multiple', true);\n    attachmentInputNode.click();\n  };\n\n  handleComposeAttachmentChange = () => {\n    const attachmentInputNode = React.findDOMNode(this.refs.attachment);\n    let attachments = [];\n\n    forEach(attachmentInputNode.files, (file) => attachments.push(file));\n\n    AttachmentsActionCreators.show(attachments);\n    this.resetAttachmentForm();\n  };\n\n  sendVoiceRecord = (record) => {\n    console.debug('sendVoiceRecord: ', record)\n  };\n\n  render() {\n    const { text, profile, mentions, isMardownHintShow, isSendAttachmentOpen } = this.state;\n    const { isExperimental } = this.context;\n    const markdownHintClassName = classnames('compose__markdown-hint', {\n      'compose__markdown-hint--active': isMardownHintShow\n    });\n\n    return (\n      <section className=\"compose\">\n        <MentionDropdown mentions={mentions}\n                         onSelect={this.onMentionSelect}\n                         onClose={this.onMentionClose}/>\n\n        <EmojiDropdown onSelect={this.handleEmojiSelect}/>\n\n        {\n          isExperimental\n            ? <VoiceRecorder onFinish={this.sendVoiceRecord}/>\n            : null\n        }\n\n        <div className={markdownHintClassName}>\n          <b>*{this.getIntlMessage('compose.markdown.bold')}*</b>\n          &nbsp;&nbsp;\n          <i>_{this.getIntlMessage('compose.markdown.italic')}_</i>\n          &nbsp;&nbsp;\n          <code>```{this.getIntlMessage('compose.markdown.preformatted')}```</code>\n        </div>\n\n        <AvatarItem className=\"my-avatar\"\n                    image={profile.avatar}\n                    placeholder={profile.placeholder}\n                    title={profile.name}/>\n\n        <textarea className=\"compose__message\"\n                  onChange={this.onMessageChange}\n                  onKeyDown={this.onKeyDown}\n                  onPaste={this.onPaste}\n                  value={text}\n                  ref=\"area\"/>\n\n        <DropZone onDropComplete={this.handleDrop}>{this.getIntlMessage('compose.dropzone')}</DropZone>\n\n        <footer className=\"compose__footer row\">\n          <button className=\"button attachment\" onClick={this.handleAttachmentClick}>\n            <i className=\"material-icons\">attachment</i> {this.getIntlMessage('compose.attach')}\n          </button>\n          <span className=\"col-xs\"/>\n          <button className=\"button button--lightblue\" onClick={this.sendTextMessage}>\n            {this.getIntlMessage('compose.send')}\n          </button>\n        </footer>\n\n        <form className=\"compose__hidden\" ref=\"attachmentForm\">\n          <input ref=\"attachment\" onChange={this.handleComposeAttachmentChange} type=\"file\"/>\n        </form>\n\n        {/* Attachment modal */}\n        {isSendAttachmentOpen ? <SendAttachment/> : null}\n\n      </section>\n    );\n  }\n}\n\nReactMixin.onClass(ComposeSection, IntlMixin);\n\nexport default Container.create(ComposeSection);\n"]}