{"version":3,"sources":["../../../src/components/dialog/ComposeSection.react.js"],"names":[],"mappings":"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","file":"ComposeSection.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { assign, forEach } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport ReactMixin from 'react-mixin';\nimport addons from 'react/addons';\nimport { IntlMixin } from 'react-intl';\n\nconst {addons: { PureRenderMixin }} = addons;\n\nimport ActorClient from '../../utils/ActorClient';\nimport Inputs from '../../utils/Inputs';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport MessageActionCreators from '../../actions/MessageActionCreators';\nimport ComposeActionCreators from '../../actions/ComposeActionCreators';\nimport AttachmentsActionCreators from '../../actions/AttachmentsActionCreators';\n\nimport GroupStore from '../../stores/GroupStore';\nimport PreferencesStore from '../../stores/PreferencesStore';\nimport ComposeStore from '../../stores/ComposeStore';\nimport AttachmentStore from '../../stores/AttachmentStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport MentionDropdown from '../common/MentionDropdown.react';\nimport EmojiDropdown from '../common/EmojiDropdown.react';\nimport DropZone from '../common/DropZone.react';\nimport SendAttachment from '../modals/SendAttachment';\n\nlet getStateFromStores = () => {\n  return {\n    text: ComposeStore.getText(),\n    profile: ActorClient.getUser(ActorClient.getUid()),\n    sendByEnter: PreferencesStore.isSendByEnterEnabled(),\n    mentions: ComposeStore.getMentions(),\n    isSendAttachmentOpen: AttachmentStore.isOpen()\n  };\n};\n\nclass ComposeSection extends Component {\n  static propTypes = {\n    peer: PropTypes.object.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = assign({\n      isEmojiDropdownShow: false,\n      isMardownHintShow: false\n    }, getStateFromStores());\n\n    ComposeStore.addChangeListener(this.onChange);\n    GroupStore.addListener(this.onChange);\n    PreferencesStore.addListener(this.onChange);\n    AttachmentStore.addListener(this.onChange);\n\n    window.addEventListener('focus', this.setFocus);\n  }\n\n  componentWillUnmount() {\n    ComposeStore.removeChangeListener(this.onChange);\n\n    window.removeEventListener('focus', this.setFocus);\n  }\n\n  componentWillReceiveProps() {\n    this.setFocus();\n    this.setState({isMardownHintShow: false})\n  }\n\n  onChange = () => this.setState(getStateFromStores());\n\n  onMessageChange = event => {\n    const text = event.target.value;\n    const { peer } = this.props;\n\n    if (text.length >= 3) {\n      this.setState({isMardownHintShow: true})\n    } else {\n      this.setState({isMardownHintShow: false})\n    }\n\n    ComposeActionCreators.onTyping(peer, text, this.getCaretPosition());\n  };\n\n  onKeyDown = event => {\n    const { mentions, sendByEnter } = this.state;\n\n    const send = () => {\n      event.preventDefault();\n      this.sendTextMessage();\n      this.setState({isMardownHintShow: false})\n    };\n\n    if (mentions === null) {\n      if (sendByEnter === true) {\n        if (event.keyCode === KeyCodes.ENTER && !event.shiftKey) {\n          send();\n        }\n      } else {\n        if (event.keyCode === KeyCodes.ENTER && event.metaKey) {\n          send();\n        }\n      }\n    }\n  };\n\n  sendTextMessage = () => {\n    const { text } = this.state;\n    const { peer } = this.props;\n\n    if (text.trim().length !== 0) {\n      MessageActionCreators.sendTextMessage(peer, text);\n    }\n    ComposeActionCreators.cleanText();\n  };\n\n  resetAttachmentForm = () => {\n    const form = React.findDOMNode(this.refs.attachmentForm);\n    form.reset();\n  };\n\n  onPaste = event => {\n    let preventDefault = false;\n\n    forEach(event.clipboardData.items, (item) => {\n      if (item.type.indexOf('image') !== -1) {\n        preventDefault = true;\n        MessageActionCreators.sendClipboardPhotoMessage(this.props.peer, item.getAsFile());\n      }\n    }, this);\n\n    if (preventDefault) {\n      event.preventDefault();\n    }\n  };\n\n  onMentionSelect = (mention) => {\n    const { peer } = this.props;\n    const { text } = this.state;\n\n    ComposeActionCreators.insertMention(peer, text, this.getCaretPosition(), mention);\n    React.findDOMNode(this.refs.area).focus();\n  };\n\n  onMentionClose = () => {\n    ComposeActionCreators.closeMention();\n  };\n\n  getCaretPosition = () => {\n    const composeArea = React.findDOMNode(this.refs.area);\n    const selection = Inputs.getInputSelection(composeArea);\n    return selection.start;\n  };\n\n  onEmojiDropdownSelect = (emoji) => {\n    ComposeActionCreators.insertEmoji(this.state.text, this.getCaretPosition(), emoji);\n    React.findDOMNode(this.refs.area).focus();\n  };\n  onEmojiDropdownClose = () => this.setState({isEmojiDropdownShow: false});\n  onEmojiShowClick = () => this.setState({isEmojiDropdownShow: true});\n\n  setFocus = () => React.findDOMNode(this.refs.area).focus();\n\n  handleDrop = (files) => {\n    let attachments = [];\n\n    forEach(files, (file) => attachments.push(file));\n\n    if (attachments.length > 0) {\n      AttachmentsActionCreators.show(attachments);\n    }\n  };\n\n  handleAttachmentClick = () => {\n    const attachmentInputNode = React.findDOMNode(this.refs.attachment);\n    attachmentInputNode.setAttribute('multiple', true);\n    attachmentInputNode.click();\n  };\n\n  handleComposeAttachmentChange = () => {\n    const attachmentInputNode = React.findDOMNode(this.refs.attachment);\n    let attachments = [];\n\n    forEach(attachmentInputNode.files, (file) => attachments.push(file));\n\n    AttachmentsActionCreators.show(attachments);\n    this.resetAttachmentForm();\n  };\n\n  render() {\n    const { text, profile, mentions, isEmojiDropdownShow, isMardownHintShow, isSendAttachmentOpen } = this.state;\n\n    const emojiOpenerClassName = classnames('emoji-opener material-icons', {\n      'emoji-opener--active': isEmojiDropdownShow\n    });\n    const markdownHintClassName = classnames('compose__markdown-hint', {\n      'compose__markdown-hint--active': isMardownHintShow\n    });\n\n    return (\n      <section className=\"compose\" onPaste={this.onPaste}>\n\n        <MentionDropdown mentions={mentions}\n                         onSelect={this.onMentionSelect}\n                         onClose={this.onMentionClose}/>\n\n        <EmojiDropdown isOpen={isEmojiDropdownShow}\n                       onSelect={this.onEmojiDropdownSelect}\n                       onClose={this.onEmojiDropdownClose}/>\n\n        <i className={emojiOpenerClassName}\n           onClick={this.onEmojiShowClick}>insert_emoticon</i>\n\n        <div className={markdownHintClassName}>\n          <b>*{this.getIntlMessage('compose.markdown.bold')}*</b>\n          &nbsp;&nbsp;\n          <i>_{this.getIntlMessage('compose.markdown.italic')}_</i>\n          &nbsp;&nbsp;\n          <code>```{this.getIntlMessage('compose.markdown.preformatted')}```</code>\n        </div>\n\n        <AvatarItem className=\"my-avatar\"\n                    image={profile.avatar}\n                    placeholder={profile.placeholder}\n                    title={profile.name}/>\n\n        <textarea className=\"compose__message\"\n                  onChange={this.onMessageChange}\n                  onKeyDown={this.onKeyDown}\n                  value={text}\n                  ref=\"area\"/>\n\n        <DropZone onDropComplete={this.handleDrop}>{this.getIntlMessage('compose.dropzone')}</DropZone>\n\n        <footer className=\"compose__footer row\">\n          <button className=\"button attachment\" onClick={this.handleAttachmentClick}>\n            <i className=\"material-icons\">attachment</i> {this.getIntlMessage('compose.attach')}\n          </button>\n          <span className=\"col-xs\"/>\n          <button className=\"button button--lightblue\" onClick={this.sendTextMessage}>\n            {this.getIntlMessage('compose.send')}\n          </button>\n        </footer>\n\n        <form className=\"compose__hidden\" ref=\"attachmentForm\">\n          <input ref=\"attachment\" onChange={this.handleComposeAttachmentChange} type=\"file\"/>\n        </form>\n\n        {/* Attachment modal */}\n        {isSendAttachmentOpen ? <SendAttachment/> : null}\n\n      </section>\n    );\n  }\n}\n\nReactMixin.onClass(ComposeSection, IntlMixin);\nReactMixin.onClass(ComposeSection, PureRenderMixin);\n\nexport default ComposeSection;\n"]}