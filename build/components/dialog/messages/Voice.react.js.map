{"version":3,"sources":["../../../../src/components/dialog/messages/Voice.react.js"],"names":[],"mappings":"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","file":"Voice.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport classnames from 'classnames';\n\nlet cache = [];\n\n/**\n * Class that represents a component for display voice message content\n */\nclass Voice extends Component {\n  static propTypes = {\n    content: PropTypes.object.isRequired,\n    className: PropTypes.string\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoaded: this.isCached(),\n      isPlaying: false,\n      currentTime: 0,\n      duration: props.content.duration / 1000\n    };\n  }\n\n  componentDidMount() {\n    const { content } = this.props;\n\n    if (content.fileUrl) {\n      this.createAudioElement(content.fileUrl);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { content } = this.props;\n\n    if (content.fileUrl && !this.isCached()) {\n      this.createAudioElement(content.fileUrl);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.audio) {\n      this.audio.removeEventListener('loadeddata', this.handleLoading);\n      this.audio.removeEventListener('timeupdate', this.handleTimeUpdate);\n      this.audio.removeEventListener('ended', this.handlePlayEnding);\n      this.audio.removeEventListener('canplaythrough', this.handleLoading);\n    }\n  }\n\n  createAudioElement(fileUrl) {\n    this.audio = new Audio(fileUrl);\n    this.audio.volume = 1;\n    this.audio.addEventListener('loadeddata', this.handleLoading);\n    this.audio.addEventListener('timeupdate', this.handleTimeUpdate);\n    this.audio.addEventListener('ended', this.handlePlayEnding);\n    this.audio.addEventListener('canplaythrough', this.handleLoading);\n    this.setCached();\n  }\n\n  isCached() {\n    const { content } = this.props;\n    return cache[content.fileUrl] === true;\n  }\n\n  setCached() {\n    const { content } = this.props;\n    cache[content.fileUrl] = true;\n    this.setState({isLoaded: cache[content.fileUrl]});\n  }\n\n  humanTime = (millis) => {\n    const minutes = Math.floor(millis / 60000);\n    const seconds = ((millis % 60000) / 1000).toFixed(0);\n\n    return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\n  };\n\n  handleTimeUpdate = (event) => {\n    this.setState({\n      currentTime: this.audio.currentTime,\n      duration: this.audio.duration\n    })\n  };\n\n  handlePlayClick = () => {\n    this.audio.play();\n    this.setState({isPlaying: true})\n  };\n\n  handlePauseClick = () => {\n    this.audio.pause();\n    this.handlePlayEnding();\n  };\n\n  handlePlayEnding = () => {\n    this.setState({isPlaying: false});\n  };\n\n  handleRewind = (event) => {\n    const rewindRect = findDOMNode(this.refs.rewind).getBoundingClientRect();\n    const rewindPosition = (event.clientX - rewindRect.left) / rewindRect.width;\n\n    this.audio.currentTime = this.audio.duration * rewindPosition;\n  };\n\n  handleLoading = () => this.setCached();\n\n  render() {\n    const { className } = this.props;\n    const { isPlaying, currentTime, duration, isLoaded } = this.state;\n    const voiceClassName = classnames(className, 'row');\n\n    const current = this.humanTime(currentTime * 1000);\n    const total = this.humanTime(duration * 1000);\n    const progress = (currentTime / duration) * 100;\n\n    return (\n      <div className={voiceClassName}>\n        <div className=\"voice row\">\n          <div className=\"voice__controls\">\n            {\n              !isLoaded\n                ? <i className=\"material-icons\" style={{opacity: 0.3}}>play_circle_filled</i>\n                : isPlaying\n                    ? <i className=\"material-icons\" onClick={this.handlePauseClick}>pause_circle_filled</i>\n                    : <i className=\"material-icons\" onClick={this.handlePlayClick}>play_circle_filled</i>\n            }\n          </div>\n          <div className=\"voice__body col-xs\">\n            <div className=\"row\">\n              <div className=\"col-xs text-left\">\n                <time className=\"voice__time voice__time--current\">{current}</time>\n              </div>\n              <div className=\"col-xs text-right\">\n                <time className=\"voice__time voice__time--total\">{total}</time>\n              </div>\n            </div>\n            {\n              isLoaded\n                ? <div className=\"voice__rewind\" onClick={this.handleRewind} ref=\"rewind\">\n                    <div className=\"played\" style={{width: progress + '%'}}/>\n                  </div>\n                : <div className=\"voice__rewind voice__rewind--loading\"/>\n            }\n          </div>\n        </div>\n        <div className=\"col-xs\"/>\n      </div>\n    );\n  }\n}\n\nexport default Voice;\n"]}