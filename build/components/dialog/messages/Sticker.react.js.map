{"version":3,"sources":["../../../../src/components/dialog/messages/Sticker.react.js"],"names":[],"mappings":"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","file":"Sticker.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\n\nimport Image from '../../common/Image.react';\n\nlet cache = {};\n\n/**\n * Class that represents a component for display sticker message content\n */\nclass Sticker extends Component {\n  static propTypes = {\n    className: PropTypes.string,\n    fileUrl: PropTypes.string,\n    h: PropTypes.number.isRequired,\n    w: PropTypes.number.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoaded: this.isCached(),\n      ...this.calculateDementions()\n    }\n\n    this.onLoad = this.onLoad.bind(this);\n    this.isCached = this.isCached.bind(this);\n    this.setCached = this.setCached.bind(this);\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\n  }\n\n  onLoad() {\n    this.setCached();\n    if (!this.state.isLoaded) {\n      this.setState({isLoaded: true});\n    }\n  }\n\n  isCached() {\n    return cache[this.props.fileUrl] === true;\n  }\n\n  setCached() {\n    cache[this.props.fileUrl] = true;\n  }\n\n  calculateDementions() {\n    const { w, h } = this.props;\n    const MAX_WIDTH = 200;\n    const MAX_HEIGHT = 200;\n\n    let width = w;\n    let height = h;\n\n    if (width > height) {\n      if (width > MAX_WIDTH) {\n        height *= MAX_WIDTH / width;\n        width = MAX_WIDTH;\n      }\n    } else {\n      if (height > MAX_HEIGHT) {\n        width *= MAX_HEIGHT / height;\n        height = MAX_HEIGHT;\n      }\n    }\n\n    return { width, height };\n  }\n\n  renderPreloader() {\n    const { isLoaded } = this.state;\n    if (isLoaded) return null;\n\n    return (\n      <div className=\"preloader\">\n        <div/><div/><div/><div/><div/>\n      </div>\n    );\n  }\n\n  renderSticker() {\n    const { fileUrl } = this.props;\n    if (!fileUrl) return null;\n\n    const { width, height } = this.state;\n\n    return (\n      <Image\n        src={fileUrl}\n        width={width}\n        height={height}\n        onLoad={this.onLoad}\n      />\n    )\n  }\n\n  render() {\n    const { className } = this.props;\n    const { isLoaded, width, height } = this.state;\n    const stickerClassName = classnames('sticker', {\n      'sticker--loaded': isLoaded\n    });\n\n    return (\n      <div className={className}>\n        <div className={stickerClassName} style={{width, height}}>\n          {this.renderPreloader()}\n          {this.renderSticker()}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Sticker;\n"]}