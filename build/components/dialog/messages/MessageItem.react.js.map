{"version":3,"sources":["../../../../src/components/dialog/messages/MessageItem.react.js"],"names":[],"mappings":"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","file":"MessageItem.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { escape } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport ReactMixin from 'react-mixin';\nimport { IntlMixin } from 'react-intl'\nimport addons from 'react/addons';\nimport classnames from 'classnames';\nimport { escapeWithEmoji } from '../../../utils/EmojiUtils';\nimport PeerUtils from '../../../utils/PeerUtils';\n\nimport VisibilitySensor from 'react-visibility-sensor';\n\nimport DialogActionCreators from '../../../actions/DialogActionCreators';\nimport MessageActionCreators from '../../../actions/MessageActionCreators';\nimport ActivityActionCreators from '../../../actions/ActivityActionCreators';\nimport { MessageContentTypes } from '../../../constants/ActorAppConstants';\n\nimport AvatarItem from '../../common/AvatarItem.react';\nimport Text from './Text.react';\nimport Image from './Image.react';\nimport Document from './Document.react';\nimport Voice from './Voice.react';\nimport Contact from './Contact.react';\nimport Geolocation from './Geolocation.react';\nimport State from './State.react';\nimport Reactions from './Reactions.react';\n\nconst {addons: { PureRenderMixin }} = addons;\n\nclass MessageItem extends Component {\n  static propTypes = {\n    peer: PropTypes.object.isRequired,\n    message: PropTypes.object.isRequired,\n    isNewDay: PropTypes.bool,\n    isSameSender: PropTypes.bool,\n    onVisibilityChange: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isActionsShown: false\n    };\n  }\n\n  onClick = () => {\n    const { message, peer } = this.props;\n\n    if (PeerUtils.equals(peer, message.sender.peer)) {\n      ActivityActionCreators.show();\n    } else {\n      DialogActionCreators.selectDialogPeerUser(message.sender.peer.id);\n    }\n  };\n\n  onVisibilityChange = (isVisible) => {\n    const { message } = this.props;\n    this.props.onVisibilityChange(message, isVisible);\n  };\n\n  handleDelete = () => {\n    const { peer, message } = this.props;\n    MessageActionCreators.deleteMessage(peer, message.rid);\n  };\n\n  showActions = () => {\n    this.setState({isActionsShown: true});\n    document.addEventListener('click', this.hideActions, false);\n  };\n\n  hideActions = () => {\n    this.setState({isActionsShown: false});\n    document.removeEventListener('click', this.hideActions, false);\n  };\n\n  render() {\n    const { message, isSameSender, onVisibilityChange, peer } = this.props;\n\n    let header = null,\n        messageContent = null,\n        leftBlock = null;\n\n    const messageSender = escapeWithEmoji(message.sender.title);\n\n    const messageClassName = classnames('message row', {\n      'message--same-sender': isSameSender\n    });\n\n    let actionsDropdownClassName = classnames('message__actions__menu dropdown dropdown--small', {\n      'dropdown--opened': this.state.isActionsShown\n    });\n\n    if (isSameSender) {\n      leftBlock = (\n        <div className=\"message__info text-right\">\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </div>\n      );\n    } else {\n      leftBlock = (\n        <div className=\"message__info message__info--avatar\">\n          <a onClick={this.onClick}>\n            <AvatarItem image={message.sender.avatar}\n                        placeholder={message.sender.placeholder}\n                        title={message.sender.title}/>\n          </a>\n        </div>\n      );\n      header = (\n        <header className=\"message__header\">\n          <h3 className=\"message__sender\">\n            <a onClick={this.onClick} dangerouslySetInnerHTML={{__html: messageSender}}/>\n          </h3>\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </header>\n      );\n    }\n\n    switch (message.content.content) {\n      case MessageContentTypes.SERVICE:\n        messageContent = (\n          <div className=\"message__content message__content--service\"\n               dangerouslySetInnerHTML={{__html: escapeWithEmoji(message.content.text)}}/>\n        );\n        break;\n      case MessageContentTypes.TEXT:\n        messageContent = (\n          <Text content={message.content}\n                className=\"message__content message__content--text\"/>\n        );\n        break;\n      case MessageContentTypes.PHOTO:\n        messageContent = (\n          <Image content={message.content}\n                 className=\"message__content message__content--photo\"\n                 loadedClassName=\"message__content--photo--loaded\"/>\n        );\n        break;\n      case MessageContentTypes.DOCUMENT:\n        messageContent = (\n          <Document content={message.content}\n                    className=\"message__content message__content--document\"/>\n        );\n        break;\n      case MessageContentTypes.VOICE:\n        messageContent = (\n          <Voice content={message.content}\n                    className=\"message__content message__content--voice\"/>\n        );\n        break;\n      case MessageContentTypes.CONTACT:\n        messageContent = (\n          <Contact content={message.content}\n                    className=\"message__content message__content--contact\"/>\n        );\n        break;\n      case MessageContentTypes.LOCATION:\n        messageContent = (\n          <Geolocation content={message.content}\n                       className=\"message__content message__content--location\"/>\n        );\n        break;\n      default:\n    }\n\n    return (\n      <li className={messageClassName}>\n        {leftBlock}\n        <div className=\"message__body col-xs\">\n          {header}\n          {messageContent}\n          {onVisibilityChange ? <VisibilitySensor onChange={this.onVisibilityChange}/> : null}\n        </div>\n        <div className=\"message__actions\">\n          <Reactions peer={peer} message={message}/>\n\n          <div className={actionsDropdownClassName}>\n            <span className=\"dropdown__button\" onClick={this.showActions}>\n              <svg className=\"icon icon--dropdown\"\n                   dangerouslySetInnerHTML={{__html: '<use xlink:href=\"assets/images/icons.svg#cog\"/>'}}/>\n            </span>\n            <ul className=\"dropdown__menu dropdown__menu--right\">\n              <li className=\"dropdown__menu__item hide\">\n                <i className=\"icon material-icons\">star_rate</i> {this.getIntlMessage('message.pin')}\n              </li>\n              <li className=\"dropdown__menu__item hide\">\n                <i className=\"icon material-icons\">reply</i> {this.getIntlMessage('message.reply')}\n              </li>\n              <li className=\"dropdown__menu__item hide\">\n                <i className=\"icon material-icons\">forward</i> {this.getIntlMessage('message.forward')}\n              </li>\n              <li className=\"dropdown__menu__item\" onClick={this.handleDelete}>\n                <i className=\"icon material-icons\">delete</i> {this.getIntlMessage('message.delete')}\n              </li>\n            </ul>\n          </div>\n        </div>\n      </li>\n    );\n  }\n}\n\nReactMixin.onClass(MessageItem, IntlMixin);\nReactMixin.onClass(MessageItem, PureRenderMixin);\n\nexport default MessageItem;\n"]}