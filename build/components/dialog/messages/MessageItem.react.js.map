{"version":3,"sources":["../../../../src/components/dialog/messages/MessageItem.react.js"],"names":[],"mappings":"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","file":"MessageItem.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { escape } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { escapeWithEmoji } from '../../../utils/EmojiUtils';\nimport PeerUtils from '../../../utils/PeerUtils';\nimport { MessageContentTypes } from '../../../constants/ActorAppConstants';\n\nimport DialogActionCreators from '../../../actions/DialogActionCreators';\nimport ActivityActionCreators from '../../../actions/ActivityActionCreators';\nimport DropdownActionCreators from '../../../actions/DropdownActionCreators';\n\nimport DropdownStore from '../../../stores/DropdownStore';\n\nimport AvatarItem from '../../common/AvatarItem.react';\nimport State from './State.react';\nimport Reactions from './Reactions.react';\n\n// Default message content components\nimport DefaultService from './Service.react';\nimport DefaultText from './Text.react';\nimport DefaultPhoto from './Photo.react.js';\nimport DefaultDocument from './Document.react';\nimport DefaultVoice from './Voice.react';\nimport DefaultContact from './Contact.react';\nimport DefaultLocation from './Location.react.js';\nimport DefaultModern from './Modern.react.js';\nimport DefaultSticker from './Sticker.react.js';\n\nclass MessageItem extends Component {\n  static getStores = () => [DropdownStore];\n\n  static calculateState(prevState, props) {\n    return {\n      isHighlighted: props && props.message ? DropdownStore.isMessageDropdownOpen(props.message.rid) : false\n    }\n  }\n\n  static propTypes = {\n    peer: PropTypes.object.isRequired,\n    message: PropTypes.object.isRequired,\n    overlay: PropTypes.object.isRequired,\n    isShortMessage: PropTypes.bool,\n    isSelected: PropTypes.bool,\n    onSelect: PropTypes.func\n  };\n\n  static contextTypes = {\n    delegate: PropTypes.object,\n    isExperimental: PropTypes.bool\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return (this.props.message !== nextProps.message || this.props.isShortMessage != nextProps.isShortMessage);\n  }\n\n  onClick = () => {\n    const { message, peer } = this.props;\n\n    if (PeerUtils.equals(peer, message.sender.peer)) {\n      ActivityActionCreators.show();\n    } else {\n      DialogActionCreators.selectDialogPeerUser(message.sender.peer.id);\n    }\n  };\n\n  showActions = (event) => {\n    const { message } = this.props;\n    DropdownActionCreators.openMessageActions(event.target.getBoundingClientRect(), message);\n  };\n\n  toggleMessageSelection = () => {\n    const { message, onSelect } = this.props;\n    onSelect && onSelect(message.rid);\n  };\n\n  render() {\n    const { message, overlay, peer, isSelected } = this.props;\n    const { isHighlighted } = this.state;\n    const { delegate, isExperimental } = this.context;\n    const isShortMessage = overlay.useShort;\n\n    let Service, Text, Modern, Photo, Document, Voice, Contact, Location, Sticker;\n    if (delegate.components.dialog && delegate.components.dialog.messages && delegate.components.dialog.messages.message !== null && typeof delegate.components.messages.message !== 'function') {\n      Service = delegate.components.dialog.messages.service || DefaultService;\n      Text = delegate.components.dialog.messages.text || DefaultText;\n      Modern = delegate.components.dialog.messages.modern || DefaultModern;\n      Photo = delegate.components.dialog.messages.photo || DefaultPhoto;\n      Document = delegate.components.dialog.messages.document || DefaultDocument;\n      Voice = delegate.components.dialog.messages.voice || DefaultVoice;\n      Contact = delegate.components.dialog.messages.contact || DefaultContact;\n      Location = delegate.components.dialog.messages.location || DefaultLocation;\n      Sticker = delegate.components.dialog.messages.sticker || DefaultSticker;\n    } else {\n      Service = DefaultService;\n      Text = DefaultText;\n      Modern = DefaultModern;\n      Photo = DefaultPhoto;\n      Document = DefaultDocument;\n      Voice = DefaultVoice;\n      Contact = DefaultContact;\n      Location = DefaultLocation;\n      Sticker = DefaultSticker;\n    }\n\n    let header = null,\n        messageContent = null,\n        leftBlock = null;\n\n    const messageSender = escapeWithEmoji(message.sender.title);\n\n    const messageClassName = classnames('message row', {\n      'message--same-sender': isShortMessage,\n      'message--active': isHighlighted,\n      'message--selected': isSelected\n    });\n    const messageActionsMenuClassName = classnames('message__actions__menu', {\n      'message__actions__menu--opened': isHighlighted\n    });\n\n    if (isShortMessage) {\n      leftBlock = (\n        <div className=\"message__info text-right\">\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </div>\n      );\n    } else {\n      leftBlock = (\n        <div className=\"message__info message__info--avatar\">\n          <a onClick={this.onClick}>\n            <AvatarItem image={message.sender.avatar}\n                        placeholder={message.sender.placeholder}\n                        title={message.sender.title}/>\n          </a>\n        </div>\n      );\n      header = (\n        <header className=\"message__header\">\n          <h3 className=\"message__sender\">\n            <a onClick={this.onClick}>\n              {\n                message.sender.title\n                  ? <span className=\"message__sender__name\" dangerouslySetInnerHTML={{__html: messageSender}}/>\n                  : null\n              }\n              {\n                message.sender.userName\n                  ? <span className=\"message__sender__nick\">@{message.sender.userName}</span>\n                  : null\n              }\n            </a>\n          </h3>\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State message={message}/>\n        </header>\n      );\n    }\n\n    switch (message.content.content) {\n      case MessageContentTypes.SERVICE:\n        messageContent = <Service {...message.content} className=\"message__content message__content--service\"/>;\n        break;\n      case MessageContentTypes.TEXT:\n        messageContent = <Text {...message.content} className=\"message__content message__content--text\"/>;\n        break;\n      case MessageContentTypes.PHOTO:\n        messageContent = (<Photo content={message.content} className=\"message__content message__content--photo\"\n                                loadedClassName=\"message__content--photo--loaded\"/>);\n        break;\n      case MessageContentTypes.DOCUMENT:\n        messageContent = <Document content={message.content} className=\"message__content message__content--document\"/>;\n        break;\n      case MessageContentTypes.VOICE:\n        messageContent = <Voice content={message.content} className=\"message__content message__content--voice\"/>;\n        break;\n      case MessageContentTypes.CONTACT:\n        messageContent = <Contact {...message.content} className=\"message__content message__content--contact\"/>;\n        break;\n      case MessageContentTypes.LOCATION:\n        messageContent = <Location content={message.content} className=\"message__content message__content--location\"/>;\n        break;\n      case MessageContentTypes.TEXT_MODERN:\n        messageContent = <Modern {...message.content} className=\"message__content message__content--modern\"/>;\n        break;\n      case MessageContentTypes.STICKER:\n        messageContent = <Sticker {...message.content} className=\"message__content message__content--sticker\"/>;\n        break;\n      default:\n    }\n\n    return (\n      <li className={messageClassName}>\n        {leftBlock}\n        <div className=\"message__body col-xs\">\n          {header}\n          {messageContent}\n        </div>\n        <div className=\"message__actions\">\n          <Reactions peer={peer} message={message}/>\n\n          <div className={messageActionsMenuClassName} onClick={this.showActions}>\n            <svg className=\"icon icon--dropdown\"\n                 dangerouslySetInnerHTML={{__html: '<use xlink:href=\"assets/images/icons.svg#cog\"/>'}}/>\n          </div>\n\n          {\n            isExperimental\n              ? <div className=\"message__actions__selector\" onClick={this.toggleMessageSelection}>\n                  <i className=\"icon material-icons\">check</i>\n                </div>\n              : null\n          }\n\n        </div>\n      </li>\n    );\n  }\n}\n\nexport default Container.create(MessageItem, {withProps: true});\n"]}