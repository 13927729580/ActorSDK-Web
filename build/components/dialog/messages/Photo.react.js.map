{"version":3,"sources":["../../../../src/components/dialog/messages/Photo.react.js"],"names":[],"mappings":"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","file":"Photo.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\n\nimport { lightbox } from '../../../utils/ImageUtils';\n\nlet cache = [];\n\n/**\n * Class that represents a component for display photo message content\n * @todo move cache to store;\n */\nclass Photo extends Component {\n  static propTypes = {\n    fileUrl: PropTypes.string,\n    w: PropTypes.number.isRequired,\n    h: PropTypes.number.isRequired,\n    preview: PropTypes.string.isRequired,\n    isUploading: PropTypes.bool.isRequired,\n    className: PropTypes.string,\n    loadedClassName: PropTypes.string\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isImageLoaded: this.isCached()\n    };\n\n    this.openLightBox = this.openLightBox.bind(this);\n    this.onLoad = this.onLoad.bind(this);\n    this.isCached = this.isCached.bind(this);\n    this.setCached = this.setCached.bind(this);\n    this.getDimentions = this.getDimentions.bind(this);\n  }\n\n  openLightBox() {\n    lightbox.open(this.props.fileUrl, 'message');\n  }\n\n  onLoad() {\n    this.setCached();\n    if (!this.state.isImageLoaded) {\n      this.setState({ isImageLoaded: true });\n    }\n  }\n\n  isCached() {\n    cache[this.props.fileUrl] === true;\n  }\n\n  setCached() {\n    cache[this.props.fileUrl] = true;\n  }\n\n  getDimentions() {\n    const { w, h } = this.props;\n    const MAX_WIDTH = 300;\n    const MAX_HEIGHT = 400;\n    let width = w;\n    let height = h;\n\n    if (width > height) {\n      if (width > MAX_WIDTH) {\n        height *= MAX_WIDTH / width;\n        width = MAX_WIDTH;\n      }\n    } else {\n      if (height > MAX_HEIGHT) {\n        width *= MAX_HEIGHT / height;\n        height = MAX_HEIGHT;\n      }\n    }\n\n    return { width, height };\n  }\n\n  renderPreview() {\n    const { preview } = this.props;\n\n    if (this.isCached()) {\n      return null;\n    }\n\n    return (\n      <img className=\"photo photo--preview\" src={preview}/>\n    )\n  }\n\n  renderPreloader() {\n    const { isUploading } = this.props;\n    const { isImageLoaded } = this.state;\n\n    if (this.isCached() || isUploading !== true || isImageLoaded !== false) {\n      return null;\n    }\n\n    return (\n      <div className=\"preloader\"><div/><div/><div/><div/><div/></div>\n    );\n  }\n\n  renderOriginal() {\n    const { fileUrl, w, h } = this.props;\n\n    if (!fileUrl) {\n      return null;\n    }\n\n    return (\n      <img\n        className=\"photo photo--original\"\n        height={h}\n        onClick={this.openLightBox}\n        onLoad={this.onLoad}\n        src={fileUrl}\n        width={w}\n      />\n    );\n  }\n\n  render() {\n    const { className, loadedClassName } = this.props;\n    const { isImageLoaded } = this.state;\n\n    const imageClassName = isImageLoaded ? classnames(className, loadedClassName) : className;\n\n    return (\n      <div className={imageClassName} style={this.getDimentions()}>\n        {this.renderPreview()}\n        {this.renderOriginal()}\n        {this.renderPreloader()}\n        <svg dangerouslySetInnerHTML={{ __html: '<filter id=\"blur-effect\"><feGaussianBlur stdDeviation=\"3\"/></filter>' }}/>\n      </div>\n    );\n  }\n}\n\nexport default Photo;\n"]}