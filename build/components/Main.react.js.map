{"version":3,"sources":["../../src/components/Main.react.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAuBM,IAAI;YAAJ,IAAI;;AASR,WATI,IAAI,CASI,KAAK,EAAE;0BATf,IAAI;;uEAAJ,IAAI,aAUA,KAAK;;UAmCb,kBAAkB,GAAG,YAAM;AACzB,UAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;AACpB,2CAAyB,gBAAgB,EAAE,CAAC;OAC7C,MAAM;AACL,2CAAyB,eAAe,EAAE,CAAC;OAC5C;KACF;;UAED,SAAS,GAAG,UAAC,KAAK,EAAK;AACrB,UAAI,KAAK,CAAC,OAAO,KAAK,mBAvEN,QAAQ,CAuEO,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE;AACjD,4CAA0B,IAAI,EAAE,CAAC;OAClC;KACF;;QA7CS,MAAM,GAAK,KAAK,CAAhB,MAAM;;AACd,QAAM,IAAI,GAAG,oBAAU,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;;AAE/C,oBA1BK,iBAAiB,GA0BH,CAAC;;AAEpB,YAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,MAAK,kBAAkB,CAAC,CAAC;AACvE,YAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAK,SAAS,EAAE,KAAK,CAAC;;;AAAC,AAG5D,oBAhCK,iBAAiB,GAgCH,CAAC;;AAEpB,QAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;AACpB,yCAAyB,gBAAgB,EAAE,CAAC;KAC7C;;AAED,QAAI,IAAI,EAAE;;AAER,UAAI,QAAQ,GAAG,SAAS,CAAC;;AAEzB,UAAI,IAAI,CAAC,IAAI,IAAI,mBAhDd,SAAS,CAgDe,KAAK,EAAE;AAChC,gBAAQ,GAAG,sBAAY,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;OACzC,MAAM;AACL,gBAAQ,GAAG,sBAAY,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;OACxC;;AAED,UAAI,QAAQ,EAAE;AACZ,uCAAqB,gBAAgB,CAAC,IAAI,CAAC,CAAC;OAC7C,MAAM;AACL,kCAAgB,GAAG,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;OACzC;KACF;;GACF;;eA3CG,IAAI;;6BA2DC;UACC,MAAM,GAAK,IAAI,CAAC,KAAK,CAArB,MAAM;;AACd,UAAM,IAAI,GAAG,oBAAU,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;;AAE/C,aACE;;UAAK,SAAS,EAAC,KAAK;QAClB,sDAAU;QACV,0DAAgB,YAAY,EAAE,IAAI,AAAC,GAAE;QACrC,yDAAe,IAAI,EAAE,IAAI,AAAC,GAAE;QAE5B,4DAAgB;OACZ,CACN;KACH;;;SAxEG,IAAI;UAnBM,SAAS;;AAmBnB,IAAI,CACD,YAAY,GAAG;AACpB,QAAM,EAAE,OArBe,SAAS,CAqBd,IAAI;CACvB;AAHG,IAAI,CAKD,SAAS,GAAG;AACjB,QAAM,EAAE,OAzBe,SAAS,CAyBd,MAAM;CACzB;kBAoEY,2BAAY,IAAI,CAAC","file":"Main.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\n\nimport { PeerTypes, KeyCodes } from '../constants/ActorAppConstants';\n\nimport requireAuth from '../utils/require-auth';\nimport ActorClient from '../utils/ActorClient';\nimport PeerUtils from '../utils/PeerUtils';\nimport RouterContainer from '../utils/RouterContainer';\nimport { preloadEmojiSheet } from '../utils/EmojiUtils'\n\nimport DialogActionCreators from '../actions/DialogActionCreators';\nimport VisibilityActionCreators from '../actions/VisibilityActionCreators';\nimport QuickSearchActionCreators from '../actions/QuickSearchActionCreators';\n\nimport SidebarSection from './SidebarSection.react';\nimport DialogSection from './DialogSection.react';\nimport Favicon from './common/Favicon.react';\nimport ModalsWrapper from './modals/ModalsWrapper.react';\n\nclass Main extends Component {\n  static contextTypes = {\n    router: PropTypes.func\n  };\n\n  static propTypes = {\n    params: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { params } = props;\n    const peer = PeerUtils.stringToPeer(params.id);\n\n    preloadEmojiSheet();\n\n    document.addEventListener('visibilitychange', this.onVisibilityChange);\n    document.addEventListener('keydown', this.onKeyDown, false);\n\n    // Preload emoji spritesheet\n    preloadEmojiSheet();\n\n    if (!document.hidden) {\n      VisibilityActionCreators.createAppVisible();\n    }\n\n    if (peer) {\n      // It is needed to prevent failure on opening dialog while library didn't load dialogs (right after auth)\n      let peerInfo = undefined;\n\n      if (peer.type == PeerTypes.GROUP) {\n        peerInfo = ActorClient.getGroup(peer.id)\n      } else {\n        peerInfo = ActorClient.getUser(peer.id)\n      }\n\n      if (peerInfo) {\n        DialogActionCreators.selectDialogPeer(peer);\n      } else {\n        RouterContainer.get().transitionTo('/');\n      }\n    }\n  }\n\n  onVisibilityChange = () => {\n    if (!document.hidden) {\n      VisibilityActionCreators.createAppVisible();\n    } else {\n      VisibilityActionCreators.createAppHidden();\n    }\n  };\n\n  onKeyDown = (event) => {\n    if (event.keyCode === KeyCodes.K && event.metaKey) {\n      QuickSearchActionCreators.show();\n    }\n  };\n\n  render() {\n    const { params } = this.props;\n    const peer = PeerUtils.stringToPeer(params.id);\n\n    return (\n      <div className=\"app\">\n        <Favicon/>\n        <SidebarSection selectedPeer={peer}/>\n        <DialogSection peer={peer}/>\n\n        <ModalsWrapper/>\n      </div>\n    );\n  }\n}\n\nexport default requireAuth(Main);\n"]}