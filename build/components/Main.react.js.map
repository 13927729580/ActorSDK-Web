{"version":3,"sources":["../../src/components/Main.react.js"],"names":[],"mappings":"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","file":"Main.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { PeerTypes, KeyCodes } from '../constants/ActorAppConstants';\n\nimport PeerUtils from '../utils/PeerUtils';\nimport history from '../utils/history';\nimport { preloadEmojiSheet } from '../utils/EmojiUtils'\n\nimport DialogActionCreators from '../actions/DialogActionCreators';\nimport VisibilityActionCreators from '../actions/VisibilityActionCreators';\nimport QuickSearchActionCreators from '../actions/QuickSearchActionCreators';\n\nimport UserStore from '../stores/UserStore';\nimport GroupStore from '../stores/GroupStore';\n\nimport DefaultSidebar from './Sidebar.react';\nimport DefaultDialog from './Dialog.react';\nimport Favicon from './common/Favicon.react';\n\nimport ModalsWrapper from './modals/ModalsWrapper.react';\nimport CallModal from './modals/CallModal.react';\nimport DropdownWrapper from './common/DropdownWrapper.react';\n\nclass Main extends Component {\n  static propTypes = {\n    params: PropTypes.object,\n    delegate: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n\n    document.addEventListener('visibilitychange', this.onVisibilityChange);\n    document.addEventListener('keydown', this.onKeyDown, false);\n\n    // Preload emoji spritesheet\n    preloadEmojiSheet();\n\n    if (!document.hidden) {\n      VisibilityActionCreators.createAppVisible();\n    }\n  }\n\n  componentDidMount() {\n    const { params } = this.props;\n    const peer = PeerUtils.stringToPeer(params.id);\n\n    if (peer) {\n      // It is needed to prevent failure on opening dialog while library didn't load dialogs (right after auth)\n      let peerInfo = undefined;\n\n      if (peer.type == PeerTypes.GROUP) {\n        peerInfo = GroupStore.getGroup(peer.id)\n      } else {\n        peerInfo = UserStore.getUser(peer.id)\n      }\n\n      if (peerInfo) {\n        DialogActionCreators.selectDialogPeer(peer);\n      } else {\n        history.replace('/');\n      }\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { params } = nextProps;\n    if (this.props.params.id !== params.id) {\n      const peer = PeerUtils.stringToPeer(params.id);\n      if (peer) {\n        DialogActionCreators.selectDialogPeer(peer);\n      } else {\n        history.push('/');\n      }\n    }\n  }\n\n  onVisibilityChange = () => {\n    if (!document.hidden) {\n      VisibilityActionCreators.createAppVisible();\n    } else {\n      VisibilityActionCreators.createAppHidden();\n    }\n  };\n\n  onKeyDown = (event) => {\n    // TODO: Make this hotkey work on windows\n    if (event.keyCode === KeyCodes.K && event.metaKey) {\n      event.stopPropagation();\n      event.preventDefault();\n      QuickSearchActionCreators.show();\n    }\n  };\n\n  render() {\n    const { delegate, params } = this.props;\n    const peer = PeerUtils.stringToPeer(params.id);\n\n    const Sidebar = (typeof delegate.components.sidebar == 'function') ? delegate.components.sidebar : DefaultSidebar;\n    const Dialog = (typeof delegate.components.dialog == 'function') ? delegate.components.dialog : DefaultDialog;\n\n    return (\n      <div className=\"app\">\n        <Favicon/>\n\n        <Sidebar/>\n        <Dialog peer={peer}/>\n\n        <ModalsWrapper/>\n        <DropdownWrapper/>\n        <CallModal/>\n      </div>\n    );\n  }\n}\n\nexport default Main;\n"]}