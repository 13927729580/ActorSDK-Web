{"version":3,"sources":["../../../src/components/search/ToolbarSearch.react.js"],"names":[],"mappings":"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","file":"ToolbarSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport history from '../../utils/history';\n\nimport SearchStore from '../../stores/SearchStore';\n\nimport SearchActionCreators from '../../actions/SearchActionCreators';\nimport ComposeActionCreators from '../../actions/ComposeActionCreators';\nimport SearchMessagesActionCreators from '../../actions/SearchMessagesActionCreators';\n\nimport SearchInput from './SearchInput.react';\nimport ContactItem from '../common/ContactItem.react';\n\nclass ToolbarSearch extends Component {\n  static propTypes = {\n    className: PropTypes.string\n  }\n\n  static getStores() {\n    return [SearchStore];\n  }\n\n  static calculateState(prevState) {\n    const searchState = SearchStore.getState();\n\n    return {\n      ...prevState,\n      ...searchState,\n      isSearchExpanded: prevState ? prevState.isSearchExpanded : false,\n      isSearchFocused: prevState ? prevState.isSearchFocused : false,\n      isResultsDropdownOpen: prevState ? prevState.isResultsDropdownOpen : false\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.handleSearchChange = this.handleSearchChange.bind(this);\n    this.handlerSearchClear = this.handlerSearchClear.bind(this);\n    this.handleToolbarSearchClick = this.handleToolbarSearchClick.bind(this);\n    this.handleSearchToggleFocus = this.handleSearchToggleFocus.bind(this);\n    this.handleMessagesSearch = this.handleMessagesSearch.bind(this);\n    this.handleResultClick = this.handleResultClick.bind(this);\n  }\n\n  handleSearchChange(query) {\n    SearchActionCreators.handleSearch(query);\n  }\n\n  handlerSearchClear() {\n    SearchActionCreators.clearSearch();\n  }\n\n  handleSearchToggleFocus(isFocused) {\n    ComposeActionCreators.toggleAutoFocus(!isFocused);\n    this.setState({ isSearchFocused: isFocused });\n\n    if (isFocused) {\n      this.setState({ isResultsDropdownOpen: true })\n    }\n  }\n\n  handleToolbarSearchClick() {\n    this.setState({ isSearchExpanded: true });\n  }\n\n  handleMessagesSearch() {\n    const { query } = this.state;\n    SearchMessagesActionCreators.open();\n    SearchMessagesActionCreators.setQuery(query);\n    this.handlerSearchClear();\n    this.setState({ isResultsDropdownOpen: false })\n  }\n\n  handleResultClick(peer) {\n    this.setState({ isResultsDropdownOpen: false });\n    this.handlerSearchClear();\n    history.push(`/im/${peer.key}`);\n  }\n\n  renderSearchInput() {\n    const { query } = this.state;\n\n    return (\n      <SearchInput\n        className=\"toolbar__search__input col-xs\"\n        value={query}\n        onClear={this.handlerSearchClear}\n        onChange={this.handleSearchChange}\n        onToggleFocus={this.handleSearchToggleFocus}\n      />\n    );\n  }\n\n  renderSearchGroupResults() {\n    const { results: { groups } } = this.state;\n\n    if (!groups.length) {\n      return null;\n    }\n\n    const groupResults = groups.map((group, index) => {\n      return (\n        <ContactItem\n          key={`g.${index}`}\n          onClick={() => this.handleResultClick(group.peerInfo.peer)}\n          uid={group.peerInfo.peer.id}\n          name={group.peerInfo.title}\n          placeholder={group.peerInfo.placeholder}\n          avatar={group.peerInfo.avatar}\n        />\n      );\n    });\n\n    return (\n      <div>\n        <header>Groups</header>\n        {groupResults}\n      </div>\n    );\n  }\n\n  renderSearchContactResults() {\n    const { results: { contacts } } = this.state;\n\n    if (!contacts.length) {\n      return null;\n    }\n\n    const contactsResults = contacts.map((contact, index) => {\n      return (\n        <ContactItem\n          key={`c.${index}`}\n          onClick={() => this.handleResultClick(contact.peerInfo.peer)}\n          uid={contact.peerInfo.peer.id}\n          name={contact.peerInfo.title}\n          placeholder={contact.peerInfo.placeholder}\n          avatar={contact.peerInfo.avatar}\n        />\n      );\n    });\n\n    return (\n      <div>\n        <header>Contacts</header>\n        {contactsResults}\n      </div>\n    );\n  }\n\n  renderSearchResultsDropdown() {\n    const { query, isResultsDropdownOpen } = this.state;\n\n    if (!query || !isResultsDropdownOpen) {\n      return null;\n    }\n\n    return (\n      <div className=\"toolbar__search__dropdown\">\n        <div className=\"toolbar__search__results\">\n          {this.renderSearchContactResults()}\n          {this.renderSearchGroupResults()}\n        </div>\n        <footer>\n          <a onClick={this.handleMessagesSearch}>\n            Search messages in current dialog <i className=\"material-icons\">arrow_forward</i>\n          </a>\n        </footer>\n      </div>\n    );\n  }\n\n  render() {\n    const { className } = this.props;\n    const { isSearchExpanded, isSearchFocused } = this.state;\n\n    const toolbarSearchClassName = classnames('toolbar__search', className, {\n      'toolbar__search--expanded': isSearchExpanded,\n      'toolbar__search--focused': isSearchFocused\n    });\n\n    return (\n      <div className={toolbarSearchClassName} onClick={this.handleToolbarSearchClick}>\n        <div className=\"row\">\n          <i className=\"search-icon material-icons\">search</i>\n          {this.renderSearchInput()}\n        </div>\n        {this.renderSearchResultsDropdown()}\n      </div>\n    );\n  }\n}\n\nexport default Container.create(ToolbarSearch);\n"]}