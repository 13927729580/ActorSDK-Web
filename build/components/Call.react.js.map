{"version":3,"sources":["../../src/components/Call.react.js"],"names":[],"mappings":"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","file":"Call.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component } from 'react';\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\nimport { Container } from 'flux/utils';\n\nimport { PeerTypes } from '../constants/ActorAppConstants';\nimport PeerUtils from '../utils/PeerUtils';\n\nimport CallActionCreators from '../actions/CallActionCreators';\n\nimport CallStore from '../stores/CallStore';\nimport DialogStore from '../stores/DialogStore';\nimport UserStore from '../stores/UserStore';\nimport GroupStore from '../stores/GroupStore';\n\nimport CallBody from './call/CallBody.react';\nimport CallControls from './call/CallControls.react';\nimport ContactDetails from './common/ContactDetails.react';\n\nclass Call extends Component {\n  static getStores() {\n    return [CallStore, DialogStore];\n  }\n\n  static calculatePeerInfo(peer) {\n    if (peer) {\n      if (peer.type === PeerTypes.USER) {\n        return UserStore.getUser(peer.id);\n      }\n\n      if (peer.type === PeerTypes.GROUP) {\n        return GroupStore.getGroup(peer.id);\n      }\n    }\n\n    return null;\n  }\n\n  static calculateState() {\n    const call = CallStore.getState();\n    if (!call.isOpen || call.isFloating) {\n      return { isOpen: false };\n    }\n\n    const dialogPeer = DialogStore.getCurrentPeer();\n    const isSameDialog = PeerUtils.equals(dialogPeer, call.peer);\n    if (!isSameDialog) {\n      return { isOpen: false };\n    }\n\n    return {\n      call,\n      isOpen: true,\n      peerInfo: Call.calculatePeerInfo(call.peer)\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.onAnswer = this.onAnswer.bind(this);\n    this.onEnd = this.onEnd.bind(this);\n    this.onMuteToggle = this.onMuteToggle.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.onFullscreen = this.onFullscreen.bind(this);\n    this.onUserAdd = this.onUserAdd.bind(this);\n    this.onVideo = this.onVideo.bind(this);\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\n  }\n\n  onAnswer() {\n    CallActionCreators.answerCall(this.state.call.id);\n  }\n\n  onEnd() {\n    CallActionCreators.endCall(this.state.call.id);\n  }\n\n  onMuteToggle() {\n    CallActionCreators.toggleCallMute(this.state.call.id);\n  }\n\n  onClose() {\n    CallActionCreators.hide();\n  }\n\n  onFullscreen() {\n    console.debug('onFullscreen');\n  }\n\n  onUserAdd() {\n    console.debug('onUserAdd');\n  }\n\n  onVideo() {\n    console.debug('onVideo');\n  }\n\n  renderContactInfo() {\n    const { call, peerInfo } = this.state;\n    if (!peerInfo || call.peer.type === PeerTypes.GROUP) return null;\n\n    return (\n      <section className=\"call__info\">\n        <ContactDetails peerInfo={peerInfo}/>\n      </section>\n    )\n  }\n\n  render() {\n    const {isOpen, call, peerInfo} = this.state;\n    if (!isOpen) {\n      return <section className=\"activity\" />;\n    }\n\n    return (\n      <section className=\"activity activity--shown\">\n        <div className=\"activity__body call\">\n          <section className=\"call__container\">\n            <CallBody peerInfo={peerInfo} callState={call.state}/>\n            <CallControls\n              callState={call.state}\n              isOutgoing={call.isOutgoing}\n              isMuted={call.isMuted}\n              onEnd={this.onEnd}\n              onAnswer={this.onAnswer}\n              onMuteToggle={this.onMuteToggle}\n              onFullscreen={this.onFullscreen}\n              onUserAdd={this.onUserAdd}\n              onVideo={this.onVideo}\n              onClose={this.onClose}\n            />\n          </section>\n          {this.renderContactInfo()}\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Call);\n"]}