{"version":3,"sources":["../../../src/components/common/MentionDropdown.react.js"],"names":[],"mappings":"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","file":"MentionDropdown.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\nimport React, { PropTypes, Component } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport classnames from 'classnames';\nimport ReactMixin from 'react-mixin';\nimport PureRenderMixin from 'react-addons-pure-render-mixin';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport AvatarItem from './AvatarItem.react';\n\nconst DROPDOWN_ITEM_HEIGHT = 38;\nlet scrollIndex = 0;\n\nclass MentionDropdown extends Component {\n  static propTypes = {\n    mentions: PropTypes.array,\n    className: PropTypes.string,\n    onSelect: PropTypes.func.isRequired,\n    onClose: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n    const { mentions } = props;\n\n    this.state = {\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    };\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.isOpen && !this.state.isOpen) {\n      this.setListeners();\n    } else if (!nextState.isOpen && this.state.isOpen) {\n      this.cleanListeners();\n    }\n  }\n\n  componentWillReceiveProps(props) {\n    const { mentions } = props;\n    this.setState({\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    });\n  }\n\n  setListeners() {\n    document.addEventListener('keydown', this.onKeyDown, false);\n    document.addEventListener('click', this.closeMentions, false);\n  }\n\n  cleanListeners() {\n    document.removeEventListener('keydown', this.onKeyDown, false);\n    document.removeEventListener('click', this.closeMentions, false);\n  }\n\n  closeMentions = () => this.setState({isOpen: false});\n\n  onSelect = (value) => this.props.onSelect(value);\n\n  handleScroll = (top) => {\n    const menuListNode = findDOMNode(this.refs.mentionList);\n    menuListNode.scrollTop = top;\n  };\n\n  onKeyDown = (event) => {\n    const { mentions, onClose } = this.props;\n    const { selectedIndex } = this.state;\n    const visibleItems = 6;\n    let index = selectedIndex;\n\n    if (index !== null) {\n      switch (event.keyCode) {\n        case KeyCodes.ENTER:\n          event.stopPropagation();\n          event.preventDefault();\n          this.onSelect(mentions[selectedIndex]);\n          break;\n\n        case KeyCodes.ARROW_UP:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index > 0) {\n            index -= 1;\n          } else if (index === 0) {\n            index = mentions.length - 1;\n          }\n\n          if (scrollIndex > index) {\n            scrollIndex = index;\n          } else if (index === mentions.length - 1) {\n            scrollIndex = mentions.length - visibleItems;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({selectedIndex: index});\n          break;\n        case KeyCodes.ARROW_DOWN:\n        case KeyCodes.TAB:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index < mentions.length - 1) {\n            index += 1;\n          } else if (index === mentions.length - 1) {\n            index = 0;\n          }\n\n          if (index + 1 > scrollIndex + visibleItems) {\n            scrollIndex = index + 1 - visibleItems;\n          } else if (index === 0) {\n            scrollIndex = 0;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({selectedIndex: index});\n          break;\n        default:\n      }\n    }\n\n    if (event.keyCode === KeyCodes.ESC) {\n      this.closeMentions();\n      if (onClose) onClose();\n    }\n  };\n\n  render() {\n    const { className, mentions } = this.props;\n    const { isOpen, selectedIndex } = this.state;\n\n    const mentionClassName = classnames('mention', {\n      'mention--opened': isOpen\n    }, className);\n    const mentionsElements = map(mentions, (mention, index) => {\n      const itemClassName = classnames('mention__list__item', {\n        'mention__list__item--active': selectedIndex === index\n      });\n\n      const title = mention.isNick ? [\n        <span className=\"nickname\">{mention.mentionText}</span>,\n        <span className=\"name\">{mention.secondText}</span>\n      ] : (\n        <span className=\"name\">{mention.mentionText}</span>\n      );\n\n      return (\n        <li className={itemClassName}\n            key={index}\n            onClick={() => this.onSelect(mention)}\n            onMouseOver={() => this.setState({selectedIndex: index})}>\n          <AvatarItem image={mention.peer.avatar}\n                      placeholder={mention.peer.placeholder}\n                      size=\"tiny\"\n                      title={mention.peer.title}/>\n          <div className=\"title\">{title}</div>\n        </li>\n      );\n    });\n\n    if (isOpen) {\n      return (\n        <div className={mentionClassName}>\n          <div className=\"mention__wrapper\">\n            <header className=\"mention__header\">\n              <div className=\"pull-left\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; to navigate</div>\n              <div className=\"pull-left\"><strong>↵</strong>&nbsp; to select</div>\n              <div className=\"pull-right\"><strong>esc</strong>&nbsp; to close</div>\n            </header>\n            <ul className=\"mention__list\" ref=\"mentionList\">\n              {mentionsElements}\n            </ul>\n          </div>\n        </div>\n      );\n    } else {\n      return null;\n    }\n  }\n}\n\nReactMixin.onClass(MentionDropdown, PureRenderMixin);\n\nexport default MentionDropdown;\n"]}