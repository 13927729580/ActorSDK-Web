{"version":3,"sources":["../../../src/components/common/MentionDropdown.react.js"],"names":[],"mappings":"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","file":"MentionDropdown.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\nimport React, { PropTypes, Component } from 'react';\nimport EventListener from 'fbjs/lib/EventListener';\nimport { findDOMNode } from 'react-dom';\nimport classnames from 'classnames';\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport AvatarItem from './AvatarItem.react';\n\nconst DROPDOWN_ITEM_HEIGHT = 38;\nlet scrollIndex = 0;\n\nclass MentionDropdown extends Component {\n  static propTypes = {\n    mentions: PropTypes.array,\n    className: PropTypes.string,\n    onSelect: PropTypes.func.isRequired,\n    onClose: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n    const { mentions } = props;\n\n    this.state = {\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    };\n\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.isOpen && !this.state.isOpen) {\n      this.setListeners();\n    } else if (!nextState.isOpen && this.state.isOpen) {\n      this.cleanListeners();\n    }\n  }\n\n  componentWillReceiveProps(props) {\n    const { mentions } = props;\n    this.setState({\n      isOpen: mentions && mentions.length > 0,\n      selectedIndex: 0\n    });\n  }\n\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      EventListener.listen(document, 'keydown', this.onKeyDown),\n      EventListener.listen(document, 'click', this.closeMentions)\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => {\n        listener.remove();\n      });\n\n      this.listeners = null;\n    }\n  }\n\n  closeMentions = () => this.setState({ isOpen: false });\n\n  onSelect = (value) => this.props.onSelect(value);\n\n  handleScroll = (top) => {\n    const menuListNode = findDOMNode(this.refs.mentionList);\n    menuListNode.scrollTop = top;\n  };\n\n  onKeyDown = (event) => {\n    const { mentions, onClose } = this.props;\n    const { selectedIndex } = this.state;\n    const visibleItems = 6;\n    let index = selectedIndex;\n\n    if (index !== null) {\n      switch (event.keyCode) {\n        case KeyCodes.ENTER:\n          event.stopPropagation();\n          event.preventDefault();\n          this.onSelect(mentions[selectedIndex]);\n          break;\n\n        case KeyCodes.ARROW_UP:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index > 0) {\n            index -= 1;\n          } else if (index === 0) {\n            index = mentions.length - 1;\n          }\n\n          if (scrollIndex > index) {\n            scrollIndex = index;\n          } else if (index === mentions.length - 1) {\n            scrollIndex = mentions.length - visibleItems;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({ selectedIndex: index });\n          break;\n        case KeyCodes.ARROW_DOWN:\n        case KeyCodes.TAB:\n          event.stopPropagation();\n          event.preventDefault();\n\n          if (index < mentions.length - 1) {\n            index += 1;\n          } else if (index === mentions.length - 1) {\n            index = 0;\n          }\n\n          if (index + 1 > scrollIndex + visibleItems) {\n            scrollIndex = index + 1 - visibleItems;\n          } else if (index === 0) {\n            scrollIndex = 0;\n          }\n\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\n          this.setState({ selectedIndex: index });\n          break;\n        default:\n      }\n    }\n\n    if (event.keyCode === KeyCodes.ESC) {\n      this.closeMentions();\n      if (onClose) onClose();\n    }\n  };\n\n  render() {\n    const { className, mentions } = this.props;\n    const { isOpen, selectedIndex } = this.state;\n\n    if (!isOpen) {\n      return <div className=\"mention\" />;\n    }\n\n    const mentionsElements = map(mentions, (mention, index) => {\n      const itemClassName = classnames('mention__list__item', {\n        'mention__list__item--active': selectedIndex === index\n      });\n\n      return (\n        <li className={itemClassName}\n            key={index}\n            onClick={() => this.onSelect(mention)}\n            onMouseOver={() => this.setState({ selectedIndex: index })}>\n          <AvatarItem image={mention.peer.avatar}\n                      placeholder={mention.peer.placeholder}\n                      size=\"tiny\"\n                      title={mention.peer.title}/>\n          <div className=\"title\">\n            {mention.isNick && <span className=\"nickname\">{mention.mentionText}</span>}\n            <span className=\"name\">{mention.mentionText}</span>\n          </div>\n        </li>\n      );\n    });\n\n    const mentionClassName = classnames('mention mention--opened', className);\n\n    return (\n      <div className={mentionClassName}>\n        <div className=\"mention__wrapper\">\n          <header className=\"mention__header\">\n            <div className=\"pull-left\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; to navigate</div>\n            <div className=\"pull-left\"><strong>↵</strong>&nbsp; to select</div>\n            <div className=\"pull-right\"><strong>esc</strong>&nbsp; to close</div>\n          </header>\n          <ul className=\"mention__list\" ref=\"mentionList\">\n            {mentionsElements}\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default MentionDropdown;\n"]}