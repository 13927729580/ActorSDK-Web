{"version":3,"sources":["../../src/stores/LoginStore.js"],"names":[],"mappings":"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","file":"LoginStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes, AuthSteps } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport Bugsnag from '../utils/Bugsnag';\nimport mixpanel from '../utils/Mixpanel';\n\nimport { intlData } from '../l18n';\n\nlet step = AuthSteps.LOGIN_WAIT,\n    errors = {\n      login: null,\n      code: null,\n      signup: null\n    },\n    login = '',\n    code = '',\n    name = '',\n    isCodeRequested = false,\n    isCodeSended = false,\n    isSignupStarted = false,\n    myUid = null;\n\nclass LoginStore extends Store {\n  constructor(Dispatcher) {\n    super(Dispatcher);\n  }\n\n  getStep = () => step;\n  getErrors = () => errors;\n  getLogin = () => login;\n  getCode = () => code;\n  getName = () => name;\n  isCodeRequested = () => isCodeRequested;\n  isCodeSended = () => isCodeSended;\n  isSignupStarted = () => isSignupStarted;\n  getMyId = () => myUid;\n  isLoggedIn = () => ActorClient.isLoggedIn();\n\n  resetStore = () => {\n    step = AuthSteps.LOGIN_WAIT;\n    errors = {\n      login: null,\n      code: null,\n      signup: null\n    };\n    login = code = name = '';\n    isCodeRequested = isCodeSended = isSignupStarted = false;\n    myUid = null;\n  };\n\n  __onDispatch = (action) => {\n    switch (action.type) {\n\n      case ActionTypes.AUTH_CHANGE_LOGIN:\n        login = action.login;\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CHANGE_CODE:\n        code = action.code;\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CHANGE_NAME:\n        name = action.name;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_CODE_REQUEST:\n        isCodeRequested = true;\n        mixpanel.track('Request code');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_REQUEST_SUCCESS:\n        step = AuthSteps.CODE_WAIT;\n        errors.login = null;\n        mixpanel.track('Request code success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_REQUEST_FAILURE:\n        switch (action.error) {\n          case 'PHONE_NUMBER_INVALID':\n            errors.login = intlData.messages.login.errors.numberInvalid;\n            break;\n          case 'CODE_WAIT':\n            errors.login = intlData.messages.login.errors.codeWait;\n            break;\n          default:\n            errors.login = action.error;\n        }\n        isCodeRequested = false;\n        mixpanel.track('Request code failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_CODE_SEND:\n        isCodeSended = true;\n        mixpanel.track('Send code');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_SEND_SUCCESS:\n        errors.code = null;\n        mixpanel.track('Send code success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_SEND_FAILURE:\n        switch (action.error) {\n          case 'PHONE_CODE_INVALID':\n          case 'EMAIL_CODE_INVALID':\n            errors.code = intlData.messages.login.errors.codeInvalid;\n            break;\n          case 'PHONE_CODE_EXPIRED':\n            errors.code = intlData.messages.login.errors.codeExpired;\n            break;\n          default:\n            errors.code = action.error;\n        }\n        isCodeSended = false;\n        mixpanel.track('Send code failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SIGNUP_START:\n        step = AuthSteps.NAME_WAIT;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SIGNUP:\n        isSignupStarted = true;\n        mixpanel.track('Sign up');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SIGNUP_SUCCESS:\n        errors.signup = null;\n        mixpanel.alias(ActorClient.getUid());\n        mixpanel.people.set_once({$created: new Date()});\n        mixpanel.track('Sign up success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SIGNUP_FAILURE:\n        switch (action.error) {\n          case 'NAME_INVALID':\n            errors.signup = intlData.messages.login.errors.nameInvalid;\n            break;\n          default:\n            errors.signup = action.error;\n        }\n        isSignupStarted = false;\n        mixpanel.track('Sign up failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_RESTART:\n        this.resetStore();\n        mixpanel.track('Restart authorization');\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SET_LOGGED_IN:\n        myUid = ActorClient.getUid();\n        const user = ActorClient.getUser(myUid);\n        mixpanel.identify(myUid);\n        mixpanel.people.set({\n          $phone: user.phones.length > 0 ? user.phones[0].phone : null,\n          $email: user.emails.length > 0 ? user.emails[0].email : null,\n          $name: user.name\n        });\n        mixpanel.track('Sign in');\n        Bugsnag.metaData = {\n          account: {\n            id: myUid,\n            name: user.name,\n            email: user.emails.length > 0 ? user.emails[0].email : null\n          }\n        };\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SET_LOGGED_OUT:\n        mixpanel.track('Sign out');\n        mixpanel.cookie.clear();\n        localStorage.clear();\n        location.reload();\n        break;\n      default:\n    }\n  };\n}\n\nexport default new LoginStore(Dispatcher);\n"]}