{"version":3,"sources":["../../src/stores/LoginStore.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA,IAAI,IAAI,GAAG,mBARW,SAAS,CAQV,UAAU;IAC3B,MAAM,GAAG;AACP,OAAK,EAAE,IAAI;AACX,MAAI,EAAE,IAAI;AACV,QAAM,EAAE,IAAI;CACb;IACD,KAAK,GAAG,EAAE;IACV,IAAI,GAAG,EAAE;IACT,IAAI,GAAG,EAAE;IACT,eAAe,GAAG,KAAK;IACvB,YAAY,GAAG,KAAK;IACpB,eAAe,GAAG,KAAK;IACvB,KAAK,GAAG,IAAI,CAAC;;IAEX,UAAU;YAAV,UAAU;;AACd,WADI,UAAU,CACF,UAAU,EAAE;0BADpB,UAAU;;uEAAV,UAAU,aAEN,UAAU;;UAKlB,OAAO,GAAG;aAAM,IAAI;KAAA;;UACpB,SAAS,GAAG;aAAM,MAAM;KAAA;;UACxB,QAAQ,GAAG;aAAM,KAAK;KAAA;;UACtB,OAAO,GAAG;aAAM,IAAI;KAAA;;UACpB,OAAO,GAAG;aAAM,IAAI;KAAA;;UACpB,eAAe,GAAG;aAAM,eAAe;KAAA;;UACvC,YAAY,GAAG;aAAM,YAAY;KAAA;;UACjC,eAAe,GAAG;aAAM,eAAe;KAAA;;UACvC,OAAO,GAAG;aAAM,KAAK;KAAA;;UACrB,UAAU,GAAG;aAAM,sBAAY,UAAU,EAAE;KAAA;;UAE3C,UAAU,GAAG,YAAM;AACjB,UAAI,GAAG,mBAzCW,SAAS,CAyCV,UAAU,CAAC;AAC5B,YAAM,GAAG;AACP,aAAK,EAAE,IAAI;AACX,YAAI,EAAE,IAAI;AACV,cAAM,EAAE,IAAI;OACb,CAAC;AACF,WAAK,GAAG,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;AACzB,qBAAe,GAAG,YAAY,GAAG,eAAe,GAAG,KAAK,CAAC;AACzD,WAAK,GAAG,IAAI,CAAC;KACd;;AAxBC,UAAK,IAAI,GAAG,UApBP,WAAW,GAoBS,CAAC;;GAC3B;;eALG,UAAU;;iCA8BD,MAAM,EAAE;AACnB,cAAQ,MAAM,CAAC,IAAI;;AAEjB,aAAK,mBAvDF,WAAW,CAuDG,iBAAiB;AAChC,eAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AACrB,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA3DF,WAAW,CA2DG,gBAAgB;AAC/B,cAAI,GAAG,MAAM,CAAC,IAAI,CAAC;AACnB,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA/DF,WAAW,CA+DG,gBAAgB;AAC/B,cAAI,GAAG,MAAM,CAAC,IAAI,CAAC;AACnB,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBApEF,WAAW,CAoEG,iBAAiB;AAChC,yBAAe,GAAG,IAAI,CAAC;AACvB,6BAAS,KAAK,CAAC,cAAc,CAAC,CAAC;AAC/B,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAzEF,WAAW,CAyEG,yBAAyB;AACxC,cAAI,GAAG,mBA1EO,SAAS,CA0EN,SAAS,CAAC;AAC3B,gBAAM,CAAC,KAAK,GAAG,IAAI,CAAC;AACpB,6BAAS,KAAK,CAAC,sBAAsB,CAAC,CAAC;AACvC,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA/EF,WAAW,CA+EG,yBAAyB;AACxC,kBAAQ,MAAM,CAAC,KAAK;AAClB,iBAAK,sBAAsB;AACzB,oBAAM,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,CAAC;AAC7D,oBAAM;AAAA,AACR,iBAAK,WAAW;AACd,oBAAM,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC;AACxD,oBAAM;AAAA,AACR;AACE,oBAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AAAA,WAC/B;AACD,yBAAe,GAAG,KAAK,CAAC;AACxB,6BAAS,KAAK,CAAC,sBAAsB,EAAE;AACrC,iBAAK,EAAE,MAAM,CAAC,KAAK;WACpB,CAAC,CAAC;AACH,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBAjGF,WAAW,CAiGG,cAAc;AAC7B,sBAAY,GAAG,IAAI,CAAC;AACpB,6BAAS,KAAK,CAAC,WAAW,CAAC,CAAC;AAC5B,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAtGF,WAAW,CAsGG,sBAAsB;AACrC,gBAAM,CAAC,IAAI,GAAG,IAAI,CAAC;AACnB,6BAAS,KAAK,CAAC,mBAAmB,CAAC,CAAC;AACpC,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA3GF,WAAW,CA2GG,sBAAsB;AACrC,kBAAQ,MAAM,CAAC,KAAK;AAClB,iBAAK,oBAAoB,CAAC;AAC1B,iBAAK,oBAAoB;AACvB,oBAAM,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC;AAC1D,oBAAM;AAAA,AACR,iBAAK,oBAAoB;AACvB,oBAAM,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC;AAC1D,oBAAM;AAAA,AACR;AACE,oBAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC;AAAA,WAC9B;AACD,sBAAY,GAAG,KAAK,CAAC;AACrB,6BAAS,KAAK,CAAC,mBAAmB,EAAE;AAClC,iBAAK,EAAE,MAAM,CAAC,KAAK;WACpB,CAAC,CAAC;AACH,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBA9HF,WAAW,CA8HG,iBAAiB;AAChC,cAAI,GAAG,mBA/HO,SAAS,CA+HN,SAAS,CAAC;AAC3B,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBAnIF,WAAW,CAmIG,WAAW;AAC1B,yBAAe,GAAG,IAAI,CAAC;AACvB,6BAAS,KAAK,CAAC,SAAS,CAAC,CAAC;AAC1B,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAxIF,WAAW,CAwIG,mBAAmB;AAClC,gBAAM,CAAC,MAAM,GAAG,IAAI,CAAC;AACrB,6BAAS,KAAK,CAAC,sBAAY,MAAM,EAAE,CAAC,CAAC;AACrC,6BAAS,MAAM,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,IAAI,EAAE,EAAC,CAAC,CAAC;AACjD,6BAAS,KAAK,CAAC,iBAAiB,CAAC,CAAC;AAClC,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA/IF,WAAW,CA+IG,mBAAmB;AAClC,kBAAQ,MAAM,CAAC,KAAK;AAClB,iBAAK,cAAc;AACjB,oBAAM,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC;AAC5D,oBAAM;AAAA,AACR;AACE,oBAAM,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC;AAAA,WAChC;AACD,yBAAe,GAAG,KAAK,CAAC;AACxB,6BAAS,KAAK,CAAC,iBAAiB,EAAE;AAChC,iBAAK,EAAE,MAAM,CAAC,KAAK;WACpB,CAAC,CAAC;AACH,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBA9JF,WAAW,CA8JG,YAAY;AAC3B,cAAI,CAAC,UAAU,EAAE,CAAC;AAClB,6BAAS,KAAK,CAAC,uBAAuB,CAAC,CAAC;AACxC,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;;AAAA,AAER,aAAK,mBApKF,WAAW,CAoKG,kBAAkB;AACjC,eAAK,GAAG,sBAAY,MAAM,EAAE,CAAC;AAC7B,cAAM,IAAI,GAAG,sBAAY,OAAO,CAAC,KAAK,CAAC,CAAC;AACxC,6BAAS,QAAQ,CAAC,KAAK,CAAC,CAAC;AACzB,6BAAS,MAAM,CAAC,GAAG,CAAC;AAClB,kBAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI;AAC5D,kBAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI;AAC5D,iBAAK,EAAE,IAAI,CAAC,IAAI;WACjB,CAAC,CAAC;AACH,6BAAS,KAAK,CAAC,SAAS,CAAC,CAAC;AAC1B,4BAAQ,QAAQ,GAAG;AACjB,mBAAO,EAAE;AACP,gBAAE,EAAE,KAAK;AACT,kBAAI,EAAE,IAAI,CAAC,IAAI;AACf,mBAAK,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI;aAC5D;WACF,CAAC;AACF,cAAI,CAAC,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAvLF,WAAW,CAuLG,mBAAmB;AAClC,6BAAS,KAAK,CAAC,UAAU,CAAC,CAAC;AAC3B,6BAAS,MAAM,CAAC,KAAK,EAAE,CAAC;AACxB,sBAAY,CAAC,KAAK,EAAE,CAAC;AACrB,kBAAQ,CAAC,MAAM,EAAE,CAAC;AAClB,gBAAM;AAAA,AACR,gBAAQ;OACT;KACF;;;SAzKG,UAAU;UAxBP,KAAK;;kBAoMC,IAAI,UAAU,8BAAY","file":"LoginStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes, AuthSteps } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport Bugsnag from '../utils/Bugsnag';\nimport mixpanel from '../utils/Mixpanel';\n\nimport { getIntlData } from '../l18n';\n\nlet step = AuthSteps.LOGIN_WAIT,\n    errors = {\n      login: null,\n      code: null,\n      signup: null\n    },\n    login = '',\n    code = '',\n    name = '',\n    isCodeRequested = false,\n    isCodeSended = false,\n    isSignupStarted = false,\n    myUid = null;\n\nclass LoginStore extends Store {\n  constructor(dispatcher) {\n    super(dispatcher);\n\n    this.intl = getIntlData();\n  }\n\n  getStep = () => step;\n  getErrors = () => errors;\n  getLogin = () => login;\n  getCode = () => code;\n  getName = () => name;\n  isCodeRequested = () => isCodeRequested;\n  isCodeSended = () => isCodeSended;\n  isSignupStarted = () => isSignupStarted;\n  getMyId = () => myUid;\n  isLoggedIn = () => ActorClient.isLoggedIn();\n\n  resetStore = () => {\n    step = AuthSteps.LOGIN_WAIT;\n    errors = {\n      login: null,\n      code: null,\n      signup: null\n    };\n    login = code = name = '';\n    isCodeRequested = isCodeSended = isSignupStarted = false;\n    myUid = null;\n  };\n\n  __onDispatch(action) {\n    switch (action.type) {\n\n      case ActionTypes.AUTH_CHANGE_LOGIN:\n        login = action.login;\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CHANGE_CODE:\n        code = action.code;\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CHANGE_NAME:\n        name = action.name;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_CODE_REQUEST:\n        isCodeRequested = true;\n        mixpanel.track('Request code');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_REQUEST_SUCCESS:\n        step = AuthSteps.CODE_WAIT;\n        errors.login = null;\n        mixpanel.track('Request code success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_REQUEST_FAILURE:\n        switch (action.error) {\n          case 'PHONE_NUMBER_INVALID':\n            errors.login = this.intl.messages.login.errors.numberInvalid;\n            break;\n          case 'CODE_WAIT':\n            errors.login = this.intl.messages.login.errors.codeWait;\n            break;\n          default:\n            errors.login = action.error;\n        }\n        isCodeRequested = false;\n        mixpanel.track('Request code failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_CODE_SEND:\n        isCodeSended = true;\n        mixpanel.track('Send code');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_SEND_SUCCESS:\n        errors.code = null;\n        mixpanel.track('Send code success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_CODE_SEND_FAILURE:\n        switch (action.error) {\n          case 'PHONE_CODE_INVALID':\n          case 'EMAIL_CODE_INVALID':\n            errors.code = this.intl.messages.login.errors.codeInvalid;\n            break;\n          case 'PHONE_CODE_EXPIRED':\n            errors.code = this.intl.messages.login.errors.codeExpired;\n            break;\n          default:\n            errors.code = action.error;\n        }\n        isCodeSended = false;\n        mixpanel.track('Send code failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SIGNUP_START:\n        step = AuthSteps.NAME_WAIT;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SIGNUP:\n        isSignupStarted = true;\n        mixpanel.track('Sign up');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SIGNUP_SUCCESS:\n        errors.signup = null;\n        mixpanel.alias(ActorClient.getUid());\n        mixpanel.people.set_once({$created: new Date()});\n        mixpanel.track('Sign up success');\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SIGNUP_FAILURE:\n        switch (action.error) {\n          case 'NAME_INVALID':\n            errors.signup = this.intl.messages.login.errors.nameInvalid;\n            break;\n          default:\n            errors.signup = action.error;\n        }\n        isSignupStarted = false;\n        mixpanel.track('Sign up failure', {\n          error: action.error\n        });\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_RESTART:\n        this.resetStore();\n        mixpanel.track('Restart authorization');\n        this.__emitChange();\n        break;\n\n      case ActionTypes.AUTH_SET_LOGGED_IN:\n        myUid = ActorClient.getUid();\n        const user = ActorClient.getUser(myUid);\n        mixpanel.identify(myUid);\n        mixpanel.people.set({\n          $phone: user.phones.length > 0 ? user.phones[0].phone : null,\n          $email: user.emails.length > 0 ? user.emails[0].email : null,\n          $name: user.name\n        });\n        mixpanel.track('Sign in');\n        Bugsnag.metaData = {\n          account: {\n            id: myUid,\n            name: user.name,\n            email: user.emails.length > 0 ? user.emails[0].email : null\n          }\n        };\n        this.__emitChange();\n        break;\n      case ActionTypes.AUTH_SET_LOGGED_OUT:\n        mixpanel.track('Sign out');\n        mixpanel.cookie.clear();\n        localStorage.clear();\n        location.reload();\n        break;\n      default:\n    }\n  };\n}\n\nexport default new LoginStore(Dispatcher);\n"]}