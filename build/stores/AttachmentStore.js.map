{"version":3,"sources":["../../src/stores/AttachmentStore.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUA,IAAI,OAAO,GAAG,KAAK;IACf,YAAY,GAAG,EAAE;IACjB,cAAc,GAAG,CAAC,CAAC;;AAEvB,IAAM,eAAe,GAAG,IAAI,CAAC;;IAEvB,eAAe;YAAf,eAAe;;AACnB,WADI,eAAe,CACP,UAAU,EAAE;0BADpB,eAAe;;uEAAf,eAAe,aAEX,UAAU;;UAmClB,YAAY,GAAG,UAAC,MAAM,EAAK;AACzB,cAAQ,MAAM,CAAC,IAAI;AACjB,aAAK,mBA/CF,WAAW,CA+CG,qBAAqB;AACpC,iBAAO,GAAG,IAAI,CAAC;AACf,sBAAY,GAAG,YArDd,GAAG,EAqDe,MAAM,CAAC,WAAW,EAAE,UAAC,IAAI,EAAK;AAC/C,gBAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AAC5C,mBAAO;AACL,qBAAO,EAAP,OAAO;AACP,2BAAa,EAAE,eAAe;AAC9B,kBAAI,EAAJ,IAAI;aACL,CAAA;WACF,CAAC,CAAC;AACH,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA3DF,WAAW,CA2DG,qBAAqB;AACpC,gBAAK,UAAU,EAAE,CAAC;AAClB,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA/DF,WAAW,CA+DG,iBAAiB;AAChC,wBAAc,GAAG,MAAM,CAAC,KAAK,CAAC;AAC9B,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAnEF,WAAW,CAmEG,iBAAiB;AAChC,sBAAY,CAAC,cAAc,CAAC,CAAC,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC;AAClE,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBAvEF,WAAW,CAuEG,iBAAiB,CAAC;AACnC,aAAK,mBAxEF,WAAW,CAwEG,eAAe;AAC9B,gBAAK,gBAAgB,EAAE,CAAC;AACxB,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,aAAK,mBA5EF,WAAW,CA4EG,mBAAmB;AAClC,gBAAK,UAAU,EAAE,CAAC;AAClB,gBAAK,YAAY,EAAE,CAAC;AACpB,gBAAM;AAAA,AACR,gBAAQ;OACT;KACF;;;GAvEA;;eAHG,eAAe;;6BAKV;AACP,aAAO,OAAO,CAAC;KAChB;;;wCAEmB;AAClB,aAAO,YAAY,CAAC;KACrB;;;oCAEqC;UAAxB,KAAK,yDAAG,cAAc;;AAClC,aAAO,YAAY,CAAC,KAAK,CAAC,CAAC;KAC5B;;;uCAEkB;AACjB,aAAO,cAAc,CAAC;KACvB;;;uCAEwC;UAAxB,KAAK,yDAAG,cAAc;;AACrC,kBAAY,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;;AAE9B,UAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;AAC7B,YAAI,CAAC,UAAU,EAAE,CAAC;OACnB;;AAED,oBAAc,GAAG,CAAC;AAAC,KACpB;;;iCAEY;AACX,aAAO,GAAG,KAAK,CAAC;AAChB,kBAAY,GAAG,EAAE,CAAC;AAClB,oBAAc,GAAG,CAAC,CAAC;KACpB;;;SAnCG,eAAe;UAVZ,KAAK;;kBAuFC,IAAI,eAAe,8BAAY","file":"AttachmentStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { map, remove } from 'lodash';\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nlet _isOpen = false,\n    _attachments = [],\n    _selectedIndex = 0;\n\nconst SEND_AS_PICTURE = true;\n\nclass AttachmentStore extends Store {\n  constructor(Dispatcher) {\n    super(Dispatcher);\n  }\n\n  isOpen() {\n    return _isOpen;\n  }\n\n  getAllAttachments() {\n    return _attachments;\n  }\n\n  getAttachment(index = _selectedIndex) {\n    return _attachments[index];\n  }\n\n  getSelectedIndex() {\n    return _selectedIndex;\n  }\n\n  deleteAttachment(index = _selectedIndex) {\n    _attachments.splice(index, 1);\n\n    if (_attachments.length === 0) {\n      this.resetStore();\n    }\n\n    _selectedIndex = 0; // TODO: select relevant index\n  }\n\n  resetStore() {\n    _isOpen = false;\n    _attachments = [];\n    _selectedIndex = 0;\n  }\n\n  __onDispatch = (action) => {\n    switch (action.type) {\n      case ActionTypes.ATTACHMENT_MODAL_SHOW:\n        _isOpen = true;\n        _attachments = map(action.attachments, (file) => {\n          const isImage = file.type.includes('image');\n          return {\n            isImage,\n            sendAsPicture: SEND_AS_PICTURE,\n            file\n          }\n        });\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_MODAL_HIDE:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SELECT:\n        _selectedIndex = action.index;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_CHANGE:\n        _attachments[_selectedIndex].sendAsPicture = action.sendAsPicture;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_DELETE:\n      case ActionTypes.ATTACHMENT_SEND:\n        this.deleteAttachment();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SEND_ALL:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      default:\n    }\n  }\n}\n\nexport default new AttachmentStore(Dispatcher);\n"]}