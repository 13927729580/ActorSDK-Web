{"version":3,"sources":["../../src/stores/AttachmentStore.js"],"names":[],"mappings":"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","file":"AttachmentStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { map, remove } from 'lodash';\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nlet _isOpen = false,\n    _attachments = [],\n    _selectedIndex = 0;\n\nconst SEND_AS_PICTURE = true;\n\nconst blobToFile = (blob, fileName) => {\n  blob.lastModifiedDate = blob.lastModifiedDate ? blob.lastModifiedDate : new Date();\n  blob.name = fileName ? fileName : `${blob.lastModifiedDate}.${blob.type.split('/')[1]}`;\n  return blob;\n};\n\n\nclass AttachmentStore extends Store {\n  constructor(dispatcher) {\n    super(dispatcher);\n  }\n\n  isOpen() {\n    return _isOpen;\n  }\n\n  getAllAttachments() {\n    return _attachments;\n  }\n\n  getAttachment(index = _selectedIndex) {\n    return _attachments[index];\n  }\n\n  getSelectedIndex() {\n    return _selectedIndex;\n  }\n\n  deleteAttachment(index = _selectedIndex) {\n    _attachments.splice(index, 1);\n\n    if (_attachments.length === 0) {\n      this.resetStore();\n    }\n\n    _selectedIndex = 0; // TODO: select relevant index\n  }\n\n  resetStore() {\n    _isOpen = false;\n    _attachments = [];\n    _selectedIndex = 0;\n  }\n\n  __onDispatch(action) {\n    switch (action.type) {\n      case ActionTypes.ATTACHMENT_MODAL_SHOW:\n        _isOpen = true;\n        _attachments = map(action.attachments, (file) => {\n          if (file instanceof File == false) {\n            file = blobToFile(file);\n          }\n\n          const isImage = file.type.includes('image') && file.type !== 'image/gif';\n          return {\n            isImage,\n            sendAsPicture: SEND_AS_PICTURE,\n            file\n          }\n        });\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_MODAL_HIDE:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SELECT:\n        _selectedIndex = action.index;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_CHANGE:\n        _attachments[_selectedIndex].sendAsPicture = action.sendAsPicture;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_DELETE:\n      case ActionTypes.ATTACHMENT_SEND:\n        this.deleteAttachment();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SEND_ALL:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      default:\n    }\n  };\n}\n\nexport default new AttachmentStore(Dispatcher);\n"]}