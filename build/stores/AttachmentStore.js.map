{"version":3,"sources":["../../src/stores/AttachmentStore.js"],"names":[],"mappings":"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","file":"AttachmentStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { map, remove } from 'lodash';\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nlet _isOpen = false,\n    _attachments = [],\n    _selectedIndex = 0;\n\nconst SEND_AS_PICTURE = true;\n\nconst blobToFile = (blob, fileName) => {\n  blob.lastModifiedDate = blob.lastModifiedDate ? blob.lastModifiedDate : new Date();\n  blob.name = fileName ? fileName : `${blob.lastModifiedDate}.${blob.type.split('/')[1]}`;\n  return blob;\n};\n\n\nclass AttachmentStore extends Store {\n  constructor(dispatcher) {\n    super(dispatcher);\n  }\n\n  isOpen() {\n    return _isOpen;\n  }\n\n  getAllAttachments() {\n    return _attachments;\n  }\n\n  getAttachment(index = _selectedIndex) {\n    return _attachments[index];\n  }\n\n  getSelectedIndex() {\n    return _selectedIndex;\n  }\n\n  deleteAttachment(index = _selectedIndex) {\n    _attachments.splice(index, 1);\n\n    if (_attachments.length === 0) {\n      this.resetStore();\n    }\n\n    _selectedIndex = 0; // TODO: select relevant index\n  }\n\n  resetStore() {\n    _isOpen = false;\n    _attachments = [];\n    _selectedIndex = 0;\n  }\n\n  __onDispatch(action) {\n    switch (action.type) {\n      case ActionTypes.ATTACHMENT_MODAL_SHOW:\n        _isOpen = true;\n        _attachments = map(action.attachments, (file) => {\n          if (file instanceof Blob) {\n            file = blobToFile(file);\n          }\n\n          const isImage = file.type.includes('image') && file.type !== 'image/gif';\n          return {\n            isImage,\n            sendAsPicture: SEND_AS_PICTURE,\n            file\n          }\n        });\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_MODAL_HIDE:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SELECT:\n        _selectedIndex = action.index;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_CHANGE:\n        _attachments[_selectedIndex].sendAsPicture = action.sendAsPicture;\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_DELETE:\n      case ActionTypes.ATTACHMENT_SEND:\n        this.deleteAttachment();\n        this.__emitChange();\n        break;\n      case ActionTypes.ATTACHMENT_SEND_ALL:\n        this.resetStore();\n        this.__emitChange();\n        break;\n      default:\n    }\n  };\n}\n\nexport default new AttachmentStore(Dispatcher);\n"]}