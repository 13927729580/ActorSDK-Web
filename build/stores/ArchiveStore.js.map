{"version":3,"sources":["../../src/stores/ArchiveStore.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAIA;;AACA;;;;AACA;;AACA;;;;;;;;;;IAEM;;;AACJ,WADI,YACJ,CAAY,UAAZ,EAAwB;wCADpB,cACoB;;+DACtB,kBAAM,UAAN,GADsB;;AAGtB,UAAK,SAAL,GAAiB,IAAjB,CAHsB;AAItB,UAAK,OAAL,GAAe,EAAf,CAJsB;AAKtB,UAAK,gBAAL,GAAwB,EAAxB,CALsB;AAMtB,UAAK,YAAL,GAAoB,KAApB,CANsB;AAOtB,UAAK,yBAAL,GAAiC,KAAjC,CAPsB;;GAAxB;;AADI,yBAWJ,+CAAmB;AACjB,WAAO,KAAK,SAAL,CADU;;;AAXf,yBAeJ,qCAAc;AACZ,WAAO,KAAK,YAAL,CADK;;;AAfV,yBAmBJ,+DAA2B;AACzB,WAAO,KAAK,yBAAL,CADkB;;;AAnBvB,yBAuBJ,mCAAa;AACX,WAAO,KAAK,OAAL,CADI;;;AAvBT,yBA2BJ,qDAAsB;AACpB,WAAO,KAAK,gBAAL,CADa;;;AA3BlB,yBA+BJ,qCAAa,QAAQ;AACnB,QAAM,UAAU,OAAO,IAAP,GAAc,oBAAU,YAAV,CAAuB,OAAO,IAAP,CAArC,GAAoD,IAApD,CADG;AAEnB,YAAO,OAAO,IAAP;AACL,WAAK,+BAAY,WAAZ;AACH,aAAK,gBAAL,CAAsB,OAAtB,IAAiC,qCAAkB,UAAlB,CADnC;AAEE,aAAK,YAAL,GAFF;AAGE,cAHF;AADF,WAKO,+BAAY,mBAAZ;AACH,eAAO,KAAK,gBAAL,CAAsB,OAAtB,CAAP,CADF;AAEE,aAAK,YAAL,GAFF;AAGE,cAHF;AALF,WASO,+BAAY,iBAAZ;AACH,YAAM,MAAM,oBAAU,YAAV,CAAuB,OAAO,IAAP,CAA7B,CADR;AAEE,aAAK,gBAAL,CAAsB,OAAtB,IAAiC,qCAAkB,OAAlB,CAFnC;AAGE,aAAK,YAAL,GAHF;AAIE,cAJF;;AATF,WAeO,+BAAY,YAAZ;AACH,aAAK,SAAL,GAAiB,IAAjB,CADF;AAEE,aAAK,YAAL,GAAoB,KAApB,CAFF;AAGE,aAAK,yBAAL,GAAiC,KAAjC,CAHF;AAIE,aAAK,YAAL,GAJF;AAKE,cALF;;AAfF,WAsBO,+BAAY,oBAAZ;AACH,aAAK,SAAL,GAAiB,KAAjB,CADF;AAEE,aAAK,yBAAL,GAAiC,IAAjC,CAFF;AAGE,aAAK,OAAL,GAAe,OAAO,QAAP,CAHjB;AAIE,aAAK,YAAL,GAJF;AAKE,cALF;;AAtBF,WA6BO,+BAAY,iBAAZ;AACH,aAAK,SAAL,GAAiB,IAAjB,CADF;AAEE,aAAK,YAAL,GAFF;AAGE,cAHF;;AA7BF,WAkCO,+BAAY,yBAAZ;AACH,aAAK,SAAL,GAAiB,KAAjB,CADF;AAEE,aAAK,YAAL,GAAoB,OAAO,QAAP,CAAgB,MAAhB,KAA2B,CAA3B,CAFtB;AAGE,aAAK,OAAL,CAAa,IAAb,CAAkB,KAAlB,CAAwB,KAAK,OAAL,EAAc,OAAO,QAAP,CAAtC,CAHF;AAIE,aAAK,YAAL,GAJF;AAKE,cALF;;AAlCF;KAFmB;;;SA/BjB;;;kBA+ES,IAAI,YAAJ","file":"ArchiveStore.js","sourcesContent":["/*\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\n */\n\nimport { Store } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes, AsyncActionStates } from '../constants/ActorAppConstants';\nimport PeerUtils from '../utils/PeerUtils';\n\nclass ArchiveStore extends Store {\n  constructor(dispatcher) {\n    super(dispatcher);\n\n    this.isLoading = true;\n    this.dialogs = [];\n    this.archiveChatState = {};\n    this._isAllLoaded = false;\n    this._isInitialLoadingComplete = false;\n  }\n\n  isArchiveLoading() {\n    return this.isLoading;\n  }\n\n  isAllLoaded() {\n    return this._isAllLoaded;\n  }\n\n  isInitialLoadingComplete() {\n    return this._isInitialLoadingComplete;\n  }\n\n  getDialogs() {\n    return this.dialogs;\n  }\n\n  getArchiveChatState() {\n    return this.archiveChatState;\n  }\n\n  __onDispatch(action) {\n    const peerKey = action.peer ? PeerUtils.peerToString(action.peer) : null;\n    switch(action.type) {\n      case ActionTypes.ARCHIVE_ADD:\n        this.archiveChatState[peerKey] = AsyncActionStates.PROCESSING;\n        this.__emitChange();\n        break;\n      case ActionTypes.ARCHIVE_ADD_SUCCESS:\n        delete this.archiveChatState[peerKey];\n        this.__emitChange();\n        break;\n      case ActionTypes.ARCHIVE_ADD_ERROR:\n        const key = PeerUtils.peerToString(action.peer);\n        this.archiveChatState[peerKey] = AsyncActionStates.FAILURE;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.ARCHIVE_LOAD:\n        this.isLoading = true;\n        this._isAllLoaded = false;\n        this._isInitialLoadingComplete = false;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.ARCHIVE_LOAD_SUCCESS:\n        this.isLoading = false;\n        this._isInitialLoadingComplete = true;\n        this.dialogs = action.response;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.ARCHIVE_LOAD_MORE:\n        this.isLoading = true;\n        this.__emitChange();\n        break;\n\n      case ActionTypes.ARCHIVE_LOAD_MORE_SUCCESS:\n        this.isLoading = false;\n        this._isAllLoaded = action.response.length === 0;\n        this.dialogs.push.apply(this.dialogs, action.response);\n        this.__emitChange();\n        break;\n\n      default:\n    }\n  }\n}\n\nexport default new ArchiveStore(Dispatcher);\n"]}